import React, { useState, useEffect } from 'react';
import { Download, Plus, Trash2, BarChart3, Calendar, Users, TrendingUp } from 'lucide-react';

export default function FinanceTracker() {
  const [activeTab, setActiveTab] = useState('monthly');
  
  const [monthlyData, setMonthlyData] = useState(() => {
    const saved = localStorage.getItem('monthlyData');
    return saved ? JSON.parse(saved) : [
      { id: 1, date: '2025-11-25', location: '–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è', type: '–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ', direction: '–°—Ç–∞–Ω–¥–∞—Ä—Ç', teacher: '–Ø', people: 35, income: 9800, expense: 0, note: '–ú–æ—è –≥—Ä—É–ø–ø–∞' },
      { id: 2, date: '2025-11-25', location: '–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è', type: '–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ', direction: '–õ–∞—Ç–∏–Ω–∞', teacher: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞', people: 33, income: 9240, expense: 3220, note: '50%-1400‚ÇΩ' },
      { id: 3, date: '2025-11-26', location: '–ë—É–¥–µ–Ω–Ω–æ–≥–æ', type: '–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ', direction: '–§–æ—Ä–º–µ–π—à–Ω', teacher: '–Ø', people: 20, income: 5600, expense: 0, note: '' },
    ];
  });

  const [expenses, setExpenses] = useState(() => {
    const saved = localStorage.getItem('expenses');
    return saved ? JSON.parse(saved) : [
      { id: 1, item: '–ê—Ä–µ–Ω–¥–∞ –ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è', amount: 0, comment: '–û–ø–ª–∞—á–∏–≤–∞—é—Ç –ø–µ–¥–∞–≥–æ–≥–∏' },
      { id: 2, item: '–ö–æ–º–º—É–Ω–∞–ª–∫–∞ –ë—É–¥–µ–Ω–Ω–æ–≥–æ', amount: 20000, comment: '' },
      { id: 3, item: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', amount: 10000, comment: '~500‚ÇΩ √ó –¥–Ω–∏ –∞—Ä–µ–Ω–¥—ã' },
      { id: 4, item: '–†–µ–∫–ª–∞–º–∞', amount: 0, comment: '' },
      { id: 5, item: '–ü—Ä–æ—á–µ–µ', amount: 0, comment: '' },
    ];
  });

  const [passive, setPassive] = useState(() => {
    const saved = localStorage.getItem('passive');
    return saved ? JSON.parse(saved) : [
      { id: 1, source: '–í–∫–ª–∞–¥ 1', monthly: 85000, capital: 0, rate: 0 },
    ];
  });

  const [individual, setIndividual] = useState(() => {
    const saved = localStorage.getItem('individual');
    return saved ? JSON.parse(saved) : [
      { id: 1, date: '2025-11-25', client: '–ò–≤–∞–Ω –ü.', location: '–ë—É–¥–µ–Ω–Ω–æ–≥–æ', hours: 1.5, rate: 3000, note: '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∫–æ–Ω–∫—É—Ä—Å—É' },
      { id: 2, date: '2025-11-26', client: '–ú–∞—Ä–∏—è –°.', location: '–í—ã–µ–∑–¥', hours: 1, rate: 5000, note: 'VIP' },
    ];
  });

  const [newEntry, setNewEntry] = useState({
    date: new Date().toISOString().split('T')[0],
    location: '–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è',
    type: '–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ',
    direction: '',
    teacher: '–Ø',
    people: 0,
    income: 0,
    expense: 0,
    note: ''
  });

  useEffect(() => {
    localStorage.setItem('monthlyData', JSON.stringify(monthlyData));
  }, [monthlyData]);

  useEffect(() => {
    localStorage.setItem('expenses', JSON.stringify(expenses));
  }, [expenses]);

  useEffect(() => {
    localStorage.setItem('passive', JSON.stringify(passive));
  }, [passive]);

  useEffect(() => {
    localStorage.setItem('individual', JSON.stringify(individual));
  }, [individual]);

  const totalMonthlyIncome = monthlyData.reduce((sum, item) => sum + Number(item.income), 0);
  const totalMonthlyExpense = monthlyData.reduce((sum, item) => sum + Number(item.expense), 0);
  const totalMonthlyProfit = totalMonthlyIncome - totalMonthlyExpense;

  const totalExpenses = expenses.reduce((sum, item) => sum + Number(item.amount), 0);
  const totalPassive = passive.reduce((sum, item) => sum + Number(item.monthly), 0);
  const totalIndividual = individual.reduce((sum, item) => sum + (Number(item.hours) * Number(item.rate)), 0);
  const totalIndividualHours = individual.reduce((sum, item) => sum + Number(item.hours), 0);

  const dolgoletieCherkiz = monthlyData
    .filter(item => item.location === '–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è' && item.type === '–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ')
    .reduce((sum, item) => sum + (Number(item.income) - Number(item.expense)), 0);
  
  const dolgoletieBudenogo = monthlyData
    .filter(item => item.location === '–ë—É–¥–µ–Ω–Ω–æ–≥–æ' && item.type === '–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ')
    .reduce((sum, item) => sum + (Number(item.income) - Number(item.expense)), 0);

  const totalIncome = dolgoletieCherkiz + dolgoletieBudenogo + totalIndividual + totalPassive;
  const netProfit = totalIncome - totalExpenses;
  const progress = ((totalIncome / 1000000) * 100).toFixed(1);

  const formatNumber = (num) => {
    return new Intl.NumberFormat('ru-RU').format(Math.round(num));
  };

  const formatDate = (dateStr) => {
    const [year, month, day] = dateStr.split('-');
    return `${day}.${month}.${year}`;
  };

  const addEntry = () => {
    const entry = {
      id: Date.now(),
      ...newEntry,
      income: Number(newEntry.income),
      expense: Number(newEntry.expense),
      people: Number(newEntry.people)
    };
    setMonthlyData([...monthlyData, entry]);
    setNewEntry({
      date: new Date().toISOString().split('T')[0],
      location: '–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è',
      type: '–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ',
      direction: '',
      teacher: '–Ø',
      people: 0,
      income: 0,
      expense: 0,
      note: ''
    });
  };

  const deleteEntry = (id) => {
    if (window.confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) {
      setMonthlyData(monthlyData.filter(item => item.id !== id));
    }
  };

  const exportToCSV = () => {
    const csv = [
      ['–î–∞—Ç–∞', '–õ–æ–∫–∞—Ü–∏—è', '–¢–∏–ø', '–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ', '–ü–µ–¥–∞–≥–æ–≥', '–õ—é–¥–µ–π', '–î–æ—Ö–æ–¥', '–†–∞—Å—Ö–æ–¥', '–ü—Ä–∏–±—ã–ª—å', '–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ'],
      ...monthlyData.map(row => [
        row.date,
        row.location,
        row.type,
        row.direction,
        row.teacher,
        row.people,
        row.income,
        row.expense,
        row.income - row.expense,
        row.note
      ])
    ].map(row => row.join(',')).join('\n');

    const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `TheGame_${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
  };

  const tabs = [
    { id: 'monthly', name: '–ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç', icon: Calendar },
    { id: 'summary', name: '–°–≤–æ–¥–∫–∞', icon: BarChart3 },
    { id: 'expenses', name: '–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã', icon: TrendingUp },
    { id: 'passive', name: '–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥', icon: BarChart3 },
  ];

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white p-4">
      <div className="max-w-7xl mx-auto">
        <div className="mb-8">
          <div className="flex items-center justify-between mb-4">
            <div>
              <h1 className="text-3xl font-bold mb-2">üí∞ –£—á—ë—Ç –¥–æ—Ö–æ–¥–æ–≤ TheGame</h1>
              <p className="text-slate-400">–ü—É—Ç—å –æ—Ç 385–ö –∫ 1–ú | 2025-2026</p>
            </div>
            <button
              onClick={exportToCSV}
              className="flex items-center gap-2 bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition"
            >
              <Download size={20} />
              –≠–∫—Å–ø–æ—Ä—Ç
            </button>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div className="bg-slate-800 p-4 rounded-lg border border-slate-700">
              <div className="text-slate-400 text-sm mb-1">–¢–µ–∫—É—â–∏–π –¥–æ—Ö–æ–¥</div>
              <div className="text-2xl font-bold text-green-400">{formatNumber(totalIncome)}‚ÇΩ</div>
            </div>
            <div className="bg-slate-800 p-4 rounded-lg border border-slate-700">
              <div className="text-slate-400 text-sm mb-1">–¶–µ–ª—å (–¢–æ—á–∫–∞ –ë)</div>
              <div className="text-2xl font-bold text-blue-400">1,000,000‚ÇΩ</div>
            </div>
            <div className="bg-slate-800 p-4 rounded-lg border border-slate-700">
              <div className="text-slate-400 text-sm mb-1">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
              <div className="text-2xl font-bold text-yellow-400">{progress}%</div>
            </div>
            <div className="bg-slate-800 p-4 rounded-lg border border-slate-700">
              <div className="text-slate-400 text-sm mb-1">–î–æ —Ü–µ–ª–∏</div>
              <div className="text-2xl font-bold text-red-400">{formatNumber(1000000 - totalIncome)}‚ÇΩ</div>
            </div>
          </div>
        </div>

        <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
          {tabs.map((tab) => {
            const Icon = tab.icon;
            return (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={`flex items-center gap-2 px-4 py-2 rounded-lg transition whitespace-nowrap ${
                  activeTab === tab.id
                    ? 'bg-blue-600 text-white'
                    : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
                }`}
              >
                <Icon size={18} />
                {tab.name}
              </button>
            );
          })}
        </div>

        <div className="bg-slate-800 rounded-lg border border-slate-700 p-6">
          {activeTab === 'monthly' && (
            <div>
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-xl font-bold">üìÖ –ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç</h2>
              </div>

              <div className="bg-slate-900/50 p-4 rounded-lg mb-6 border border-slate-700">
                <h3 className="font-bold mb-3">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</h3>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                  <input
                    type="date"
                    value={newEntry.date}
                    onChange={(e) => setNewEntry({...newEntry, date: e.target.value})}
                    className="bg-slate-800 px-3 py-2 rounded border border-slate-600 text-sm"
                  />
                  <select
                    value={newEntry.location}
                    onChange={(e) => setNewEntry({...newEntry, location: e.target.value})}
                    className="bg-slate-800 px-3 py-2 rounded border border-slate-600 text-sm"
                  >
                    <option>–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è</option>
                    <option>–ë—É–¥–µ–Ω–Ω–æ–≥–æ</option>
                    <option>–í—ã–µ–∑–¥</option>
                  </select>
                  <select
                    value={newEntry.type}
                    onChange={(e) => setNewEntry({...newEntry, type: e.target.value})}
                    className="bg-slate-800 px-3 py-2 rounded border border-slate-600 text-sm"
                  >
                    <option>–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ</option>
                    <option>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∫–∞</option>
                    <option>–ê—Ä–µ–Ω–¥–∞</option>
                    <option>–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥</option>
                  </select>
                  <input
                    type="text"
                    placeholder="–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"
                    value={newEntry.direction}
                    onChange={(e) => setNewEntry({...newEntry, direction: e.target.value})}
                    className="bg-slate-800 px-3 py-2 rounded border border-slate-600 text-sm"
                  />
                  <input
                    type="text"
                    placeholder="–ü–µ–¥–∞–≥–æ–≥"
                    value={newEntry.teacher}
                    onChange={(e) => setNewEntry({...newEntry, teacher: e.target.value})}
                    className="bg-slate-800 px-3 py-2 rounded border border-slate-600 text-sm"
                  />
                  <input
                    type="number"
                    placeholder="–õ—é–¥–µ–π"
                    value={newEntry.people || ''}
                    onChange={(e) => setNewEntry({...newEntry, people: e.target.value})}
                    className="bg-slate-800 px-3 py-2 rounded border border-slate-600 text-sm"
                  />
                  <input
                    type="number"
                    placeholder="–î–æ—Ö–æ–¥"
                    value={newEntry.income || ''}
                    onChange={(e) => setNewEntry({...newEntry, income: e.target.value})}
                    className="bg-slate-800 px-3 py-2 rounded border border-slate-600 text-sm"
                  />
                  <input
                    type="number"
                    placeholder="–†–∞—Å—Ö–æ–¥"
                    value={newEntry.expense || ''}
                    onChange={(e) => setNewEntry({...newEntry, expense: e.target.value})}
                    className="bg-slate-800 px-3 py-2 rounded border border-slate-600 text-sm"
                  />
                  <input
                    type="text"
                    placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ"
                    value={newEntry.note}
                    onChange={(e) => setNewEntry({...newEntry, note: e.target.value})}
                    className="bg-slate-800 px-3 py-2 rounded border border-slate-600 text-sm col-span-2"
                  />
                  <button
                    onClick={addEntry}
                    className="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded flex items-center justify-center gap-2 transition col-span-2 md:col-span-1"
                  >
                    <Plus size={16} />
                    –î–æ–±–∞–≤–∏—Ç—å
                  </button>
                </div>
              </div>
              
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead>
                    <tr className="border-b border-slate-700">
                      <th className="text-left py-3 px-2">–î–∞—Ç–∞</th>
                      <th className="text-left py-3 px-2">–õ–æ–∫–∞—Ü–∏—è</th>
                      <th className="text-left py-3 px-2">–¢–∏–ø</th>
                      <th className="text-left py-3 px-2">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th>
                      <th className="text-left py-3 px-2">–ü–µ–¥–∞–≥–æ–≥</th>
                      <th className="text-right py-3 px-2">–õ—é–¥–µ–π</th>
                      <th className="text-right py-3 px-2">–î–æ—Ö–æ–¥</th>
                      <th className="text-right py-3 px-2">–†–∞—Å—Ö–æ–¥</th>
                      <th className="text-right py-3 px-2">–ü—Ä–∏–±—ã–ª—å</th>
                      <th className="text-left py-3 px-2">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
                      <th className="py-3 px-2"></th>
                    </tr>
                  </thead>
                  <tbody>
                    {monthlyData.map((row) => (
                      <tr key={row.id} className="border-b border-slate-700/50 hover:bg-slate-700/30">
                        <td className="py-3 px-2">{formatDate(row.date)}</td>
                        <td className="py-3 px-2">{row.location}</td>
                        <td className="py-3 px-2">{row.type}</td>
                        <td className="py-3 px-2">{row.direction}</td>
                        <td className="py-3 px-2">{row.teacher}</td>
                        <td className="text-right py-3 px-2">{row.people}</td>
                        <td className="text-right py-3 px-2 text-green-400">{formatNumber(row.income)}‚ÇΩ</td>
                        <td className="text-right py-3 px-2 text-red-400">{formatNumber(row.expense)}‚ÇΩ</td>
                        <td className="text-right py-3 px-2 font-bold text-blue-400">{formatNumber(row.income - row.expense)}‚ÇΩ</td>
                        <td className="py-3 px-2 text-slate-400 text-xs">{row.note}</td>
                        <td className="py-3 px-2">
                          <button
                            onClick={() => deleteEntry(row.id)}
                            className="text-red-400 hover:text-red-300"
                          >
                            <Trash2 size={16} />
                          </button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                  <tfoot className="bg-slate-900/50">
                    <tr className="font-bold">
                      <td colSpan="6" className="py-3 px-2">–ò–¢–û–ì–û:</td>
                      <td className="text-right py-3 px-2 text-green-400">{formatNumber(totalMonthlyIncome)}‚ÇΩ</td>
                      <td className="text-right py-3 px-2 text-red-400">{formatNumber(totalMonthlyExpense)}‚ÇΩ</td>
                      <td className="text-right py-3 px-2 text-blue-400">{formatNumber(totalMonthlyProfit)}‚ÇΩ</td>
                      <td colSpan="2"></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          )}

          {activeTab === 'summary' && (
            <div>
              <h2 className="text-xl font-bold mb-6">üìä –°–≤–æ–¥–∫–∞ –∑–∞ –Ω–æ—è–±—Ä—å 2025</h2>
              
              <div className="grid md:grid-cols-2 gap-6">
                <div className="bg-slate-900/50 p-6 rounded-lg border border-slate-700">
                  <h3 className="text-lg font-bold mb-4 text-green-400">–î–û–•–û–î–´</h3>
                  <div className="space-y-3">
                    <div className="flex justify-between">
                      <span className="text-slate-300">–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ –ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è:</span>
                      <span className="font-semibold">{formatNumber(dolgoletieCherkiz)}‚ÇΩ</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-slate-300">–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ –ë—É–¥–µ–Ω–Ω–æ–≥–æ:</span>
                      <span className="font-semibold">{formatNumber(dolgoletieBudenogo)}‚ÇΩ</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-slate-300">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è:</span>
                      <span className="font-semibold">{formatNumber(totalIndividual)}‚ÇΩ</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-slate-300">–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥:</span>
                      <span className="font-semibold">{formatNumber(totalPassive)}‚ÇΩ</span>
                    </div>
                    <div className="pt-3 border-t border-slate-700 flex justify-between">
                      <span className="font-bold text-lg">–ò–¢–û–ì–û –î–û–•–û–î:</span>
                      <span className="font-bold text-lg text-green-400">{formatNumber(totalIncome)}‚ÇΩ</span>
                    </div>
                  </div>
                </div>

                <div className="bg-slate-900/50 p-6 rounded-lg border border-slate-700">
                  <h3 className="text-lg font-bold mb-4 text-red-400">–†–ê–°–•–û–î–´</h3>
                  <div className="space-y-3">
                    {expenses.map(exp => (
                      <div key={exp.id} className="flex justify-between">
                        <span className="text-slate-300">{exp.item}:</span>
                        <span className="font-semibold">{formatNumber(exp.amount)}‚ÇΩ</span>
                      </div>
                    ))}
                    <div className="pt-3 border-t border-slate-700 flex justify-between">
                      <span className="font-bold text-lg">–ò–¢–û–ì–û –†–ê–°–•–û–î:</span>
                      <span className="font-bold text-lg text-red-400">{formatNumber(totalExpenses)}‚ÇΩ</span>
                    </div>
                  </div>
                </div>
              </div>

              <div className="mt-6 bg-gradient-to-r from-blue-900/50 to-blue-800/50 p-6 rounded-lg border-2 border-blue-600">
                <div className="flex justify-between items-center">
                  <span className="text-2xl font-bold">–ß–ò–°–¢–ê–Ø –ü–†–ò–ë–´–õ–¨:</span>
                  <span className="text-3xl font-bold text-blue-400">{formatNumber(netProfit)}‚ÇΩ</span>
                </div>
              </div>

              <div className="mt-6 bg-slate-900/50 p-6 rounded-lg border border-slate-700">
                <h3 className="text-lg font-bold mb-4">üìà –ú–ï–¢–†–ò–ö–ò</h3>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <div>
                    <div className="text-slate-400 text-sm">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</div>
                    <div className="text-xl font-bold">{monthlyData.length}</div>
                  </div>
                  <div>
                    <div className="text-slate-400 text-sm">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö —á–∞—Å–æ–≤</div>
                    <div className="text-xl font-bold">{totalIndividualHours.toFixed(1)} —á</div>
                  </div>
                  <div>
                    <div className="text-slate-400 text-sm">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫ –∏–Ω–¥.</div>
                    <div className="text-xl font-bold">{formatNumber(totalIndividual / totalIndividualHours || 0)}‚ÇΩ/—á</div>
                  </div>
                  <div>
                    <div className="text-slate-400 text-sm">–ü—Ä–æ–≥—Ä–µ—Å—Å –∫ —Ü–µ–ª–∏</div>
                    <div className="text-xl font-bold text-yellow-400">{progress}%</div>
                  </div>
                </div>
              </div>
            </div>
          )}

          {activeTab === 'expenses' && (
            <div>
              <h2 className="text-xl font-bold mb-4">üí∏ –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã</h2>
              <p className="text-slate-400 mb-4">–†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞–ø—Ä—è–º—É—é</p>
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead>
                    <tr className="border-b border-slate-700">
                      <th className="text-left py-3 px-2">–°—Ç–∞—Ç—å—è —Ä–∞—Å—Ö–æ–¥–∞</th>
                      <th className="text-right py-3 px-2">–°—É–º–º–∞/–º–µ—Å</th>
                      <th className="text-left py-3 px-2">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                    </tr>
                  </thead>
                  <tbody>
                    {expenses.map((row) => (
                      <tr key={row.id} className="border-b border-slate-700/50">
                        <td className="py-3 px-2">{row.item}</td>
                        <td className="text-right py-3 px-2">
                          <input
                            type="number"
                            value={row.amount}
                            onChange={(e) => {
                              const updated = expenses.map(exp => 
                                exp.id === row.id ? {...exp, amount: Number(e.target.value)} : exp
                              );
                              setExpenses(updated);
                            }}
                            className="bg-slate-900 px-2 py-1 rounded w-32 text-right border border-slate-600"
                          />
                        </td>
                        <td className="py-3 px-2 text-slate-400 text-sm">{row.comment}</td>
                      </tr>
                    ))}
                  </tbody>
                  <tfoot className="bg-slate-900/50">
                    <tr className="font-bold">
                      <td className="py-3 px-2">–ò–¢–û–ì–û:</td>
                      <td className="text-right py-3 px-2 text-red-400">{formatNumber(totalExpenses)}‚ÇΩ</td>
                      <td></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          )}

          {activeTab === 'passive' && (
            <div>
              <h2 className="text-xl font-bold mb-4">üí∞ –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥</h2>
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead>
                    <tr className="border-b border-slate-700">
                      <th className="text-left py-3 px-2">–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                      <th className="text-right py-3 px-2">–°—É–º–º–∞/–º–µ—Å</th>
                      <th className="text-right py-3 px-2">–ö–∞–ø–∏—Ç–∞–ª</th>
                      <th className="text-right py-3 px-2">–°—Ç–∞–≤–∫–∞ %</th>
                    </tr>
                  </thead>
                  <tbody>
                    {passive.map((row) => (
                      <tr key={row.id} className="border-b border-slate-700/50">
                        <td className="py-3 px-2">{row.source}</td>
                        <td className="text-right py-3 px-2">
                          <input
                            type="number"
                            value={row.monthly}
                            onChange={(e) => {
                              const updated = passive.map(p => 
                                p.id === row.id ? {...p, monthly: Number(e.target.value)} : p
                              );
                              setPassive(updated);
                            }}
                            className="bg-slate-900 px-2 py-1 rounded w-32 text-right border border-slate-600"
                          />
                        </td>
                        <td className="text-right py-3 px-2">{row.capital ? formatNumber(row.capital) + '‚ÇΩ' : '‚Äî'}</td>
                        <td className="text-right py-3 px-2">{row.rate ? row.rate + '%' : '‚Äî'}</td>
                      </tr>
                    ))}
                  </tbody>
                  <tfoot className="bg-slate-900/50">
                    <tr className="font-bold">
                      <td className="py-3 px-2">–ò–¢–û–ì–û:</td>
                      <td className="text-right py-3 px-2 text-green-400">{formatNumber(totalPassive)}‚ÇΩ</td>
                      <td colSpan="2"></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          )}
        </div>

        <div className="mt-8 text-center text-slate-500 text-sm">
          <p>üí° –°–æ–≤–µ—Ç: –ó–∞–ø–æ–ª–Ω—è–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –µ–∂–µ–¥–Ω–µ–≤–Ω–æ, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</p>
          <p className="mt-2">–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ</p>
        </div>
      </div>
    </div>
  );
}
