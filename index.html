<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—á—ë—Ç –¥–æ—Ö–æ–¥–æ–≤ TheGame</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();

        const Download = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>);
        const Plus = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>);
        const Trash = () => (<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>);
        const Edit = () => (<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>);
        const Calendar = () => (<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>);
        const TrendingUp = () => (<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>);
        const BarChart = () => (<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>);
        const Users = () => (<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>);
        const X = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>);

        function FinanceTracker() {
            const [activeTab, setActiveTab] = useState('monthly');
            const [showModal, setShowModal] = useState(false);
            const [editingIndex, setEditingIndex] = useState(null);
            const [modalType, setModalType] = useState('monthly');
            const [loading, setLoading] = useState(true);
            
            const tabs = [
                { id: 'monthly', name: '–ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç', icon: Calendar },
                { id: 'expenses', name: '–†–∞—Å—Ö–æ–¥—ã', icon: TrendingUp },
                { id: 'passive', name: '–ü–∞—Å—Å–∏–≤–Ω—ã–π', icon: BarChart },
                { id: 'individual', name: '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∫–∏', icon: Users },
                { id: 'students', name: '–ë–∞–∑–∞ —É—á–µ–Ω–∏–∫–æ–≤', icon: Users },
                { id: 'analytics', name: '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞', icon: BarChart },
                { id: 'summary', name: '–°–≤–æ–¥–∫–∞', icon: BarChart },
                { id: 'results', name: '–ü–æ –º–µ—Å—è—Ü–∞–º', icon: Calendar },
            ];

            const locations = [
                '–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ –ë—É–¥–µ–Ω–Ω–æ–≥–æ',
                '–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ –ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è',
                '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∫–∏ –õ–∞—Ç–∏–Ω—Å–∫–∏–π',
                '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∫–∏ –ü—Ä–æ–∞–º',
                '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∫–∏ –í–Ω—É–∫–æ–≤–æ',
                '–ê—Ä–µ–Ω–¥–∞ –ë—É–¥–µ–Ω–Ω–æ–≥–æ'
            ];

            // –û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —á–µ—Ä–µ–∑ Telegram CloudStorage
            const loadFromCloud = async (key, defaultData) => {
                try {
                    if (tg.CloudStorage) {
                        return new Promise((resolve) => {
                            tg.CloudStorage.getItem(key, (error, value) => {
                                if (!error && value) {
                                    try {
                                        resolve(JSON.parse(value));
                                    } catch {
                                        resolve(defaultData);
                                    }
                                } else {
                                    resolve(defaultData);
                                }
                            });
                        });
                    } else {
                        // Fallback –Ω–∞ localStorage –µ—Å–ª–∏ CloudStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
                        const saved = localStorage.getItem(key);
                        return saved ? JSON.parse(saved) : defaultData;
                    }
                } catch {
                    return defaultData;
                }
            };

            const saveToCloud = async (key, data) => {
                try {
                    const value = JSON.stringify(data);
                    if (tg.CloudStorage) {
                        tg.CloudStorage.setItem(key, value);
                    }
                    // –î—É–±–ª–∏—Ä—É–µ–º –≤ localStorage –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
                    localStorage.setItem(key, value);
                } catch (error) {
                    console.error('Save error:', error);
                }
            };

            const [monthlyData, setMonthlyData] = useState([]);
            const [expenses, setExpenses] = useState([]);
            const [passive, setPassive] = useState([]);
            const [individual, setIndividual] = useState([]);
            const [monthlyResults, setMonthlyResults] = useState([]);
            const [students, setStudents] = useState([]);

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
            useEffect(() => {
                const loadAllData = async () => {
                    const monthly = await loadFromCloud('monthlyData', []);
                    const exp = await loadFromCloud('expenses', []);
                    const pass = await loadFromCloud('passive', []);
                    const indiv = await loadFromCloud('individual', []);
                    const results = await loadFromCloud('monthlyResults', []);
                    const studs = await loadFromCloud('students', []);
                    
                    setMonthlyData(monthly);
                    setExpenses(exp);
                    setPassive(pass);
                    setIndividual(indiv);
                    setMonthlyResults(results);
                    setStudents(studs);
                    setLoading(false);
                };
                loadAllData();
            }, []);

            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ–±–ª–∞–∫–æ
            useEffect(() => { if (!loading) saveToCloud('monthlyData', monthlyData); }, [monthlyData]);
            useEffect(() => { if (!loading) saveToCloud('expenses', expenses); }, [expenses]);
            useEffect(() => { if (!loading) saveToCloud('passive', passive); }, [passive]);
            useEffect(() => { if (!loading) saveToCloud('individual', individual); }, [individual]);
            useEffect(() => { if (!loading) saveToCloud('monthlyResults', monthlyResults); }, [monthlyResults]);
            useEffect(() => { if (!loading) saveToCloud('students', students); }, [students]);

            const [formData, setFormData] = useState({});

            const totalMonthlyIncome = monthlyData.reduce((sum, item) => sum + (item.income || 0), 0);
            const totalMonthlyExpense = monthlyData.reduce((sum, item) => sum + (item.expense || 0), 0);
            const totalMonthlyProfit = monthlyData.reduce((sum, item) => sum + (item.profit || 0), 0);
            const totalExpenses = expenses.reduce((sum, item) => sum + (item.amount || 0), 0);
            const totalPassive = passive.reduce((sum, item) => sum + (item.monthly || 0), 0);
            const totalIndividual = individual.reduce((sum, item) => sum + (item.income || 0), 0);
            
            // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
            const totalStudents = students.length;
            const activeStudents = students.filter(s => s.status === '–ê–∫—Ç–∏–≤–Ω—ã–π').length;
            const avgIncomePerStudent = totalStudents > 0 ? Math.round((totalMonthlyIncome + totalIndividual) / totalStudents) : 0;
            const progressToGoal = Math.round(((totalMonthlyProfit + totalIndividual + totalPassive - totalExpenses) / 1000000) * 100);

            const formatNumber = (num) => new Intl.NumberFormat('ru-RU').format(num);

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center">
                        <div className="text-white text-xl">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
                    </div>
                );
            }

            const openModal = (type, index = null) => {
                setModalType(type);
                setEditingIndex(index);
                
                if (index !== null) {
                    if (type === 'monthly') setFormData({...monthlyData[index]});
                    if (type === 'expenses') setFormData({...expenses[index]});
                    if (type === 'passive') setFormData({...passive[index]});
                    if (type === 'individual') setFormData({...individual[index]});
                    if (type === 'results') setFormData({...monthlyResults[index]});
                    if (type === 'students') setFormData({...students[index]});
                } else {
                    setFormData({});
                }
                setShowModal(true);
            };

            const saveData = () => {
                if (modalType === 'monthly') {
                    const income = parseFloat(formData.income) || 0;
                    const expense = parseFloat(formData.expense) || 0;
                    const newData = {
                        date: formData.date || '',
                        location: formData.location || '',
                        type: formData.type || '',
                        teacher: formData.teacher || '',
                        people: parseInt(formData.people) || 0,
                        income: income,
                        expense: expense,
                        profit: income - expense,
                        note: formData.note || ''
                    };
                    if (editingIndex !== null) {
                        const updated = [...monthlyData];
                        updated[editingIndex] = newData;
                        setMonthlyData(updated);
                    } else {
                        setMonthlyData([...monthlyData, newData]);
                    }
                } else if (modalType === 'expenses') {
                    const newData = {
                        item: formData.item || '',
                        amount: parseFloat(formData.amount) || 0,
                        comment: formData.comment || ''
                    };
                    if (editingIndex !== null) {
                        const updated = [...expenses];
                        updated[editingIndex] = newData;
                        setExpenses(updated);
                    } else {
                        setExpenses([...expenses, newData]);
                    }
                } else if (modalType === 'passive') {
                    const newData = {
                        source: formData.source || '',
                        monthly: parseFloat(formData.monthly) || 0,
                        capital: parseFloat(formData.capital) || 0,
                        rate: parseFloat(formData.rate) || 0
                    };
                    if (editingIndex !== null) {
                        const updated = [...passive];
                        updated[editingIndex] = newData;
                        setPassive(updated);
                    } else {
                        setPassive([...passive, newData]);
                    }
                } else if (modalType === 'individual') {
                    const hours = parseFloat(formData.hours) || 0;
                    const rate = parseFloat(formData.rate) || 0;
                    const newData = {
                        date: formData.date || '',
                        client: formData.client || '',
                        location: formData.location || '',
                        hours: hours,
                        rate: rate,
                        income: hours * rate,
                        note: formData.note || ''
                    };
                    if (editingIndex !== null) {
                        const updated = [...individual];
                        updated[editingIndex] = newData;
                        setIndividual(updated);
                    } else {
                        setIndividual([...individual, newData]);
                    }
                } else if (modalType === 'results') {
                    const newData = {
                        month: formData.month || '',
                        year: formData.year || '',
                        groupIncome: parseFloat(formData.groupIncome) || 0,
                        individualIncome: parseFloat(formData.individualIncome) || 0,
                        passiveIncome: parseFloat(formData.passiveIncome) || 0,
                        expenses: parseFloat(formData.expenses) || 0,
                        profit: (parseFloat(formData.groupIncome) || 0) + (parseFloat(formData.individualIncome) || 0) + (parseFloat(formData.passiveIncome) || 0) - (parseFloat(formData.expenses) || 0),
                        note: formData.note || ''
                    };
                    if (editingIndex !== null) {
                        const updated = [...monthlyResults];
                        updated[editingIndex] = newData;
                        setMonthlyResults(updated);
                    } else {
                        setMonthlyResults([...monthlyResults, newData]);
                    }
                } else if (modalType === 'students') {
                    const newData = {
                        name: formData.name || '',
                        phone: formData.phone || '',
                        group: formData.group || '',
                        subscription: formData.subscription || '',
                        expiryDate: formData.expiryDate || '',
                        status: formData.status || '–ê–∫—Ç–∏–≤–Ω—ã–π',
                        note: formData.note || ''
                    };
                    if (editingIndex !== null) {
                        const updated = [...students];
                        updated[editingIndex] = newData;
                        setStudents(updated);
                    } else {
                        setStudents([...students, newData]);
                    }
                }

                setShowModal(false);
                setFormData({});
            };

            const deleteItem = (type, index) => {
                if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?')) return;
                
                if (type === 'monthly') setMonthlyData(monthlyData.filter((_, i) => i !== index));
                if (type === 'expenses') setExpenses(expenses.filter((_, i) => i !== index));
                if (type === 'passive') setPassive(passive.filter((_, i) => i !== index));
                if (type === 'individual') setIndividual(individual.filter((_, i) => i !== index));
                if (type === 'results') setMonthlyResults(monthlyResults.filter((_, i) => i !== index));
                if (type === 'students') setStudents(students.filter((_, i) => i !== index));
            };

            const exportSummaryToCSV = () => {
                let csv = '–°–≤–æ–¥–∫–∞ –∑–∞ –º–µ—Å—è—Ü - TheGame\n\n';
                csv += '–°—Ç–∞—Ç—å—è,–°—É–º–º–∞\n';
                csv += `–ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç (–¥–æ—Ö–æ–¥),${totalMonthlyIncome}‚ÇΩ\n`;
                csv += `–ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç (—Ä–∞—Å—Ö–æ–¥),-${totalMonthlyExpense}‚ÇΩ\n`;
                csv += `–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è,${totalIndividual}‚ÇΩ\n`;
                csv += `–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥,${totalPassive}‚ÇΩ\n`;
                csv += `–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã,-${totalExpenses}‚ÇΩ\n`;
                csv += `–ß–ò–°–¢–ê–Ø –ü–†–ò–ë–´–õ–¨,${totalMonthlyProfit + totalIndividual + totalPassive - totalExpenses}‚ÇΩ\n`;
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'summary_thegame.csv';
                link.click();
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white p-4">
                    <div className="max-w-7xl mx-auto">
                        <div className="mb-6">
                            <h1 className="text-3xl font-bold mb-2">üí∞ –£—á—ë—Ç –¥–æ—Ö–æ–¥–æ–≤ TheGame</h1>
                            <p className="text-slate-400">–ü—É—Ç—å –æ—Ç 385–ö –∫ 1–ú | 2025-2026</p>
                            
                            <div className="mt-4 bg-slate-800 rounded-lg p-4 border border-slate-700">
                                <div className="flex justify-between items-center mb-2">
                                    <span className="text-slate-300">–ü—Ä–æ–≥—Ä–µ—Å—Å –∫ —Ü–µ–ª–∏</span>
                                    <span className="text-2xl font-bold text-blue-400">{progressToGoal}%</span>
                                </div>
                                <div className="w-full bg-slate-700 rounded-full h-4">
                                    <div 
                                        className="bg-gradient-to-r from-blue-600 to-green-500 h-4 rounded-full transition-all duration-500"
                                        style={{width: `${Math.min(progressToGoal, 100)}%`}}
                                    ></div>
                                </div>
                                <div className="flex justify-between text-xs text-slate-400 mt-1">
                                    <span>385,000‚ÇΩ</span>
                                    <span>1,000,000‚ÇΩ</span>
                                </div>
                            </div>
                        </div>

                        <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
                            {tabs.map((tab) => {
                                const Icon = tab.icon;
                                return (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`flex items-center gap-2 px-4 py-2 rounded-lg transition whitespace-nowrap ${
                                            activeTab === tab.id ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
                                        }`}
                                    >
                                        <Icon />
                                        {tab.name}
                                    </button>
                                );
                            })}
                        </div>

                        <div className="bg-slate-800 rounded-lg border border-slate-700 p-4">
                            {activeTab === 'monthly' && (
                                <div>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-bold">üìÖ –ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç</h2>
                                        <button onClick={() => openModal('monthly')} className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded text-sm">
                                            <Plus />–î–æ–±–∞–≤–∏—Ç—å
                                        </button>
                                    </div>
                                    
                                    {monthlyData.length === 0 ? (
                                        <div className="text-center py-8 text-slate-400">
                                            –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.
                                        </div>
                                    ) : (
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-sm">
                                                <thead>
                                                    <tr className="border-b border-slate-700">
                                                        <th className="text-left py-2 px-2">–î–∞—Ç–∞</th>
                                                        <th className="text-left py-2 px-2">–õ–æ–∫–∞—Ü–∏—è</th>
                                                        <th className="text-right py-2 px-2">–õ—é–¥–µ–π</th>
                                                        <th className="text-right py-2 px-2">–î–æ—Ö–æ–¥</th>
                                                        <th className="text-right py-2 px-2">–†–∞—Å—Ö–æ–¥</th>
                                                        <th className="text-right py-2 px-2">–ü—Ä–∏–±—ã–ª—å</th>
                                                        <th className="text-center py-2 px-2">–î–µ–π—Å—Ç–≤–∏—è</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {monthlyData.map((row, idx) => (
                                                        <tr key={idx} className="border-b border-slate-700/50">
                                                            <td className="py-2 px-2">{row.date}</td>
                                                            <td className="py-2 px-2">{row.location}</td>
                                                            <td className="text-right py-2 px-2">{row.people}</td>
                                                            <td className="text-right py-2 px-2 text-green-400">{formatNumber(row.income)}‚ÇΩ</td>
                                                            <td className="text-right py-2 px-2 text-red-400">{formatNumber(row.expense)}‚ÇΩ</td>
                                                            <td className="text-right py-2 px-2 text-blue-400 font-bold">{formatNumber(row.profit)}‚ÇΩ</td>
                                                            <td className="py-2 px-2">
                                                                <div className="flex gap-2 justify-center">
                                                                    <button onClick={() => openModal('monthly', idx)} className="text-blue-400">
                                                                        <Edit />
                                                                    </button>
                                                                    <button onClick={() => deleteItem('monthly', idx)} className="text-red-400">
                                                                        <Trash />
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                                <tfoot className="bg-slate-900/50">
                                                    <tr className="font-bold">
                                                        <td colSpan="3" className="py-2 px-2">–ò–¢–û–ì–û:</td>
                                                        <td className="text-right py-2 px-2 text-green-400">{formatNumber(totalMonthlyIncome)}‚ÇΩ</td>
                                                        <td className="text-right py-2 px-2 text-red-400">{formatNumber(totalMonthlyExpense)}‚ÇΩ</td>
                                                        <td className="text-right py-2 px-2 text-blue-400">{formatNumber(totalMonthlyProfit)}‚ÇΩ</td>
                                                        <td></td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    )}
                                </div>
                            )}

                            {activeTab === 'expenses' && (
                                <div>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-bold">üí∏ –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã</h2>
                                        <button onClick={() => openModal('expenses')} className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded text-sm">
                                            <Plus />–î–æ–±–∞–≤–∏—Ç—å
                                        </button>
                                    </div>
                                    {expenses.length === 0 ? (
                                        <div className="text-center py-8 text-slate-400">
                                            –ù–µ—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.
                                        </div>
                                    ) : (
                                        <div className="overflow-x-auto">
                                            <table className="w-full">
                                                <thead>
                                                    <tr className="border-b border-slate-700">
                                                        <th className="text-left py-2 px-2">–°—Ç–∞—Ç—å—è —Ä–∞—Å—Ö–æ–¥–∞</th>
                                                        <th className="text-right py-2 px-2">–°—É–º–º–∞/–º–µ—Å</th>
                                                        <th className="text-left py-2 px-2">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                                                        <th className="text-center py-2 px-2">–î–µ–π—Å—Ç–≤–∏—è</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {expenses.map((row, idx) => (
                                                        <tr key={idx} className="border-b border-slate-700/50">
                                                            <td className="py-2 px-2">{row.item}</td>
                                                            <td className="text-right py-2 px-2 text-red-400 font-semibold">{formatNumber(row.amount)}‚ÇΩ</td>
                                                            <td className="py-2 px-2 text-slate-400 text-sm">{row.comment}</td>
                                                            <td className="py-2 px-2">
                                                                <div className="flex gap-2 justify-center">
                                                                    <button onClick={() => openModal('expenses', idx)} className="text-blue-400">
                                                                        <Edit />
                                                                    </button>
                                                                    <button onClick={() => deleteItem('expenses', idx)} className="text-red-400">
                                                                        <Trash />
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                                <tfoot className="bg-slate-900/50">
                                                    <tr className="font-bold">
                                                        <td className="py-2 px-2">–ò–¢–û–ì–û:</td>
                                                        <td className="text-right py-2 px-2 text-red-400">{formatNumber(totalExpenses)}‚ÇΩ</td>
                                                        <td colSpan="2"></td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    )}
                                </div>
                            )}

                            {activeTab === 'passive' && (
                                <div>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-bold">üí∞ –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥</h2>
                                        <button onClick={() => openModal('passive')} className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded text-sm">
                                            <Plus />–î–æ–±–∞–≤–∏—Ç—å
                                        </button>
                                    </div>
                                    {passive.length === 0 ? (
                                        <div className="text-center py-8 text-slate-400">
                                            –ù–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å".
                                        </div>
                                    ) : (
                                        <div className="overflow-x-auto">
                                            <table className="w-full">
                                                <thead>
                                                    <tr className="border-b border-slate-700">
                                                        <th className="text-left py-2 px-2">–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                                                        <th className="text-right py-2 px-2">–°—É–º–º–∞/–º–µ—Å</th>
                                                        <th className="text-right py-2 px-2">–ö–∞–ø–∏—Ç–∞–ª</th>
                                                        <th className="text-right py-2 px-2">–°—Ç–∞–≤–∫–∞ %</th>
                                                        <th className="text-center py-2 px-2">–î–µ–π—Å—Ç–≤–∏—è</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {passive.map((row, idx) => (
                                                        <tr key={idx} className="border-b border-slate-700/50">
                                                            <td className="py-2 px-2">{row.source}</td>
                                                            <td className="text-right py-2 px-2 text-green-400 font-semibold">{formatNumber(row.monthly)}‚ÇΩ</td>
                                                            <td className="text-right py-2 px-2">{row.capital ? formatNumber(row.capital) + '‚ÇΩ' : '‚Äî'}</td>
                                                            <td className="text-right py-2 px-2">{row.rate ? row.rate + '%' : '‚Äî'}</td>
                                                            <td className="py-2 px-2">
                                                                <div className="flex gap-2 justify-center">
                                                                    <button onClick={() => openModal('passive', idx)} className="text-blue-400">
                                                                        <Edit />
                                                                    </button>
                                                                    <button onClick={() => deleteItem('passive', idx)} className="text-red-400">
                                                                        <Trash />
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                                <tfoot className="bg-slate-900/50">
                                                    <tr className="font-bold">
                                                        <td className="py-2 px-2">–ò–¢–û–ì–û:</td>
                                                        <td className="text-right py-2 px-2 text-green-400">{formatNumber(totalPassive)}‚ÇΩ</td>
                                                        <td colSpan="3"></td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    )}
                                </div>
                            )}

                            {activeTab === 'individual' && (
                                <div>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-bold">üë§ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è</h2>
                                        <button onClick={() => openModal('individual')} className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded text-sm">
                                            <Plus />–î–æ–±–∞–≤–∏—Ç—å
                                        </button>
                                    </div>
                                    {individual.length === 0 ? (
                                        <div className="text-center py-8 text-slate-400">
                                            –ù–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å".
                                        </div>
                                    ) : (
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-sm">
                                                <thead>
                                                    <tr className="border-b border-slate-700">
                                                        <th className="text-left py-2 px-2">–î–∞—Ç–∞</th>
                                                        <th className="text-left py-2 px-2">–ö–ª–∏–µ–Ω—Ç</th>
                                                        <th className="text-left py-2 px-2">–õ–æ–∫–∞—Ü–∏—è</th>
                                                        <th className="text-right py-2 px-2">–ß–∞—Å–æ–≤</th>
                                                        <th className="text-right py-2 px-2">–°—Ç–∞–≤–∫–∞</th>
                                                        <th className="text-right py-2 px-2">–î–æ—Ö–æ–¥</th>
                                                        <th className="text-center py-2 px-2">–î–µ–π—Å—Ç–≤–∏—è</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {individual.map((row, idx) => (
                                                        <tr key={idx} className="border-b border-slate-700/50">
                                                            <td className="py-2 px-2">{row.date}</td>
                                                            <td className="py-2 px-2">{row.client}</td>
                                                            <td className="py-2 px-2">{row.location}</td>
                                                            <td className="text-right py-2 px-2">{row.hours}</td>
                                                            <td className="text-right py-2 px-2">{formatNumber(row.rate)}‚ÇΩ</td>
                                                            <td className="text-right py-2 px-2 text-green-400 font-semibold">{formatNumber(row.income)}‚ÇΩ</td>
                                                            <td className="py-2 px-2">
                                                                <div className="flex gap-2 justify-center">
                                                                    <button onClick={() => openModal('individual', idx)} className="text-blue-400">
                                                                        <Edit />
                                                                    </button>
                                                                    <button onClick={() => deleteItem('individual', idx)} className="text-red-400">
                                                                        <Trash />
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                                <tfoot className="bg-slate-900/50">
                                                    <tr className="font-bold">
                                                        <td colSpan="5" className="py-2 px-2">–ò–¢–û–ì–û:</td>
                                                        <td className="text-right py-2 px-2 text-green-400">{formatNumber(totalIndividual)}‚ÇΩ</td>
                                                        <td></td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    )}
                                </div>
                            )}

                            {activeTab === 'students' && (
                                <div>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-bold">üë• –ë–∞–∑–∞ —É—á–µ–Ω–∏–∫–æ–≤</h2>
                                        <button onClick={() => openModal('students')} className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded text-sm">
                                            <Plus />–î–æ–±–∞–≤–∏—Ç—å
                                        </button>
                                    </div>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                        <div className="bg-slate-900/50 p-4 rounded-lg">
                                            <div className="text-slate-400 text-sm">–í—Å–µ–≥–æ —É—á–µ–Ω–∏–∫–æ–≤</div>
                                            <div className="text-2xl font-bold text-blue-400">{totalStudents}</div>
                                        </div>
                                        <div className="bg-slate-900/50 p-4 rounded-lg">
                                            <div className="text-slate-400 text-sm">–ê–∫—Ç–∏–≤–Ω—ã–µ</div>
                                            <div className="text-2xl font-bold text-green-400">{activeStudents}</div>
                                        </div>
                                        <div className="bg-slate-900/50 p-4 rounded-lg">
                                            <div className="text-slate-400 text-sm">–°—Ä–µ–¥–Ω–∏–π –¥–æ—Ö–æ–¥</div>
                                            <div className="text-2xl font-bold text-yellow-400">{formatNumber(avgIncomePerStudent)}‚ÇΩ</div>
                                        </div>
                                    </div>
                                    
                                    {students.length === 0 ? (
                                        <div className="text-center py-8 text-slate-400">
                                            –ù–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.
                                        </div>
                                    ) : (
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-sm">
                                                <thead>
                                                    <tr className="border-b border-slate-700">
                                                        <th className="text-left py-2 px-2">–ò–º—è</th>
                                                        <th className="text-left py-2 px-2">–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                                        <th className="text-left py-2 px-2">–ì—Ä—É–ø–ø–∞</th>
                                                        <th className="text-left py-2 px-2">–ê–±–æ–Ω–µ–º–µ–Ω—Ç</th>
                                                        <th className="text-left py-2 px-2">–î–æ</th>
                                                        <th className="text-left py-2 px-2">–°—Ç–∞—Ç—É—Å</th>
                                                        <th className="text-center py-2 px-2">–î–µ–π—Å—Ç–≤–∏—è</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {students.map((student, idx) => (
                                                        <tr key={idx} className="border-b border-slate-700/50">
                                                            <td className="py-2 px-2">{student.name}</td>
                                                            <td className="py-2 px-2">{student.phone}</td>
                                                            <td className="py-2 px-2">{student.group}</td>
                                                            <td className="py-2 px-2">{student.subscription}</td>
                                                            <td className="py-2 px-2">{student.expiryDate}</td>
                                                            <td className="py-2 px-2">
                                                                <span className={`px-2 py-1 rounded text-xs ${
                                                                    student.status === '–ê–∫—Ç–∏–≤–Ω—ã–π' ? 'bg-green-900/50 text-green-400' : 'bg-red-900/50 text-red-400'
                                                                }`}>
                                                                    {student.status}
                                                                </span>
                                                            </td>
                                                            <td className="py-2 px-2">
                                                                <div className="flex gap-2 justify-center">
                                                                    <button onClick={() => openModal('students', idx)} className="text-blue-400">
                                                                        <Edit />
                                                                    </button>
                                                                    <button onClick={() => deleteItem('students', idx)} className="text-red-400">
                                                                        <Trash />
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    )}
                                </div>
                            )}

                            {activeTab === 'analytics' && (
                                <div>
                                    <h2 className="text-xl font-bold mb-4">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ KPI</h2>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className="bg-slate-900/50 p-6 rounded-lg border border-slate-700">
                                            <h3 className="text-lg font-bold mb-4 text-green-400">üí∞ –§–∏–Ω–∞–Ω—Å—ã</h3>
                                            <div className="space-y-3">
                                                <div className="flex justify-between">
                                                    <span className="text-slate-300">–¢–µ–∫—É—â–∏–π –¥–æ—Ö–æ–¥ (–º–µ—Å—è—Ü):</span>
                                                    <span className="font-semibold text-green-400">{formatNumber(totalMonthlyProfit + totalIndividual + totalPassive)}‚ÇΩ</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-slate-300">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å:</span>
                                                    <span className="font-semibold text-blue-400">{formatNumber(totalMonthlyProfit + totalIndividual + totalPassive - totalExpenses)}‚ÇΩ</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-slate-300">–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å:</span>
                                                    <span className="font-semibold text-yellow-400">
                                                        {totalMonthlyIncome > 0 ? Math.round(((totalMonthlyProfit + totalIndividual + totalPassive - totalExpenses) / (totalMonthlyIncome + totalIndividual + totalPassive)) * 100) : 0}%
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-slate-900/50 p-6 rounded-lg border border-slate-700">
                                            <h3 className="text-lg font-bold mb-4 text-blue-400">üë• –£—á–µ–Ω–∏–∫–∏</h3>
                                            <div className="space-y-3">
                                                <div className="flex justify-between">
                                                    <span className="text-slate-300">–í—Å–µ–≥–æ —É—á–µ–Ω–∏–∫–æ–≤:</span>
                                                    <span className="font-semibold">{totalStudents}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-slate-300">–ê–∫—Ç–∏–≤–Ω—ã—Ö:</span>
                                                    <span className="font-semibold text-green-400">{activeStudents}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-slate-300">–°—Ä–µ–¥–Ω–∏–π –¥–æ—Ö–æ–¥ —Å —É—á–µ–Ω–∏–∫–∞:</span>
                                                    <span className="font-semibold text-yellow-400">{formatNumber(avgIncomePerStudent)}‚ÇΩ</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-slate-900/50 p-6 rounded-lg border border-slate-700">
                                            <h3 className="text-lg font-bold mb-4 text-purple-400">üéØ –¶–µ–ª–∏</h3>
                                            <div className="space-y-3">
                                                <div className="flex justify-between">
                                                    <span className="text-slate-300">–¢–µ–∫—É—â–∏–π: 385,000‚ÇΩ</span>
                                                    <span className="font-semibold">‚Üí</span>
                                                    <span className="text-slate-300">–¶–µ–ª—å: 1,000,000‚ÇΩ</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-slate-300">–û—Å—Ç–∞–ª–æ—Å—å:</span>
                                                    <span className="font-semibold text-red-400">{formatNumber(1000000 - (totalMonthlyProfit + totalIndividual + totalPassive - totalExpenses))}‚ÇΩ</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-slate-300">–ü—Ä–æ–≥—Ä–µ—Å—Å:</span>
                                                    <span className="font-semibold text-blue-400">{progressToGoal}%</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-slate-900/50 p-6 rounded-lg border border-slate-700">
                                            <h3 className="text-lg font-bold mb-4 text-orange-400">üìà –†–æ—Å—Ç</h3>
                                            <div className="space-y-3">
                                                <div>
                                                    <div className="text-slate-300 text-sm mb-1">–ß—Ç–æ–±—ã –¥–æ—Å—Ç–∏—á—å 1–ú –Ω—É–∂–Ω–æ:</div>
                                                    <div className="text-xs text-slate-400">
                                                        ‚Ä¢ –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ—Ö–æ–¥ –Ω–∞ {formatNumber(Math.round((1000000 - (totalMonthlyProfit + totalIndividual + totalPassive - totalExpenses)) / 12))}‚ÇΩ/–º–µ—Å
                                                    </div>
                                                    <div className="text-xs text-slate-400 mt-1">
                                                        ‚Ä¢ –ò–ª–∏ –ø—Ä–∏–≤–ª–µ—á—å –µ—â–µ ~{Math.round((1000000 - (totalMonthlyProfit + totalIndividual + totalPassive - totalExpenses)) / (avgIncomePerStudent || 3000))} —É—á–µ–Ω–∏–∫–æ–≤
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="mt-6 bg-gradient-to-r from-blue-900/50 to-purple-900/50 p-6 rounded-lg border-2 border-blue-600">
                                        <h3 className="text-xl font-bold mb-2">üéâ –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ü–µ–ª–∏</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                                            <div className="text-center">
                                                <div className="text-2xl font-bold text-green-400">500,000‚ÇΩ</div>
                                                <div className="text-sm text-slate-400">–ü–µ—Ä–≤–∞—è —Ü–µ–ª—å</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-2xl font-bold text-yellow-400">750,000‚ÇΩ</div>
                                                <div className="text-sm text-slate-400">–í—Ç–æ—Ä–∞—è —Ü–µ–ª—å</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-2xl font-bold text-blue-400">1,000,000‚ÇΩ</div>
                                                <div className="text-sm text-slate-400">–§–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–ª—å</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'summary' && (
                                <div>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-bold">üìä –°–≤–æ–¥–∫–∞ –∑–∞ –º–µ—Å—è—Ü</h2>
                                        <button onClick={exportSummaryToCSV} className="flex items-center gap-2 bg-green-600 hover:bg-green-700 px-3 py-2 rounded text-sm">
                                            <Download />–≠–∫—Å–ø–æ—Ä—Ç CSV
                                        </button>
                                    </div>
                                    <div className="space-y-3">
                                        <div className="flex justify-between p-3 bg-slate-900/50 rounded">
                                            <span>–ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç (–¥–æ—Ö–æ–¥):</span>
                                            <span className="font-bold text-green-400">{formatNumber(totalMonthlyIncome)}‚ÇΩ</span>
                                        </div>
                                        <div className="flex justify-between p-3 bg-slate-900/50 rounded">
                                            <span>–ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç (—Ä–∞—Å—Ö–æ–¥):</span>
                                            <span className="font-bold text-red-400">-{formatNumber(totalMonthlyExpense)}‚ÇΩ</span>
                                        </div>
                                        <div className="flex justify-between p-3 bg-slate-900/50 rounded">
                                            <span>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è:</span>
                                            <span className="font-bold text-green-400">{formatNumber(totalIndividual)}‚ÇΩ</span>
                                        </div>
                                        <div className="flex justify-between p-3 bg-slate-900/50 rounded">
                                            <span>–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥:</span>
                                            <span className="font-bold text-green-400">{formatNumber(totalPassive)}‚ÇΩ</span>
                                        </div>
                                        <div className="flex justify-between p-3 bg-slate-900/50 rounded">
                                            <span>–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã:</span>
                                            <span className="font-bold text-red-400">-{formatNumber(totalExpenses)}‚ÇΩ</span>
                                        </div>
                                        <div className="flex justify-between p-4 bg-blue-900/50 rounded border-2 border-blue-600 mt-4">
                                            <span className="text-lg font-bold">–ß–ò–°–¢–ê–Ø –ü–†–ò–ë–´–õ–¨:</span>
                                            <span className="text-xl font-bold text-blue-400">{formatNumber(totalMonthlyProfit + totalIndividual + totalPassive - totalExpenses)}‚ÇΩ</span>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'results' && (
                                <div>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-bold">üìÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –º–µ—Å—è—Ü–∞–º</h2>
                                        <button onClick={() => openModal('results')} className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded text-sm">
                                            <Plus />–î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—è—Ü
                                        </button>
                                    </div>
                                    {monthlyResults.length === 0 ? (
                                        <div className="text-center py-8 text-slate-400">
                                            –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—è—Ü" —á—Ç–æ–±—ã –≤–Ω–µ—Å—Ç–∏ –∏—Ç–æ–≥–∏.
                                        </div>
                                    ) : (
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-sm">
                                                <thead>
                                                    <tr className="border-b border-slate-700">
                                                        <th className="text-left py-2 px-2">–ú–µ—Å—è—Ü</th>
                                                        <th className="text-right py-2 px-2">–ì—Ä—É–ø–ø–æ–≤—ã–µ</th>
                                                        <th className="text-right py-2 px-2">–ò–Ω–¥–∏–≤–∏–¥.</th>
                                                        <th className="text-right py-2 px-2">–ü–∞—Å—Å–∏–≤–Ω—ã–π</th>
                                                        <th className="text-right py-2 px-2">–†–∞—Å—Ö–æ–¥—ã</th>
                                                        <th className="text-right py-2 px-2">–ü—Ä–∏–±—ã–ª—å</th>
                                                        <th className="text-center py-2 px-2">–î–µ–π—Å—Ç–≤–∏—è</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {monthlyResults.map((row, idx) => (
                                                        <tr key={idx} className="border-b border-slate-700/50">
                                                            <td className="py-2 px-2">{row.month} {row.year}</td>
                                                            <td className="text-right py-2 px-2 text-green-400">{formatNumber(row.groupIncome)}‚ÇΩ</td>
                                                            <td className="text-right py-2 px-2 text-green-400">{formatNumber(row.individualIncome)}‚ÇΩ</td>
                                                            <td className="text-right py-2 px-2 text-green-400">{formatNumber(row.passiveIncome)}‚ÇΩ</td>
                                                            <td className="text-right py-2 px-2 text-red-400">{formatNumber(row.expenses)}‚ÇΩ</td>
                                                            <td className="text-right py-2 px-2 text-blue-400 font-bold">{formatNumber(row.profit)}‚ÇΩ</td>
                                                            <td className="py-2 px-2">
                                                                <div className="flex gap-2 justify-center">
                                                                    <button onClick={() => openModal('results', idx)} className="text-blue-400">
                                                                        <Edit />
                                                                    </button>
                                                                    <button onClick={() => deleteItem('results', idx)} className="text-red-400">
                                                                        <Trash />
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                                <tfoot className="bg-slate-900/50">
                                                    <tr className="font-bold">
                                                        <td className="py-2 px-2">–ò–¢–û–ì–û:</td>
                                                        <td className="text-right py-2 px-2 text-green-400">{formatNumber(monthlyResults.reduce((sum, r) => sum + r.groupIncome, 0))}‚ÇΩ</td>
                                                        <td className="text-right py-2 px-2 text-green-400">{formatNumber(monthlyResults.reduce((sum, r) => sum + r.individualIncome, 0))}‚ÇΩ</td>
                                                        <td className="text-right py-2 px-2 text-green-400">{formatNumber(monthlyResults.reduce((sum, r) => sum + r.passiveIncome, 0))}‚ÇΩ</td>
                                                        <td className="text-right py-2 px-2 text-red-400">{formatNumber(monthlyResults.reduce((sum, r) => sum + r.expenses, 0))}‚ÇΩ</td>
                                                        <td className="text-right py-2 px-2 text-blue-400">{formatNumber(monthlyResults.reduce((sum, r) => sum + r.profit, 0))}‚ÇΩ</td>
                                                        <td></td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>

                    {showModal && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => setShowModal(false)}>
                            <div className="bg-slate-800 rounded-lg p-6 max-w-md w-full max-h-screen overflow-y-auto border border-slate-700" onClick={(e) => e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-bold">{editingIndex !== null ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '–î–æ–±–∞–≤–∏—Ç—å'}</h3>
                                    <button onClick={() => setShowModal(false)} className="text-slate-400 hover:text-white">
                                        <X />
                                    </button>
                                </div>

                                <div className="space-y-3">
                                    {modalType === 'monthly' && (
                                        <>
                                            <input
                                                type="text"
                                                placeholder="–î–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 06.12)"
                                                value={formData.date || ''}
                                                onChange={(e) => setFormData({...formData, date: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <select
                                                value={formData.location || ''}
                                                onChange={(e) => setFormData({...formData, location: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            >
                                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é</option>
                                                {locations.map((loc, idx) => (
                                                    <option key={idx} value={loc}>{loc}</option>
                                                ))}
                                            </select>
                                            <input
                                                type="text"
                                                placeholder="–¢–∏–ø –∑–∞–Ω—è—Ç–∏—è"
                                                value={formData.type || ''}
                                                onChange={(e) => setFormData({...formData, type: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="text"
                                                placeholder="–ü–µ–¥–∞–≥–æ–≥"
                                                value={formData.teacher || ''}
                                                onChange={(e) => setFormData({...formData, teacher: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="number"
                                                placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π"
                                                value={formData.people || ''}
                                                onChange={(e) => setFormData({...formData, people: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="number"
                                                placeholder="–î–æ—Ö–æ–¥ (‚ÇΩ)"
                                                value={formData.income || ''}
                                                onChange={(e) => setFormData({...formData, income: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="number"
                                                placeholder="–†–∞—Å—Ö–æ–¥ (‚ÇΩ)"
                                                value={formData.expense || ''}
                                                onChange={(e) => setFormData({...formData, expense: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="text"
                                                placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
                                                value={formData.note || ''}
                                                onChange={(e) => setFormData({...formData, note: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                        </>
                                    )}

                                    {modalType === 'expenses' && (
                                        <>
                                            <input
                                                type="text"
                                                placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞"
                                                value={formData.item || ''}
                                                onChange={(e) => setFormData({...formData, item: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="number"
                                                placeholder="–°—É–º–º–∞ (‚ÇΩ)"
                                                value={formData.amount || ''}
                                                onChange={(e) => setFormData({...formData, amount: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="text"
                                                placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
                                                value={formData.comment || ''}
                                                onChange={(e) => setFormData({...formData, comment: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                        </>
                                    )}

                                    {modalType === 'passive' && (
                                        <>
                                            <input
                                                type="text"
                                                placeholder="–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ—Ö–æ–¥–∞"
                                                value={formData.source || ''}
                                                onChange={(e) => setFormData({...formData, source: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="number"
                                                placeholder="–°—É–º–º–∞ –≤ –º–µ—Å—è—Ü (‚ÇΩ)"
                                                value={formData.monthly || ''}
                                                onChange={(e) => setFormData({...formData, monthly: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="number"
                                                placeholder="–ö–∞–ø–∏—Ç–∞–ª (‚ÇΩ, –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
                                                value={formData.capital || ''}
                                                onChange={(e) => setFormData({...formData, capital: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="number"
                                                placeholder="–°—Ç–∞–≤–∫–∞ % (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
                                                value={formData.rate || ''}
                                                onChange={(e) => setFormData({...formData, rate: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                        </>
                                    )}

                                    {modalType === 'individual' && (
                                        <>
                                            <input
                                                type="text"
                                                placeholder="–î–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 06.12)"
                                                value={formData.date || ''}
                                                onChange={(e) => setFormData({...formData, date: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="text"
                                                placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞"
                                                value={formData.client || ''}
                                                onChange={(e) => setFormData({...formData, client: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="text"
                                                placeholder="–õ–æ–∫–∞—Ü–∏—è"
                                                value={formData.location || ''}
                                                onChange={(e) => setFormData({...formData, location: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="number"
                                                step="0.5"
                                                placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤"
                                                value={formData.hours || ''}
                                                onChange={(e) => setFormData({...formData, hours: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="number"
                                                placeholder="–°—Ç–∞–≤–∫–∞ –∑–∞ —á–∞—Å (‚ÇΩ)"
                                                value={formData.rate || ''}
                                                onChange={(e) => setFormData({...formData, rate: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="text"
                                                placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
                                                value={formData.note || ''}
                                                onChange={(e) => setFormData({...formData, note: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                        </>
                                    )}

                                    {modalType === 'results' && (
                                        <>
                                            <select
                                                value={formData.month || ''}
                                                onChange={(e) => setFormData({...formData, month: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            >
                                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—è—Ü</option>
                                                <option value="–Ø–Ω–≤–∞—Ä—å">–Ø–Ω–≤–∞—Ä—å</option>
                                                <option value="–§–µ–≤—Ä–∞–ª—å">–§–µ–≤—Ä–∞–ª—å</option>
                                                <option value="–ú–∞—Ä—Ç">–ú–∞—Ä—Ç</option>
                                                <option value="–ê–ø—Ä–µ–ª—å">–ê–ø—Ä–µ–ª—å</option>
                                                <option value="–ú–∞–π">–ú–∞–π</option>
                                                <option value="–ò—é–Ω—å">–ò—é–Ω—å</option>
                                                <option value="–ò—é–ª—å">–ò—é–ª—å</option>
                                                <option value="–ê–≤–≥—É—Å—Ç">–ê–≤–≥—É—Å—Ç</option>
                                                <option value="–°–µ–Ω—Ç—è–±—Ä—å">–°–µ–Ω—Ç—è–±—Ä—å</option>
                                                <option value="–û–∫—Ç—è–±—Ä—å">–û–∫—Ç—è–±—Ä—å</option>
                                                <option value="–ù–æ—è–±—Ä—å">–ù–æ—è–±—Ä—å</option>
                                                <option value="–î–µ–∫–∞–±—Ä—å">–î–µ–∫–∞–±—Ä—å</option>
                                            </select>
                                            <input
                                                type="number"
                                                placeholder="–ì–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 2025)"
                                                value={formData.year || ''}
                                                onChange={(e) => setFormData({...formData, year: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="number"
                                                placeholder="–ì—Ä—É–ø–ø–æ–≤—ã–µ –∑–∞–Ω—è—Ç–∏—è (‚ÇΩ)"
                                                value={formData.groupIncome || ''}
                                                onChange={(e) => setFormData({...formData, groupIncome: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="number"
                                                placeholder="–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ (‚ÇΩ)"
                                                value={formData.individualIncome || ''}
                                                onChange={(e) => setFormData({...formData, individualIncome: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="number"
                                                placeholder="–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ (‚ÇΩ)"
                                                value={formData.passiveIncome || ''}
                                                onChange={(e) => setFormData({...formData, passiveIncome: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="number"
                                                placeholder="–†–∞—Å—Ö–æ–¥—ã (‚ÇΩ)"
                                                value={formData.expenses || ''}
                                                onChange={(e) => setFormData({...formData, expenses: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="text"
                                                placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
                                                value={formData.note || ''}
                                                onChange={(e) => setFormData({...formData, note: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                        </>
                                    )}

                                    {modalType === 'students' && (
                                        <>
                                            <input
                                                type="text"
                                                placeholder="–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è"
                                                value={formData.name || ''}
                                                onChange={(e) => setFormData({...formData, name: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="tel"
                                                placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (+7...)"
                                                value={formData.phone || ''}
                                                onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <select
                                                value={formData.group || ''}
                                                onChange={(e) => setFormData({...formData, group: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            >
                                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>
                                                <option value="–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ –ë—É–¥–µ–Ω–Ω–æ–≥–æ">–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ –ë—É–¥–µ–Ω–Ω–æ–≥–æ</option>
                                                <option value="–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ –ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è">–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ –ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è</option>
                                                <option value="–õ–∞—Ç–∏–Ω—Å–∫–∏–π">–õ–∞—Ç–∏–Ω—Å–∫–∏–π</option>
                                                <option value="–ü—Ä–æ–∞–º">–ü—Ä–æ–∞–º</option>
                                                <option value="–í–Ω—É–∫–æ–≤–æ">–í–Ω—É–∫–æ–≤–æ</option>
                                            </select>
                                            <input
                                                type="text"
                                                placeholder="–ê–±–æ–Ω–µ–º–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä: 8 –∑–∞–Ω—è—Ç–∏–π)"
                                                value={formData.subscription || ''}
                                                onChange={(e) => setFormData({...formData, subscription: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <input
                                                type="date"
                                                placeholder="–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ"
                                                value={formData.expiryDate || ''}
                                                onChange={(e) => setFormData({...formData, expiryDate: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                            <select
                                                value={formData.status || '–ê–∫—Ç–∏–≤–Ω—ã–π'}
                                                onChange={(e) => setFormData({...formData, status: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            >
                                                <option value="–ê–∫—Ç–∏–≤–Ω—ã–π">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                                                <option value="–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π</option>
                                                <option value="–ü—Ä–æ–±–Ω—ã–π">–ü—Ä–æ–±–Ω—ã–π</option>
                                            </select>
                                            <input
                                                type="text"
                                                placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
                                                value={formData.note || ''}
                                                onChange={(e) => setFormData({...formData, note: e.target.value})}
                                                className="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600 text-white"
                                            />
                                        </>
                                    )}

                                    <div className="flex gap-2 mt-4">
                                        <button onClick={saveData} className="flex-1 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded font-semibold">
                                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                        </button>
                                        <button onClick={() => setShowModal(false)} className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded">
                                            –û—Ç–º–µ–Ω–∞
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<FinanceTracker />, document.getElementById('root'));
    </script>
</body>
</html>
