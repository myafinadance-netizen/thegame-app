<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>TheGame –§–∏–Ω–∞–Ω—Å—ã</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #0b1220;
  color: #fff;
}
.header {
  padding: 18px;
  font-size: 22px;
  font-weight: 600;
}
.card {
  background: #121a2e;
  border-radius: 14px;
  padding: 14px;
  margin: 10px;
}
button {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: none;
  background: #2563eb;
  color: white;
  font-size: 16px;
  margin-top: 8px;
}
input, select {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  border: none;
  margin-top: 6px;
}
.stat {
  font-size: 26px;
  font-weight: bold;
}
.label {
  opacity: .6;
}
hr {
  border: none;
  height: 1px;
  background: #1f2937;
  margin: 12px 0;
}
</style>
</head>

<body>

<div class="header">üíº TheGame ¬∑ –§–∏–Ω–∞–Ω—Å—ã</div>

<div class="card">
  <input type="file" id="file" accept=".docx">
  <button onclick="loadDoc()">üìÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Ç—á–µ—Ç</button>
</div>

<div class="card">
  <div class="stat" id="people">0</div>
  <div class="label">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
  <hr>
  <div class="stat" id="visits">0</div>
  <div class="label">–ü–æ—Å–µ—â–µ–Ω–∏–π</div>
</div>

<div class="card">
  <div class="stat" id="income">0 ‚ÇΩ</div>
  <div class="label">–î–æ—Ö–æ–¥ (280 ‚ÇΩ / –ø–æ—Å–µ—â–µ–Ω–∏–µ)</div>
</div>

<div class="card">
  <b>üë®‚Äçüè´ –ü–µ–¥–∞–≥–æ–≥</b>
  <input id="teacherName" placeholder="–ò–º—è –ø–µ–¥–∞–≥–æ–≥–∞">
  <select id="payType">
    <option value="percent">–ü—Ä–æ—Ü–µ–Ω—Ç</option>
    <option value="fixed">–§–∏–∫—Å</option>
  </select>
  <input id="payValue" type="number" placeholder="–ü—Ä–æ—Ü–µ–Ω—Ç –∏–ª–∏ —Å—É–º–º–∞ ‚ÇΩ">
</div>

<div class="card">
  <b>üè¢ –ê—Ä–µ–Ω–¥–∞ –∑–∞–ª–∞</b>
  <select id="rentType">
    <option value="free">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</option>
    <option value="paid">–ü–ª–∞—Ç–Ω–æ</option>
  </select>
  <input id="rentValue" type="number" placeholder="–°—Ç–æ–∏–º–æ—Å—Ç—å –∞—Ä–µ–Ω–¥—ã ‚ÇΩ">
</div>

<div class="card">
  <button onclick="calculate()">üìä –ü–æ—Å—á–∏—Ç–∞—Ç—å</button>
</div>

<div class="card">
  <div class="stat" id="teacherPay">0 ‚ÇΩ</div>
  <div class="label">–í—ã–ø–ª–∞—Ç–∞ –ø–µ–¥–∞–≥–æ–≥—É</div>
  <hr>
  <div class="stat" id="profit">0 ‚ÇΩ</div>
  <div class="label">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</div>
  <hr>
  <div class="stat" id="rentability">0 %</div>
  <div class="label">–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å</div>
</div>

<div class="card">
  <button onclick="save()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ–¥–∞–≥–æ–≥–∞</button>
</div>

<div class="card">
  <b>üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ–¥–∞–≥–æ–≥–æ–≤</b>
  <div id="list"></div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const PRICE = 280;
let visits = 0;
let income = 0;

async function loadDoc() {
  const file = document.getElementById("file").files[0];
  if (!file) return;

  const buffer = await file.arrayBuffer();
  const text = (await mammoth.extractRawText({arrayBuffer: buffer})).value;
  const lines = text.split("\n");

  visits = 0;
  let people = 0;

  lines.forEach(l => {
    const m = l.match(/\s(\d+)\s+(\d+)$/);
    if (m) {
      people++;
      visits += parseInt(m[1]);
    }
  });

  income = visits * PRICE;

  document.getElementById("people").innerText = people;
  document.getElementById("visits").innerText = visits;
  document.getElementById("income").innerText = income + " ‚ÇΩ";
}

function calculate() {
  const type = payType.value;
  const value = Number(payValue.value);
  const rent = rentType.value === "paid" ? Number(rentValue.value) : 0;

  let teacherPay = type === "percent"
    ? income * value / 100
    : value;

  const profit = income - teacherPay - rent;
  const rentability = income ? Math.round((profit / income) * 100) : 0;

  teacherPay = Math.round(teacherPay);

  document.getElementById("teacherPay").innerText = teacherPay + " ‚ÇΩ";
  document.getElementById("profit").innerText = profit + " ‚ÇΩ";
  document.getElementById("rentability").innerText = rentability + " %";
}

function save() {
  const data = JSON.parse(localStorage.getItem("teachers") || "[]");

  data.push({
    name: teacherName.value,
    profit: profit.innerText,
    rentability: rentability.innerText
  });

  localStorage.setItem("teachers", JSON.stringify(data));
  render();
}

function render() {
  const list = JSON.parse(localStorage.getItem("teachers") || "[]");
  document.getElementById("list").innerHTML = list
    .map(t => `‚Ä¢ ${t.name}: ${t.profit} (${t.rentability})`)
    .join("<br>");
}

render();
</script>

</body>
</html>
