<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TheGame ‚Äî –£—á—ë—Ç –¥–æ—Ö–æ–¥–æ–≤</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const tg = window.Telegram?.WebApp;

    const Icon = ({children}) => <span className="inline-block align-middle mr-2">{children}</span>;

    function App() {
      const [activeTab, setActiveTab] = useState('monthlyReport');
      const [loading, setLoading] = useState(true);

      const [dolgo, setDolgo] = useState([]);
      const [individuals, setIndividuals] = useState([]);
      const [rentals, setRentals] = useState([]);
      const [expenses, setExpenses] = useState([]);
      const [passive, setPassive] = useState([]);
      const [students, setStudents] = useState([]);
      const [monthlyArchive, setMonthlyArchive] = useState([]);

      const [showModal, setShowModal] = useState(false);
      const [modalType, setModalType] = useState(null);
      const [editingIndex, setEditingIndex] = useState(null);
      const [form, setForm] = useState({});

      const locationDefaults = {
        "–ë—É–¥–µ–Ω–Ω–æ–≥–æ": 0,
        "–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è": 0,
        "–ü–∞—Ä–∫": 0
      };

      const loadKey = async (key, fallback) => {
        try {
          if (tg?.CloudStorage) {
            return await new Promise((resolve) => {
              tg.CloudStorage.getItem(key, (err, val) => {
                if (!err && val) {
                  try { resolve(JSON.parse(val)); } catch { resolve(fallback); }
                } else resolve(fallback);
              });
            });
          } else {
            const raw = localStorage.getItem(key);
            return raw ? JSON.parse(raw) : fallback;
          }
        } catch {
          return fallback;
        }
      };

      const saveKey = async (key, data) => {
        try {
          const val = JSON.stringify(data);
          if (tg?.CloudStorage) tg.CloudStorage.setItem(key, val);
          localStorage.setItem(key, val);
        } catch (e) {
          console.error('saveKey error', e);
        }
      };

      useEffect(() => {
        (async () => {
          const [
            _dolgo, _ind, _rent, _exp, _pass, _stud, _arch
          ] = await Promise.all([
            loadKey('dolgo', []),
            loadKey('individuals', []),
            loadKey('rentals', []),
            loadKey('expenses', []),
            loadKey('passive', []),
            loadKey('students', []),
            loadKey('monthlyArchive', [])
          ]);
          setDolgo(_dolgo);
          setIndividuals(_ind);
          setRentals(_rent);
          setExpenses(_exp);
          setPassive(_pass);
          setStudents(_stud);
          setMonthlyArchive(_arch);
          setLoading(false);
          try { tg?.expand && tg.expand(); } catch {}
        })();
      }, []);

      useEffect(()=> { if(!loading) saveKey('dolgo', dolgo); }, [dolgo]);
      useEffect(()=> { if(!loading) saveKey('individuals', individuals); }, [individuals]);
      useEffect(()=> { if(!loading) saveKey('rentals', rentals); }, [rentals]);
      useEffect(()=> { if(!loading) saveKey('expenses', expenses); }, [expenses]);
      useEffect(()=> { if(!loading) saveKey('passive', passive); }, [passive]);
      useEffect(()=> { if(!loading) saveKey('students', students); }, [students]);
      useEffect(()=> { if(!loading) saveKey('monthlyArchive', monthlyArchive); }, [monthlyArchive]);

      const fmt = (n) => new Intl.NumberFormat('ru-RU').format(Number(n || 0));

      const calcTeacherExpense = (income, rate) => {
        if (!rate) return 0;
        if (rate === '50%') return Math.round(income * 0.5);
        if (rate === '700') return 700;
        if (rate === '1000') return 1000;
        if (rate === '100%') return Math.round(income * 1.0);
        const parsed = parseFloat(rate);
        return Number.isFinite(parsed) ? parsed : 0;
      };

      const totalDolgoIncome = dolgo.reduce((s,r)=> s + (Number(r.income)||0), 0);
      const totalDolgoTeacherExpense = dolgo.reduce((s,r)=> s + calcTeacherExpense(Number(r.income)||0, r.rate), 0);
      const totalDolgoHallExpense = dolgo.reduce((s,r)=> s + (Number(r.hallExpense)||0), 0);
      const totalDolgoProfit = totalDolgoIncome - totalDolgoTeacherExpense - totalDolgoHallExpense;

      const totalIndividualIncome = individuals.reduce((s,r)=> s + (Number(r.amount)||0), 0);
      const totalRentalsIncome = rentals.reduce((s,r)=> s + (Number(r.amount)||0), 0);
      const totalPassiveIncome = passive.reduce((s,r)=> s + (Number(r.monthly)||0), 0);
      const totalExpenses = expenses.reduce((s,r)=> s + (Number(r.amount)||0), 0);

      const monthlyReport = [
        { category: '–ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –¥–æ–ª–≥–æ–ª–µ—Ç–∏–µ', income: totalDolgoIncome, expense: totalDolgoTeacherExpense + totalDolgoHallExpense, profit: totalDolgoProfit },
        { category: '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É—Ä–æ–∫–∏', income: totalIndividualIncome, expense: 0, profit: totalIndividualIncome },
        { category: '–ê—Ä–µ–Ω–¥–∞ –∑–∞–ª–∞', income: totalRentalsIncome, expense: 0, profit: totalRentalsIncome },
        { category: '–ü–∞—Å—Å–∏–≤–Ω—ã–π', income: totalPassiveIncome, expense: 0, profit: totalPassiveIncome },
        { category: '–†–∞—Å—Ö–æ–¥—ã', income: 0, expense: totalExpenses, profit: -totalExpenses },
      ];
      const totalReportIncome = monthlyReport.reduce((s,r)=> s + (r.income||0), 0);
      const totalReportExpense = monthlyReport.reduce((s,r)=> s + (r.expense||0), 0);
      const totalReportProfit = monthlyReport.reduce((s,r)=> s + (r.profit||0), 0);

      const profitMap = {};
      dolgo.forEach(r=>{
        const profit = (Number(r.income)||0) - calcTeacherExpense(Number(r.income)||0, r.rate) - (Number(r.hallExpense)||0);
        const name = r.teacher || r.location || '–ë–µ–∑ –∏–º–µ–Ω–∏';
        profitMap[name] = (profitMap[name]||0) + profit;
      });
      rentals.forEach(r=>{
        const name = r.name || '–ê—Ä–µ–Ω–¥–∞';
        profitMap[name] = (profitMap[name]||0) + (Number(r.amount)||0);
      });
      individuals.forEach(r=>{
        const teacher = r.teacher || '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∫–∏';
        profitMap[teacher] = (profitMap[teacher]||0) + (Number(r.amount)||0);
      });

      const topList = Object.entries(profitMap)
        .map(([key,val])=> ({name:key, profit: Math.round(val)}))
        .sort((a,b)=> b.profit - a.profit)
        .slice(0,10);
      const topTotal = topList.reduce((s,r)=> s + r.profit, 0);
      const topWithShare = topList.map(t=> ({...t, share: topTotal ? Math.round((t.profit / topTotal)*100) : 0}));

      const totalStudents = students.length;
      const activeStudents = students.filter(s=> s.status === '–ê–∫—Ç–∏–≤–Ω—ã–π').length;
      const avgIncomePerStudent = totalStudents ? Math.round((totalReportProfit + totalIndividualIncome + totalPassiveIncome - totalExpenses) / totalStudents) : 0;

      const baseStart = 385000;
      const currentTotal = baseStart + (totalReportProfit);
      const goal = 1000000;
      const progressPercent = Math.round((currentTotal / goal) * 100);

      const openModal = (type, idx = null) => {
        setModalType(type);
        setEditingIndex(idx);
        let data = {};
        if (idx !== null) {
          if (type === 'dolgo') data = {...dolgo[idx]};
          if (type === 'individual') data = {...individuals[idx]};
          if (type === 'rental') data = {...rentals[idx]};
          if (type === 'expense') data = {...expenses[idx]};
          if (type === 'passive') data = {...passive[idx]};
          if (type === 'student') data = {...students[idx]};
          if (type === 'archive') data = {...monthlyArchive[idx]};
        } else {
          data = {};
        }
        setForm(data);
        setShowModal(true);
      };

      const closeModal = () => { setShowModal(false); setForm({}); setEditingIndex(null); setModalType(null); };

      const saveModal = () => {
        if (modalType === 'dolgo') {
          const people = Number(form.people || 0);
          const income = people * 280;
          const row = {
            date: form.date || '',
            location: form.location || '',
            teacher: form.teacher || '',
            rate: form.rate || '50%',
            people,
            income,
            hallExpense: Number(form.hallExpense || locationDefaults[form.location] || 0),
            comment: form.comment || ''
          };
          if (editingIndex !== null) {
            const copy = [...dolgo]; copy[editingIndex] = row; setDolgo(copy);
          } else {
            setDolgo([...dolgo, row]);
          }
        }
        if (modalType === 'individual') {
          const row = {
            date: form.date || '',
            type: form.type || '–û—Å—Ç–∞–ª—å–Ω—ã–µ',
            client: form.client || '',
            teacher: form.teacher || '',
            amount: Number(form.amount || 0),
            comment: form.comment || ''
          };
          if (editingIndex !== null) {
            const copy = [...individuals]; copy[editingIndex] = row; setIndividuals(copy);
          } else setIndividuals([...individuals, row]);
        }
        if (modalType === 'rental') {
          const row = {
            date: form.date || '',
            name: form.name || '',
            amount: Number(form.amount || 0),
            comment: form.comment || ''
          };
          if (editingIndex !== null) { const copy=[...rentals]; copy[editingIndex]=row; setRentals(copy); }
          else setRentals([...rentals, row]);
        }
        if (modalType === 'expense') {
          const row = {
            date: form.date || '',
            type: form.type || '',
            what: form.what || '',
            amount: Number(form.amount || 0),
            comment: form.comment || ''
          };
          if (editingIndex !== null) { const copy=[...expenses]; copy[editingIndex]=row; setExpenses(copy); }
          else setExpenses([...expenses, row]);
        }
        if (modalType === 'passive') {
          const row = {
            date: form.date || '',
            source: form.source || '',
            monthly: Number(form.monthly || 0),
            comment: form.comment || ''
          };
          if (editingIndex !== null) { const copy=[...passive]; copy[editingIndex]=row; setPassive(copy); }
          else setPassive([...passive, row]);
        }
        if (modalType === 'student') {
          const row = {
            name: form.name || '',
            phone: form.phone || '',
            group: form.group || '',
            subscription: form.subscription || '',
            expiry: form.expiry || '',
            status: form.status || '–ê–∫—Ç–∏–≤–Ω—ã–π',
            note: form.note || ''
          };
          if (editingIndex !== null) { const copy=[...students]; copy[editingIndex]=row; setStudents(copy); }
          else setStudents([...students, row]);
        }
        if (modalType === 'archive') {
          const groupIncome = Number(form.groupIncome||0);
          const individualIncome = Number(form.individualIncome||0);
          const passiveIncome = Number(form.passiveIncome||0);
          const expensesVal = Number(form.expenses||0);
          const profit = groupIncome + individualIncome + passiveIncome - expensesVal;
          const row = {
            month: form.month || '',
            year: form.year || '',
            groupIncome, individualIncome, passiveIncome,
            expenses: expensesVal,
            profit,
            note: form.note || ''
          };
          if (editingIndex !== null) { const copy=[...monthlyArchive]; copy[editingIndex]=row; setMonthlyArchive(copy); }
          else setMonthlyArchive([...monthlyArchive, row]);
        }

        closeModal();
      };

      const deleteItem = (type, idx) => {
        if (!confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) return;
        if (type === 'dolgo') setDolgo(dolgo.filter((_,i)=>i!==idx));
        if (type === 'individual') setIndividuals(individuals.filter((_,i)=>i!==idx));
        if (type === 'rental') setRentals(rentals.filter((_,i)=>i!==idx));
        if (type === 'expense') setExpenses(expenses.filter((_,i)=>i!==idx));
        if (type === 'passive') setPassive(passive.filter((_,i)=>i!==idx));
        if (type === 'student') setStudents(students.filter((_,i)=>i!==idx));
        if (type === 'archive') setMonthlyArchive(monthlyArchive.filter((_,i)=>i!==idx));
      };

      const exportCSV = () => {
        let csv = '–ö–∞—Ç–µ–≥–æ—Ä–∏—è,–î–æ—Ö–æ–¥,–†–∞—Å—Ö–æ–¥,–ü—Ä–∏–±—ã–ª—å\n';
        monthlyReport.forEach(row=>{
          csv += `${row.category},${row.income},${row.expense},${row.profit}\n`;
        });
        csv += `\n–ò–¢–û–ì–û,${totalReportIncome},${totalReportExpense},${totalReportProfit}\n`;
        const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'thegame_monthly_report.csv'; a.click();
        URL.revokeObjectURL(url);
      };

      const exportSalariesCSV = () => {
        const teacherStats = {};
        dolgo.forEach(r=>{
          const name = r.teacher || '–ë–µ–∑ –∏–º–µ–Ω–∏';
          if (!teacherStats[name]) {
            teacherStats[name] = { days: new Set(), sessions: 0, income: 0, salary: 0, hallExpense: 0 };
          }
          teacherStats[name].days.add(r.date);
          teacherStats[name].sessions += 1;
          teacherStats[name].income += Number(r.income||0);
          teacherStats[name].salary += calcTeacherExpense(Number(r.income||0), r.rate);
          teacherStats[name].hallExpense += Number(r.hallExpense||0);
        });
        
        let csv = '–ü–µ–¥–∞–≥–æ–≥,–†–∞–±–æ—á–∏—Ö –¥–Ω–µ–π,–ó–∞–Ω—è—Ç–∏–π,–î–æ—Ö–æ–¥,–ó–∞—Ä–ø–ª–∞—Ç–∞,–†–∞—Å—Ö–æ–¥ –Ω–∞ –∑–∞–ª,–ü—Ä–∏–±—ã–ª—å\n';
        Object.entries(teacherStats).forEach(([name, data])=>{
          const profit = data.income - data.salary - data.hallExpense;
          csv += `${name},${data.days.size},${data.sessions},${data.income},${data.salary},${data.hallExpense},${profit}\n`;
        });
        
        const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'salaries_report.csv'; a.click();
        URL.revokeObjectURL(url);
      };

      if (loading) {
        return <div className="min-h-screen flex items-center justify-center"><div>–ó–∞–≥—Ä—É–∑–∫–∞...</div></div>;
      }

      return (
        <div className="min-h-screen p-4">
          <div className="max-w-6xl mx-auto">
            <header className="mb-6">
              <div className="flex items-center justify-between">
                <div>
                  <h1 className="text-2xl font-bold">üí∞ TheGame ‚Äî –£—á—ë—Ç –¥–æ—Ö–æ–¥–æ–≤</h1>
                  <div className="text-sm text-slate-400">–ü—É—Ç—å –∫ 1–ú</div>
                </div>
                <div className="text-right">
                  <div className="text-sm text-slate-400">–ü—Ä–æ–≥—Ä–µ—Å—Å –∫ —Ü–µ–ª–∏</div>
                  <div className="flex items-center gap-3">
                    <div className="w-56 bg-slate-700 h-4 rounded">
                      <div className="h-4 rounded bg-gradient-to-r from-blue-500 to-green-400" style={{width: `${Math.min(progressPercent,100)}%`}}></div>
                    </div>
                    <div className="text-sm font-bold">{progressPercent}%</div>
                  </div>
                  <div className="text-xs text-slate-400"> {fmt(currentTotal)}‚ÇΩ ‚Üí {fmt(goal)}‚ÇΩ</div>
                </div>
              </div>

              <nav className="mt-4 flex flex-wrap gap-2">
                {[
                  {id:'monthlyReport', title:'–ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç'},
                  {id:'dolgo', title:'–ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –¥–æ–ª–≥–æ–ª–µ—Ç–∏–µ'},
                  {id:'salaries', title:'–ó–∞—Ä–ø–ª–∞—Ç—ã –ø–µ–¥–∞–≥–æ–≥–æ–≤'},
                  {id:'individuals', title:'–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É—Ä–æ–∫–∏'},
                  {id:'rentals', title:'–ê—Ä–µ–Ω–¥–∞ –∑–∞–ª–∞'},
                  {id:'expenses', title:'–†–∞—Å—Ö–æ–¥—ã'},
                  {id:'passive', title:'–ü–∞—Å—Å–∏–≤–Ω—ã–π'},
                  {id:'students', title:'–ë–∞–∑–∞ —É—á–µ–Ω–∏–∫–æ–≤'},
                  {id:'analytics', title:'–ê–Ω–∞–ª–∏—Ç–∏–∫–∞'},
                  {id:'archive', title:'–ü–æ –º–µ—Å—è—Ü–∞–º'},
                  {id:'summary', title:'–°–≤–æ–¥–∫–∞'},
                ].map(t=>(
                  <button
                    key={t.id}
                    onClick={()=>setActiveTab(t.id)}
                    className={`px-3 py-1 rounded ${activeTab===t.id ? 'bg-blue-600' : 'bg-slate-800 text-slate-300 hover:bg-slate-700'}`}
                  >{t.title}</button>
                ))}
              </nav>
            </header>

            <main className="bg-slate-800 rounded p-4 border border-slate-700">
              
              {activeTab === 'salaries' && (
                <section>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-lg font-bold">üíº –ó–∞—Ä–ø–ª–∞—Ç—ã –ø–µ–¥–∞–≥–æ–≥–æ–≤</h2>
                    <button onClick={exportSalariesCSV} className="px-3 py-2 bg-green-600 rounded text-sm">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
                  </div>

                  {dolgo.length === 0 ? (
                    <div className="bg-yellow-900/30 border border-yellow-700 rounded p-6 text-center">
                      <div className="text-3xl mb-3">‚ö†Ô∏è</div>
                      <div className="text-lg font-bold mb-2">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—á—ë—Ç–∞</div>
                      <div className="text-slate-300 mb-4">–î–æ–±–∞–≤—å—Ç–µ –∑–∞–Ω—è—Ç–∏—è –≤ —Ä–∞–∑–¥–µ–ª "–ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –¥–æ–ª–≥–æ–ª–µ—Ç–∏–µ"</div>
                      <button onClick={()=>setActiveTab('dolgo')} className="px-4 py-2 bg-blue-600 rounded">
                        –ü–µ—Ä–µ–π—Ç–∏ –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –∑–∞–Ω—è—Ç–∏–π
                      </button>
                    </div>
                  ) : (
                    <>
                      <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div className="bg-gradient-to-br from-blue-900 to-blue-800 p-4 rounded-lg">
                          <div className="text-blue-200 text-xs mb-1">–ü–µ–¥–∞–≥–æ–≥–æ–≤</div>
                          <div className="text-3xl font-bold">{new Set(dolgo.map(r=>r.teacher)).size}</div>
                        </div>
                        <div className="bg-gradient-to-br from-green-900 to-green-800 p-4 rounded-lg">
                          <div className="text-green-200 text-xs mb-1">–ó–∞–Ω—è—Ç–∏–π</div>
                          <div className="text-3xl font-bold">{dolgo.length}</div>
                        </div>
                        <div className="bg-gradient-to-br from-yellow-900 to-yellow-800 p-4 rounded-lg">
                          <div className="text-yellow-200 text-xs mb-1">–í—ã–ø–ª–∞—á–µ–Ω–æ</div>
                          <div className="text-xl font-bold">{fmt(totalDolgoTeacherExpense)}‚ÇΩ</div>
                        </div>
                        <div className="bg-gradient-to-br from-red-900 to-red-800 p-4 rounded-lg">
                          <div className="text-red-200 text-xs mb-1">–ù–∞ –∑–∞–ª—ã</div>
                          <div className="text-xl font-bold">{fmt(totalDolgoHallExpense)}‚ÇΩ</div>
                        </div>
                      </div>

                      <div className="overflow-x-auto">
                        <table className="w-full text-sm">
                          <thead>
                            <tr className="border-b border-slate-700 text-slate-300">
                              <th className="py-3 px-2 text-left">–ü–µ–¥–∞–≥–æ–≥</th>
                              <th className="py-3 px-2 text-center">–î–Ω–µ–π</th>
                              <th className="py-3 px-2 text-center">–ó–∞–Ω—è—Ç–∏–π</th>
                              <th className="py-3 px-2 text-right">–î–æ—Ö–æ–¥</th>
                              <th className="py-3 px-2 text-right">–ó–∞—Ä–ø–ª–∞—Ç–∞</th>
                              <th className="py-3 px-2 text-right">–ó–∞–ª</th>
                              <th className="py-3 px-2 text-right">–ü—Ä–∏–±—ã–ª—å</th>
                              <th className="py-3 px-2 text-center">%</th>
                            </tr>
                          </thead>
                          <tbody>
                            {(() => {
                              const teacherStats = {};
                              
                              dolgo.forEach(r=>{
                                const name = r.teacher || '–ë–µ–∑ –∏–º–µ–Ω–∏';
                                if (!teacherStats[name]) {
                                  teacherStats[name] = { 
                                    days: new Set(), 
                                    sessions: 0, 
                                    income: 0, 
                                    salary: 0, 
                                    hallExpense: 0,
                                    locations: new Set()
                                  };
                                }
                                teacherStats[name].days.add(r.date);
                                teacherStats[name].sessions += 1;
                                teacherStats[name].income += Number(r.income||0);
                                teacherStats[name].salary += calcTeacherExpense(Number(r.income||0), r.rate);
                                teacherStats[name].hallExpense += Number(r.hallExpense||0);
                                teacherStats[name].locations.add(r.location);
                              });

                              return Object.entries(teacherStats)
                                .sort((a,b) => b[1].income - a[1].income)
                                .map(([name, data], idx)=>{
                                  const profit = data.income - data.salary - data.hallExpense;
                                  const profitPercent = data.income ? Math.round((profit / data.income) * 100) : 0;
                                  
                                  return (
                                    <tr key={idx} className="border-b border-slate-700/40 hover:bg-slate-700/30">
                                      <td className="py-3 px-2">
                                        <div className="font-bold">{name}</div>
                                        <div className="text-xs text-slate-400">
                                          üìç {Array.from(data.locations).join(', ')}
                                        </div>
                                      </td>
                                      <td className="py-3 px-2 text-center">
                                        <span className="bg-blue-600 px-3 py-1 rounded-full text-white font-bold text-xs">
                                          {data.days.size}
                                        </span>
                                      </td>
                                      <td className="py-3 px-2 text-center font-semibold">{data.sessions}</td>
                                      <td className="py-3 px-2 text-right text-green-400 font-bold">{fmt(data.income)}‚ÇΩ</td>
                                      <td className="py-3 px-2 text-right text-yellow-400 font-bold">{fmt(data.salary)}‚ÇΩ</td>
                                      <td className="py-3 px-2 text-right text-red-400">{fmt(data.hallExpense)}‚ÇΩ</td>
                                      <td className="py-3 px-2 text-right">
                                        <span className={`font-bold ${profit > 0 ? 'text-blue-400' : 'text-red-400'}`}>
                                          {fmt(profit)}‚ÇΩ
                                        </span>
                                      </td>
                                      <td className="py-3 px-2">
                                        <div className="flex flex-col items-center gap-1">
                                          <div className="w-20 bg-slate-700 h-2 rounded-full overflow-hidden">
                                            <div 
                                              className={`h-2 ${
                                                profitPercent > 50 ? 'bg-green-500' : 
                                                profitPercent > 30 ? 'bg-yellow-500' : 
                                                'bg-red-500'
                                              }`}
                                              style={{width: `${Math.min(profitPercent, 100)}%`}}
                                            ></div>
                                          </div>
                                          <span className="text-xs font-bold">{profitPercent}%</span>
                                        </div>
                                      </td>
                                    </tr>
                                  );
                                });
                            })()}
                          </tbody>
                          <tfoot className="bg-slate-900/50 font-bold">
                            <tr>
                              <td className="py-3 px-2">–ò–¢–û–ì–û:</td>
                              <td className="py-3 px-2 text-center text-blue-400">{new Set(dolgo.map(r=>r.date)).size}</td>
                              <td className="py-3 px-2 text-center">{dolgo.length}</td>
                              <td className="py-3 px-2 text-right text-green-400">{fmt(totalDolgoIncome)}‚ÇΩ</td>
                              <td className="py-3 px-2 text-right text-yellow-400">{fmt(totalDolgoTeacherExpense)}‚ÇΩ</td>
                              <td className="py-3 px-2 text-right text-red-400">{fmt(totalDolgoHallExpense)}‚ÇΩ</td>
                              <td className="py-3 px-2 text-right text-blue-400">{fmt(totalDolgoProfit)}‚ÇΩ</td>
                              <td className="py-3 px-2 text-center">
                                {totalDolgoIncome ? Math.round((totalDolgoProfit/totalDolgoIncome)*100) : 0}%
                              </td>
                            </tr>
                          </tfoot>
                        </table>
                      </div>

                      <div className="mt-6 bg-blue-900/20 border border-blue-700/50 rounded p-4">
                        <h3 className="font-bold text-blue-300 mb-2">üí° –ö–∞–∫ —á–∏—Ç–∞—Ç—å –æ—Ç—á—ë—Ç:</h3>
                        <ul className="text-sm text-slate-300 space-y-1">
                          <li>‚Ä¢ <b>–î–Ω–µ–π</b> ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö
