<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>–ó–∞—Ä–ø–ª–∞—Ç—ã –ø–µ–¥–∞–≥–æ–≥–æ–≤ - –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –¥–æ–ª–≥–æ–ª–µ—Ç–∏–µ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
      background: #0f172a; 
      color: #fff; 
      padding: 20px;
    }
    .container { max-width: 1400px; margin: 0 auto; }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
    }
    .header-left h1 { font-size: 28px; margin-bottom: 8px; }
    .subtitle { color: #94a3b8; }
    
    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .btn {
      background: #1e40af;
      color: #fff;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }
    .btn:hover { background: #1e3a8a; transform: translateY(-1px); }
    .btn.secondary { background: #334155; }
    .btn.secondary:hover { background: #475569; }
    
    .filter-bar {
      background: #1e293b;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      display: none;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
    }
    .filter-bar select, .filter-bar input {
      background: #334155;
      color: #fff;
      border: 1px solid #475569;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
    }
    .filter-bar label {
      color: #94a3b8;
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .stats { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
      gap: 15px; 
      margin-bottom: 30px; 
    }
    .stat-card {
      background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      transition: transform 0.2s;
    }
    .stat-card:hover { transform: translateY(-2px); }
    .stat-card.green { background: linear-gradient(135deg, #065f46 0%, #047857 100%); }
    .stat-card.yellow { background: linear-gradient(135deg, #78350f 0%, #92400e 100%); }
    .stat-card.red { background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%); }
    .stat-card.purple { background: linear-gradient(135deg, #581c87 0%, #6b21a8 100%); }
    
    .stat-label { 
      font-size: 11px; 
      text-transform: uppercase; 
      letter-spacing: 1px; 
      opacity: 0.8;
      margin-bottom: 8px;
    }
    .stat-value { font-size: 32px; font-weight: bold; }
    .stat-change {
      font-size: 12px;
      margin-top: 8px;
      opacity: 0.9;
    }
    
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .chart-card {
      background: #1e293b;
      border-radius: 12px;
      padding: 20px;
    }
    .chart-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 15px;
      color: #cbd5e1;
    }
    .chart-bar {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }
    .chart-label {
      width: 120px;
      font-size: 13px;
      color: #94a3b8;
    }
    .chart-bar-bg {
      flex: 1;
      height: 24px;
      background: #334155;
      border-radius: 4px;
      overflow: hidden;
      margin: 0 10px;
    }
    .chart-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #60a5fa);
      transition: width 0.5s ease;
    }
    .chart-value {
      min-width: 60px;
      text-align: right;
      font-size: 13px;
      font-weight: bold;
    }
    
    .table-container {
      background: #1e293b;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
    }
    
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }
    .search-box {
      position: relative;
    }
    .search-box input {
      background: #334155;
      border: 1px solid #475569;
      color: #fff;
      padding: 8px 12px 8px 35px;
      border-radius: 8px;
      font-size: 14px;
      width: 250px;
    }
    .search-icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: #94a3b8;
    }
    
    table { 
      width: 100%; 
      border-collapse: collapse;
    }
    th { 
      padding: 12px 8px; 
      text-align: left; 
      color: #cbd5e1; 
      font-size: 13px;
      border-bottom: 2px solid #334155;
      cursor: pointer;
      user-select: none;
    }
    th:hover { color: #fff; }
    th.sortable::after {
      content: ' ‚Üï';
      opacity: 0.3;
    }
    td { 
      padding: 15px 8px; 
      border-bottom: 1px solid #334155;
    }
    tbody tr {
      transition: background 0.2s;
      cursor: pointer;
    }
    tbody tr:hover { background: #334155; }
    
    .teacher-name { font-weight: bold; font-size: 16px; }
    .teacher-location { 
      color: #94a3b8; 
      font-size: 12px; 
      margin-top: 4px;
    }
    
    .badge {
      display: inline-block;
      background: #2563eb;
      color: #fff;
      padding: 6px 14px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 14px;
    }
    
    .amount { font-weight: bold; font-size: 15px; }
    .green { color: #4ade80; }
    .yellow { color: #fbbf24; }
    .red { color: #f87171; }
    .blue { color: #60a5fa; }
    .purple { color: #c084fc; }
    
    .progress-bar {
      width: 100%;
      height: 12px;
      background: #334155;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 5px;
    }
    .progress-fill {
      height: 100%;
      transition: width 0.3s;
    }
    .progress-fill.high { background: #22c55e; }
    .progress-fill.medium { background: #eab308; }
    .progress-fill.low { background: #ef4444; }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
    }
    .modal.active { display: flex; align-items: center; justify-content: center; }
    .modal-content {
      background: #1e293b;
      border-radius: 12px;
      padding: 30px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-content.wide {
      max-width: 600px;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-title { font-size: 20px; font-weight: bold; }
    .close-btn {
      background: none;
      border: none;
      color: #94a3b8;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
    }
    .close-btn:hover { color: #fff; }
    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #334155;
    }
    .detail-label { color: #94a3b8; }
    .detail-value { font-weight: bold; }
    
    .session-list {
      margin-top: 20px;
    }
    .session-item {
      background: #334155;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: grid;
      grid-template-columns: 100px 1fr 80px 100px;
      gap: 10px;
      align-items: center;
      font-size: 14px;
    }
    .session-date { color: #60a5fa; font-weight: bold; }
    .session-people { color: #4ade80; }
    .session-grant { color: #fbbf24; }
    
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      color: #cbd5e1;
      font-size: 14px;
      margin-bottom: 5px;
      font-weight: 500;
    }
    .form-group input,
    .form-group select {
      width: 100%;
      background: #334155;
      border: 1px solid #475569;
      color: #fff;
      padding: 10px;
      border-radius: 6px;
      font-size: 14px;
    }
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #3b82f6;
    }
    .form-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      justify-content: flex-end;
    }
    .session-edit-item {
      background: #334155;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 8px;
      display: grid;
      grid-template-columns: 120px 100px 1fr auto;
      gap: 10px;
      align-items: center;
    }
    .session-edit-item input {
      background: #1e293b;
      border: 1px solid #475569;
      color: #fff;
      padding: 6px 8px;
      border-radius: 4px;
      font-size: 13px;
    }
    .delete-btn {
      background: #dc2626;
      color: #fff;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    .delete-btn:hover {
      background: #b91c1c;
    }
    .add-session-btn {
      background: #059669;
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 10px;
    }
    .add-session-btn:hover {
      background: #047857;
    }
    
    .alert {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #1e293b;
      border-left: 4px solid #22c55e;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      z-index: 2000;
      animation: slideInRight 0.3s ease;
    }
    .alert.error {
      border-left-color: #ef4444;
    }
    @keyframes slideInRight {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .top-teacher-card {
      background: #334155;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 15px;
      display: grid;
      grid-template-columns: 60px 1fr auto;
      gap: 15px;
      align-items: center;
      transition: all 0.2s;
    }
    .top-teacher-card:hover {
      background: #475569;
      transform: translateX(5px);
    }
    .top-rank {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      font-weight: bold;
      color: #fff;
    }
    .top-rank.gold { background: linear-gradient(135deg, #f59e0b, #fbbf24); }
    .top-rank.silver { background: linear-gradient(135deg, #64748b, #94a3b8); }
    .top-rank.bronze { background: linear-gradient(135deg, #92400e, #b45309); }
    .top-info h3 {
      font-size: 18px;
      margin-bottom: 5px;
    }
    .top-info p {
      color: #94a3b8;
      font-size: 13px;
    }
    .top-stats {
      text-align: right;
    }
    .top-value {
      font-size: 24px;
      font-weight: bold;
      color: #4ade80;
    }
    .top-label {
      font-size: 12px;
      color: #94a3b8;
      margin-top: 5px;
    }
    
    .weekday-bar {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .weekday-label {
      width: 40px;
      font-size: 13px;
      color: #94a3b8;
    }
    .weekday-bar-bg {
      flex: 1;
      height: 20px;
      background: #334155;
      border-radius: 4px;
      overflow: hidden;
      margin: 0 10px;
    }
    .weekday-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #6366f1, #818cf8);
      transition: width 0.5s ease;
    }
    .weekday-value {
      min-width: 50px;
      text-align: right;
      font-size: 13px;
      font-weight: bold;
    }
    
    .forecast-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .forecast-item {
      background: #334155;
      padding: 15px;
      border-radius: 8px;
    }
    .forecast-label {
      color: #94a3b8;
      font-size: 13px;
      margin-bottom: 8px;
    }
    .forecast-value {
      font-size: 24px;
      font-weight: bold;
    }
    .forecast-trend {
      font-size: 12px;
      margin-top: 5px;
    }
    
    .notification-center {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 350px;
      max-height: 80vh;
      overflow-y: auto;
      z-index: 1500;
    }
    .notification-item {
      background: #1e293b;
      border-left: 4px solid #3b82f6;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      animation: slideInRight 0.3s ease;
      cursor: pointer;
    }
    .notification-item:hover {
      background: #334155;
    }
    .notification-item.warning {
      border-left-color: #f59e0b;
    }
    .notification-item.error {
      border-left-color: #ef4444;
    }
    .notification-item.success {
      border-left-color: #22c55e;
    }
    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .notification-title {
      font-weight: bold;
      font-size: 14px;
      color: #cbd5e1;
    }
    .notification-time {
      font-size: 11px;
      color: #64748b;
    }
    .notification-body {
      font-size: 13px;
      color: #94a3b8;
      line-height: 1.5;
    }
    .notification-close {
      background: none;
      border: none;
      color: #64748b;
      cursor: pointer;
      font-size: 18px;
      padding: 0;
      margin-left: 10px;
    }
    .notification-close:hover {
      color: #fff;
    }
    
    .notification-bell {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.5);
      z-index: 1400;
      transition: all 0.3s;
    }
    .notification-bell:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(59, 130, 246, 0.7);
    }
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ef4444;
      color: #fff;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }
    
    .reminder-banner {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      padding: 15px 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      animation: slideIn 0.3s ease;
    }
    .reminder-banner.info {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
    }
    .reminder-text {
      flex: 1;
      font-size: 14px;
      line-height: 1.5;
    }
    .reminder-action {
      background: rgba(255,255,255,0.2);
      border: none;
      color: #fff;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: bold;
      margin-left: 15px;
      white-space: nowrap;
    }
    .reminder-action:hover {
      background: rgba(255,255,255,0.3);
    }
    
    .payment-status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
    }
    .payment-status.paid {
      background: rgba(34, 197, 94, 0.2);
      color: #4ade80;
    }
    .payment-status.unpaid {
      background: rgba(239, 68, 68, 0.2);
      color: #f87171;
    }
    .payment-status.partial {
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
    }
    
    .payment-history-item {
      background: #334155;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .payment-date {
      color: #94a3b8;
      font-size: 13px;
    }
    .payment-amount {
      font-weight: bold;
      color: #4ade80;
      font-size: 15px;
    }
    .payment-note {
      color: #cbd5e1;
      font-size: 12px;
      margin-top: 4px;
    }
    
    .debt-alert {
      background: rgba(239, 68, 68, 0.1);
      border-left: 4px solid #ef4444;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .debt-alert-title {
      color: #f87171;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .info-box {
      background: rgba(59, 130, 246, 0.1);
      border-left: 4px solid #3b82f6;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .info-title { 
      font-weight: bold; 
      color: #93c5fd; 
      margin-bottom: 15px;
      font-size: 16px;
    }
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }
    .info-item { font-size: 14px; color: #e2e8f0; }
    .info-item strong { display: block; margin-bottom: 4px; }
    
    .text-center { text-align: center; }
    .text-right { text-align: right; }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in { animation: slideIn 0.3s ease; }
  </style>
</head>
<body>
  <div class="container">
    <div id="reminderBanners"></div>
    
    <div class="header">
      <div class="header-left">
        <h1>üíº –ó–∞—Ä–ø–ª–∞—Ç—ã –ø–µ–¥–∞–≥–æ–≥–æ–≤</h1>
        <div class="subtitle">–ü—Ä–æ–≥—Ä–∞–º–º–∞ "–ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –¥–æ–ª–≥–æ–ª–µ—Ç–∏–µ" - –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç</div>
      </div>
      <div class="controls">
        <button class="btn" onclick="showQuickAddSessionModal()">‚ö° –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–Ω—è—Ç–∏—è</button>
        <button class="btn" onclick="showAddTeacherModal()">‚ûï –ù–æ–≤—ã–π –ø–µ–¥–∞–≥–æ–≥</button>
        <button class="btn" onclick="exportData()">üì• –≠–∫—Å–ø–æ—Ä—Ç</button>
        <button class="btn secondary" onclick="importData()">üì§ –ò–º–ø–æ—Ä—Ç</button>
        <button class="btn secondary" onclick="printReport()">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
        <button class="btn secondary" onclick="toggleFilters()">üîç –§–∏–ª—å—Ç—Ä—ã</button>
        <button class="btn secondary" onclick="comparePeriods()" id="compareBtn" style="display: none;">üìä –°—Ä–∞–≤–Ω–∏—Ç—å</button>
      </div>
    </div>
    
    <div class="filter-bar" id="filterBar">
      <label>
        –ü–µ—Ä–∏–æ–¥
        <select id="periodFilter" onchange="applyPeriodFilter()">
          <option value="all">–í–µ—Å—å –ø–µ—Ä–∏–æ–¥</option>
          <option value="current_month" selected>–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</option>
          <option value="last_month">–ü—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü</option>
          <option value="current_quarter">–¢–µ–∫—É—â–∏–π –∫–≤–∞—Ä—Ç–∞–ª</option>
          <option value="last_quarter">–ü—Ä–æ—à–ª—ã–π –∫–≤–∞—Ä—Ç–∞–ª</option>
          <option value="current_year">–¢–µ–∫—É—â–∏–π –≥–æ–¥</option>
          <option value="custom">–°–≤–æ–π –ø–µ—Ä–∏–æ–¥</option>
        </select>
      </label>
      <label id="customDateFrom" style="display: none;">
        –° –¥–∞—Ç—ã
        <input type="date" id="dateFrom" onchange="applyPeriodFilter()">
      </label>
      <label id="customDateTo" style="display: none;">
        –ü–æ –¥–∞—Ç—É
        <input type="date" id="dateTo" onchange="applyPeriodFilter()">
      </label>
      <label>
        –õ–æ–∫–∞—Ü–∏—è
        <select id="locationFilter" onchange="applyFilters()">
          <option value="">–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏</option>
        </select>
      </label>
      <label>
        –ú–∏–Ω. –∑–∞–Ω—è—Ç–∏–π
        <input type="number" id="minSessions" min="0" placeholder="0" onchange="applyFilters()">
      </label>
      <button class="btn" onclick="resetFilters()" style="align-self: flex-end;">–°–±—Ä–æ—Å–∏—Ç—å</button>
    </div>
    
    <div class="stats fade-in" id="statsContainer"></div>
    
    <div id="periodComparison" style="display: none; margin-bottom: 20px;"></div>
    
    <!-- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —É—á–µ—Ç -->
    <div class="table-container fade-in" style="margin-bottom: 30px;">
      <h2 style="margin-bottom: 20px;">üí≥ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —É—á—ë—Ç –∏ –≤—ã–ø–ª–∞—Ç—ã</h2>
      <div id="debtAlerts"></div>
      <div id="paymentsTable"></div>
    </div>
    
    <!-- –¢–æ–ø –ø–µ–¥–∞–≥–æ–≥–∏ -->
    <div class="table-container fade-in" id="topTeachers" style="margin-bottom: 30px;">
      <h2 style="margin-bottom: 20px;">üèÜ –¢–æ–ø-3 –ø–µ–¥–∞–≥–æ–≥–∞ –ø–µ—Ä–∏–æ–¥–∞</h2>
      <div id="topTeachersContent"></div>
    </div>
    
    <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
    <div class="charts-grid fade-in">
      <div class="chart-card">
        <div class="chart-title">üìà –î–∏–Ω–∞–º–∏–∫–∞ –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏</div>
        <div id="weekdayChart"></div>
      </div>
      <div class="chart-card">
        <div class="chart-title">üìä –î–∏–Ω–∞–º–∏–∫–∞ –ø–æ –Ω–µ–¥–µ–ª—è–º</div>
        <div id="weeklyChart"></div>
      </div>
    </div>
    
    <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è -->
    <div class="charts-grid fade-in">
      <div class="chart-card">
        <div class="chart-title">ü•ß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤</div>
        <div id="expensesPieChart"></div>
      </div>
      <div class="chart-card">
        <div class="chart-title">üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤</div>
        <div id="incomePieChart"></div>
      </div>
    </div>
    
    <!-- –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
    <div class="table-container fade-in" style="margin-bottom: 30px;">
      <h2 style="margin-bottom: 20px;">üóìÔ∏è –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
      <div id="heatmapChart"></div>
    </div>
    
    <!-- –ì—Ä–∞—Ñ–∏–∫ —Ä–æ—Å—Ç–∞ -->
    <div class="table-container fade-in" style="margin-bottom: 30px;">
      <h2 style="margin-bottom: 20px;">üìà –ì—Ä–∞—Ñ–∏–∫ —Ä–æ—Å—Ç–∞ –¥–æ—Ö–æ–¥–æ–≤</h2>
      <div id="growthChart"></div>
    </div>
    
    <!-- KPI –∏ —Ü–µ–ª–∏ -->
    <div class="table-container fade-in" style="margin-bottom: 30px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>üéØ KPI –∏ —Ü–µ–ª–∏</h2>
        <button class="btn" onclick="showSetGoalsModal()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ü–µ–ª–∏</button>
      </div>
      <div id="kpiContainer"></div>
    </div>
    
    <!-- –ë–æ–Ω—É—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ -->
    <div class="table-container fade-in" style="margin-bottom: 30px;">
      <h2 style="margin-bottom: 20px;">üíé –ë–æ–Ω—É—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</h2>
      <div id="bonusContainer"></div>
    </div>
    
    <!-- –ü—Ä–æ–≥–Ω–æ–∑ -->
    <div class="info-box fade-in" style="margin-bottom: 30px; border-left-color: #8b5cf6;">
      <div class="info-title">üîÆ –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü</div>
      <div id="forecastContent"></div>
    </div>
    
    <div class="charts-grid fade-in" id="chartsContainer"></div>
    
    <div class="table-container fade-in">
      <div class="table-header">
        <h2>üìä –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –ø–µ–¥–∞–≥–æ–≥–∞–º</h2>
        <div class="search-box">
          <span class="search-icon">üîç</span>
          <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–µ–¥–∞–≥–æ–≥–∞..." onkeyup="searchTable()">
        </div>
      </div>
      
      <table id="mainTable">
        <thead>
          <tr>
            <th class="sortable" onclick="sortTable(0)">–ü–µ–¥–∞–≥–æ–≥</th>
            <th class="text-center sortable" onclick="sortTable(1)">–†–∞–±–æ—á–∏—Ö<br>–¥–Ω–µ–π</th>
            <th class="text-center sortable" onclick="sortTable(2)">–ó–∞–Ω—è—Ç–∏–π</th>
            <th class="text-center sortable" onclick="sortTable(3)">–í—Å–µ–≥–æ<br>–ª—é–¥–µ–π</th>
            <th class="text-right sortable" onclick="sortTable(4)">–ì—Ä–∞–Ω—Ç<br>(–¥–æ—Ö–æ–¥)</th>
            <th class="text-right sortable" onclick="sortTable(5)">–ó–∞—Ä–ø–ª–∞—Ç–∞</th>
            <th class="text-right sortable" onclick="sortTable(6)">–ê—Ä–µ–Ω–¥–∞<br>–∑–∞–ª–∞</th>
            <th class="text-right sortable" onclick="sortTable(7)">–ß–∏—Å—Ç–∞—è<br>–ø—Ä–∏–±—ã–ª—å</th>
            <th class="text-center sortable" onclick="sortTable(8)">–†–µ–Ω—Ç–∞-<br>–±–µ–ª—å–Ω–æ—Å—Ç—å</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
        <tfoot style="background: #0f172a; font-weight: bold;" id="tableFoot"></tfoot>
      </table>
    </div>
    
    <div class="info-box fade-in">
      <div class="info-title">üí° –ö–∞–∫ —á–∏—Ç–∞—Ç—å –æ—Ç—á—ë—Ç</div>
      <div class="info-grid">
        <div class="info-item">
          <strong>üìÖ –†–∞–±–æ—á–∏—Ö –¥–Ω–µ–π</strong>
          –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –¥–∞—Ç –∑–∞–Ω—è—Ç–∏–π –ø–µ–¥–∞–≥–æ–≥–∞
        </div>
        <div class="info-item">
          <strong>üéì –ó–∞–Ω—è—Ç–∏–π</strong>
          –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ–¥—ë–Ω–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π
        </div>
        <div class="info-item">
          <strong>üë• –í—Å–µ–≥–æ –ª—é–¥–µ–π</strong>
          –°—É–º–º–∞—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–∞ –≤—Å–µ—Ö –∑–∞–Ω—è—Ç–∏—è—Ö
        </div>
        <div class="info-item">
          <strong>üí∞ –ì—Ä–∞–Ω—Ç (–¥–æ—Ö–æ–¥)</strong>
          –ì–æ—Å–ø–æ–¥–¥–µ—Ä–∂–∫–∞: –∫–æ–ª-–≤–æ –ª—é–¥–µ–π √ó 280‚ÇΩ
        </div>
        <div class="info-item">
          <strong>üíµ –ó–∞—Ä–ø–ª–∞—Ç–∞</strong>
          –ù–∞—á–∏—Å–ª–µ–Ω–æ –ø–µ–¥–∞–≥–æ–≥—É (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –∏–ª–∏ % –æ—Ç –¥–æ—Ö–æ–¥–∞)
        </div>
        <div class="info-item">
          <strong>üè¢ –ê—Ä–µ–Ω–¥–∞ –∑–∞–ª–∞</strong>
          –ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø–æ–º–µ—â–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
        </div>
        <div class="info-item">
          <strong>üíé –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</strong>
          –ì—Ä–∞–Ω—Ç - –ó–∞—Ä–ø–ª–∞—Ç–∞ - –ê—Ä–µ–Ω–¥–∞
        </div>
        <div class="info-item">
          <strong>üìä –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å</strong>
          –î–æ–ª—è –ø—Ä–∏–±—ã–ª–∏ –æ—Ç –¥–æ—Ö–æ–¥–∞ (üü¢>50% üü°>30% üî¥<30%)
        </div>
      </div>
    </div>
    
    <div style="margin-top: 30px; padding: 20px; background: #1e293b; border-radius: 12px;">
      <h3 style="color: #93c5fd; margin-bottom: 15px;">üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö</h3>
      <p style="color: #cbd5e1; line-height: 1.8; margin-bottom: 10px;">
        –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ—Ç HTML —Ñ–∞–π–ª –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∏ –Ω–∞–π–¥–∏—Ç–µ –±–ª–æ–∫ —Å –¥–∞–Ω–Ω—ã–º–∏. 
        –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–µ–¥–∞–≥–æ–≥–∞ —É–∫–∞–∂–∏—Ç–µ:
      </p>
      <ul style="color: #94a3b8; line-height: 2; margin-left: 20px;">
        <li><strong style="color: #fbbf24;">name</strong> - –§–ò–û –ø–µ–¥–∞–≥–æ–≥–∞</li>
        <li><strong style="color: #fbbf24;">location</strong> - –º–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∑–∞–Ω—è—Ç–∏–π</li>
        <li><strong style="color: #fbbf24;">salaryType</strong> - "fixed" (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è) –∏–ª–∏ "percent" (–ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –¥–æ—Ö–æ–¥–∞)</li>
        <li><strong style="color: #fbbf24;">salaryValue</strong> - —Å—É–º–º–∞ –≤ —Ä—É–±–ª—è—Ö –∏–ª–∏ –ø—Ä–æ—Ü–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä: 50 –¥–ª—è 50%)</li>
        <li><strong style="color: #fbbf24;">hallCostPerSession</strong> - —Å—Ç–æ–∏–º–æ—Å—Ç—å –∞—Ä–µ–Ω–¥—ã –∑–∞ –æ–¥–Ω–æ –∑–∞–Ω—è—Ç–∏–µ (0 –µ—Å–ª–∏ –Ω–µ—Ç)</li>
        <li><strong style="color: #fbbf24;">sessions</strong> - –º–∞—Å—Å–∏–≤ –∑–∞–Ω—è—Ç–∏–π —Å –¥–∞—Ç–æ–π –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ª—é–¥–µ–π</li>
      </ul>
    </div>
  </div>
  
  <!-- –¶–µ–Ω—Ç—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
  <div class="notification-center" id="notificationCenter" style="display: none;"></div>
  
  <!-- –ö–Ω–æ–ø–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
  <div class="notification-bell" id="notificationBell" onclick="toggleNotifications()">
    üîî
    <div class="notification-badge" id="notificationBadge" style="display: none;">0</div>
  </div>
  
  <div class="modal" id="detailModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">–î–µ—Ç–∞–ª–∏ –ø–µ–¥–∞–≥–æ–≥–∞</div>
        <button class="close-btn" onclick="closeModal()">√ó</button>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>
  
  <div class="modal" id="editModal">
    <div class="modal-content wide">
      <div class="modal-header">
        <div class="modal-title" id="editModalTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ–¥–∞–≥–æ–≥–∞</div>
        <button class="close-btn" onclick="closeEditModal()">√ó</button>
      </div>
      <div id="editModalBody"></div>
    </div>
  </div>
  
  <div class="modal" id="quickAddModal">
    <div class="modal-content wide">
      <div class="modal-header">
        <div class="modal-title">‚ö° –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–Ω—è—Ç–∏—è</div>
        <button class="close-btn" onclick="closeQuickAddModal()">√ó</button>
      </div>
      <div id="quickAddModalBody"></div>
    </div>
  </div>

  <script>
    // ============================================
    // üëá –†–ï–î–ê–ö–¢–ò–†–£–ô–¢–ï –î–ê–ù–ù–´–ï –ó–î–ï–°–¨ üëá
    // ============================================
    
    const GRANT_PER_PERSON = 280; // –ì—Ä–∞–Ω—Ç –∑–∞ –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ (‚ÇΩ)
    
    // –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
    let teachersData = [];
    const savedData = localStorage.getItem('teachersData');
    
    if (savedData) {
      try {
        teachersData = JSON.parse(savedData);
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
        teachersData = getDefaultData();
      }
    } else {
      teachersData = getDefaultData();
    }
    
    // –¶–µ–ª–∏ –∏ KPI
    let goals = {};
    const savedGoals = localStorage.getItem('goals');
    if (savedGoals) {
      try {
        goals = JSON.parse(savedGoals);
      } catch (e) {
        goals = getDefaultGoals();
      }
    } else {
      goals = getDefaultGoals();
    }
    
    function getDefaultGoals() {
      return {
        monthlyIncome: 50000,
        monthlySessions: 20,
        monthlyPeople: 300,
        profitability: 60,
        teacherCount: 5
      };
    }
    
    function saveGoals() {
      try {
        localStorage.setItem('goals', JSON.stringify(goals));
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–µ–ª–µ–π:', e);
      }
    }
    
    // –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    let notifications = [];
    let notificationId = 1;
    
    function addNotification(type, title, message, action = null) {
      const notification = {
        id: notificationId++,
        type, // 'info', 'warning', 'error', 'success'
        title,
        message,
        action,
        timestamp: new Date(),
        read: false
      };
      
      notifications.unshift(notification);
      if (notifications.length > 20) notifications.pop();
      
      renderNotifications();
      updateNotificationBadge();
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –µ—Å–ª–∏ info –∏–ª–∏ success
      if (type === 'info' || type === 'success') {
        setTimeout(() => {
          removeNotification(notification.id);
        }, 5000);
      }
      
      return notification.id;
    }
    
    function removeNotification(id) {
      notifications = notifications.filter(n => n.id !== id);
      renderNotifications();
      updateNotificationBadge();
    }
    
    function markAsRead(id) {
      const notification = notifications.find(n => n.id === id);
      if (notification) {
        notification.read = true;
        updateNotificationBadge();
      }
    }
    
    function toggleNotifications() {
      const center = document.getElementById('notificationCenter');
      const isVisible = center.style.display !== 'none';
      center.style.display = isVisible ? 'none' : 'block';
      
      if (!isVisible) {
        notifications.forEach(n => n.read = true);
        updateNotificationBadge();
      }
    }
    
    function updateNotificationBadge() {
      const unread = notifications.filter(n => !n.read).length;
      const badge = document.getElementById('notificationBadge');
      
      if (unread > 0) {
        badge.textContent = unread > 9 ? '9+' : unread;
        badge.style.display = 'flex';
      } else {
        badge.style.display = 'none';
      }
    }
    
    function renderNotifications() {
      const container = document.getElementById('notificationCenter');
      
      if (notifications.length === 0) {
        container.innerHTML = `
          <div class="notification-item">
            <div class="notification-body" style="text-align: center;">
              üì≠ –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            </div>
          </div>
        `;
        return;
      }
      
      container.innerHTML = notifications.map(n => {
        const timeAgo = getTimeAgo(n.timestamp);
        return `
          <div class="notification-item ${n.type}" onclick="handleNotificationClick(${n.id})" style="${n.read ? 'opacity: 0.6;' : ''}">
            <div class="notification-header">
              <span class="notification-title">${n.title}</span>
              <span class="notification-time">${timeAgo}</span>
              <button class="notification-close" onclick="event.stopPropagation(); removeNotification(${n.id})">√ó</button>
            </div>
            <div class="notification-body">${n.message}</div>
          </div>
        `;
      }).join('');
    }
    
    function handleNotificationClick(id) {
      const notification = notifications.find(n => n.id === id);
      if (notification && notification.action) {
        notification.action();
        removeNotification(id);
        toggleNotifications();
      } else {
        markAsRead(id);
      }
    }
    
    function getTimeAgo(date) {
      const seconds = Math.floor((new Date() - date) / 1000);
      if (seconds < 60) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
      const minutes = Math.floor(seconds / 60);
      if (minutes < 60) return `${minutes} –º–∏–Ω –Ω–∞–∑–∞–¥`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `${hours} —á –Ω–∞–∑–∞–¥`;
      const days = Math.floor(hours / 24);
      return `${days} –¥–Ω –Ω–∞–∑–∞–¥`;
    }
    
    function checkAndNotify() {
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–µ–π
      const teachersWithDebt = window.teachers.filter(t => t.debt > 0);
      
      if (teachersWithDebt.length > 0) {
        const totalDebt = teachersWithDebt.reduce((sum, t) => sum + t.debt, 0);
        
        teachersWithDebt.forEach(teacher => {
          if (teacher.debt > 5000) {
            addNotification(
              'error',
              '‚ö†Ô∏è –ë–æ–ª—å—à–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å',
              `${teacher.name}: ${formatNumber(teacher.debt)}‚ÇΩ –Ω–µ –≤—ã–ø–ª–∞—á–µ–Ω–æ`,
              () => showPaymentModal(teacher.id)
            );
          }
        });
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∏–∑–∫–æ–π —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏
      const lowProfitTeachers = window.teachers.filter(t => t.profitability < 30 && t.profitability > 0);
      
      if (lowProfitTeachers.length > 0) {
        lowProfitTeachers.forEach(teacher => {
          addNotification(
            'warning',
            'üìâ –ù–∏–∑–∫–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å',
            `${teacher.name}: –≤—Å–µ–≥–æ ${teacher.profitability}% —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏`,
            () => showEditTeacherModal(teacher.id)
          );
        });
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
      const now = new Date();
      const weekAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);
      
      const recentSessions = window.teachers.reduce((count, t) => {
        return count + t.sessions.filter(s => new Date(s.date) > weekAgo).length;
      }, 0);
      
      if (recentSessions === 0 && window.teachers.length > 0) {
        addNotification(
          'warning',
          'üìÖ –ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–Ω—è—Ç–∏–π',
          '–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –∑–∞–Ω—è—Ç–∏—è',
          () => {
            toggleFilters();
            document.getElementById('filterBar').scrollIntoView({ behavior: 'smooth' });
          }
        );
      }
      
      // –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      const topTeacher = [...window.teachers].sort((a, b) => b.profitability - a.profitability)[0];
      if (topTeacher && topTeacher.profitability > 70) {
        addNotification(
          'success',
          'üèÜ –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!',
          `${topTeacher.name} –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å ${topTeacher.profitability}%!`
        );
      }
    }
    
    function renderReminderBanners() {
      const container = document.getElementById('reminderBanners');
      const banners = [];
      
      // –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –≤—ã–ø–ª–∞—Ç–∞—Ö
      const unpaidTeachers = window.teachers.filter(t => t.debt > 0);
      if (unpaidTeachers.length > 0) {
        const totalDebt = unpaidTeachers.reduce((sum, t) => sum + t.debt, 0);
        banners.push(`
          <div class="reminder-banner">
            <div class="reminder-text">
              <strong>üí≥ –ï—Å—Ç—å –Ω–µ–≤—ã–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∑–∞—Ä–ø–ª–∞—Ç—ã</strong><br>
              ${unpaidTeachers.length} –ø–µ–¥–∞–≥–æ–≥–æ–≤ –æ–∂–∏–¥–∞—é—Ç –≤—ã–ø–ª–∞—Ç—É –Ω–∞ —Å—É–º–º—É ${formatNumber(totalDebt)}‚ÇΩ
            </div>
            <button class="reminder-action" onclick="document.getElementById('paymentsTable').scrollIntoView({ behavior: 'smooth' });">
              –ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—ã–ø–ª–∞—Ç–∞–º
            </button>
          </div>
        `);
      }
      
      // –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
      const today = new Date().toISOString().split('T')[0];
      const todaySessions = window.teachers.reduce((count, t) => {
        return count + t.sessions.filter(s => s.date === today).length;
      }, 0);
      
      if (todaySessions === 0 && new Date().getHours() > 16) {
        banners.push(`
          <div class="reminder-banner info">
            <div class="reminder-text">
              <strong>üìù –ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ</strong><br>
              –°–µ–≥–æ–¥–Ω—è –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –∑–∞–Ω—è—Ç–∏—è
            </div>
            <button class="reminder-action" onclick="showAddTeacherModal()">
              –î–æ–±–∞–≤–∏—Ç—å –∑–∞–Ω—è—Ç–∏–µ
            </button>
          </div>
        `);
      }
      
      container.innerHTML = banners.join('');
    }
    
    function getDefaultData() {
      return [
        {
          id: 1,
          name: "–ò–≤–∞–Ω–æ–≤–∞ –ú–∞—Ä–∏—è",
          location: "–ë—É–¥–µ–Ω–Ω–æ–≥–æ",
          salaryType: "percent",
          salaryValue: 50,
          hallCostPerSession: 0,
          payments: [],
          profile: {
            photo: null,
            phone: "+7 (999) 123-45-67",
            email: "ivanova@example.com",
            startDate: "2024-01-15",
            rating: 4.8,
            reviews: [],
            notes: "–û–ø—ã—Ç–Ω—ã–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –π–æ–≥–∏"
          },
          sessions: [
            { date: "2024-12-01", people: 12 },
            { date: "2024-12-05", people: 15 },
            { date: "2024-12-10", people: 14 },
            { date: "2024-12-15", people: 8 }
          ]
        },
        {
          id: 2,
          name: "–°–∏–¥–æ—Ä–æ–≤–∞ –ê–Ω–Ω–∞",
          location: "–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è",
          salaryType: "fixed",
          salaryValue: 1000,
          hallCostPerSession: 0,
          payments: [],
          profile: {
            photo: null,
            phone: "+7 (999) 234-56-78",
            email: "sidorova@example.com",
            startDate: "2024-03-01",
            rating: 4.9,
            reviews: [],
            notes: "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Ç–∞–Ω—Ü–∞–º"
          },
          sessions: [
            { date: "2024-12-03", people: 18 },
            { date: "2024-12-10", people: 21 },
            { date: "2024-12-17", people: 19 }
          ]
        },
        {
          id: 3,
          name: "–ü–µ—Ç—Ä–æ–≤ –°–µ—Ä–≥–µ–π",
          location: "–ü–∞—Ä–∫",
          salaryType: "fixed",
          salaryValue: 700,
          hallCostPerSession: 500,
          payments: [],
          profile: {
            photo: null,
            phone: "+7 (999) 345-67-89",
            email: "petrov@example.com",
            startDate: "2024-02-10",
            rating: 4.5,
            reviews: [],
            notes: "–¢—Ä–µ–Ω–µ—Ä –ø–æ —Ñ–∏—Ç–Ω–µ—Å—É"
          },
          sessions: [
            { date: "2024-12-02", people: 10 },
            { date: "2024-12-09", people: 13 },
            { date: "2024-12-16", people: 11 }
          ]
        },
        {
          id: 4,
          name: "–ö–æ–∑–ª–æ–≤–∞ –ï–ª–µ–Ω–∞",
          location: "–°–æ–∫–æ–ª—å–Ω–∏–∫–∏",
          salaryType: "percent",
          salaryValue: 40,
          hallCostPerSession: 800,
          payments: [],
          profile: {
            photo: null,
            phone: "+7 (999) 456-78-90",
            email: "kozlova@example.com",
            startDate: "2023-11-20",
            rating: 5.0,
            reviews: [],
            notes: "–ú–∞—Å—Ç–µ—Ä –ø–æ —Å–∫–∞–Ω–¥–∏–Ω–∞–≤—Å–∫–æ–π —Ö–æ–¥—å–±–µ"
          },
          sessions: [
            { date: "2024-12-04", people: 25 },
            { date: "2024-12-11", people: 22 },
            { date: "2024-12-18", people: 20 }
          ]
        }
      ];
    }
    
    function saveData() {
      try {
        localStorage.setItem('teachersData', JSON.stringify(teachersData));
        showAlert('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
      } catch (e) {
        showAlert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + e.message, 'error');
      }
    }
    
    function showAlert(message, type = 'success') {
      const alert = document.createElement('div');
      alert.className = `alert ${type === 'error' ? 'error' : ''}`;
      alert.textContent = message;
      document.body.appendChild(alert);
      
      setTimeout(() => {
        alert.style.animation = 'slideInRight 0.3s ease reverse';
        setTimeout(() => alert.remove(), 300);
      }, 2000);
    }
    
    // ============================================
    // ‚òùÔ∏è –†–ï–î–ê–ö–¢–ò–†–£–ô–¢–ï –¢–û–õ–¨–ö–û –í–´–®–ï ‚òùÔ∏è
    // ============================================
    
    let currentPeriodFilter = {
      type: 'current_month',
      dateFrom: null,
      dateTo: null
    };
    
    function getPeriodDates(periodType) {
      const now = new Date();
      let from, to;
      
      switch(periodType) {
        case 'all':
          return { from: null, to: null };
        
        case 'current_month':
          from = new Date(now.getFullYear(), now.getMonth(), 1);
          to = new Date(now.getFullYear(), now.getMonth() + 1, 0);
          break;
        
        case 'last_month':
          from = new Date(now.getFullYear(), now.getMonth() - 1, 1);
          to = new Date(now.getFullYear(), now.getMonth(), 0);
          break;
        
        case 'current_quarter':
          const currentQuarter = Math.floor(now.getMonth() / 3);
          from = new Date(now.getFullYear(), currentQuarter * 3, 1);
          to = new Date(now.getFullYear(), (currentQuarter + 1) * 3, 0);
          break;
        
        case 'last_quarter':
          const lastQuarter = Math.floor(now.getMonth() / 3) - 1;
          const year = lastQuarter < 0 ? now.getFullYear() - 1 : now.getFullYear();
          const quarter = lastQuarter < 0 ? 3 : lastQuarter;
          from = new Date(year, quarter * 3, 1);
          to = new Date(year, (quarter + 1) * 3, 0);
          break;
        
        case 'current_year':
          from = new Date(now.getFullYear(), 0, 1);
          to = new Date(now.getFullYear(), 11, 31);
          break;
        
        case 'custom':
          const fromInput = document.getElementById('dateFrom').value;
          const toInput = document.getElementById('dateTo').value;
          from = fromInput ? new Date(fromInput) : null;
          to = toInput ? new Date(toInput) : null;
          break;
        
        default:
          return { from: null, to: null };
      }
      
      return { from, to };
    }
    
    function filterSessionsByPeriod(sessions, from, to) {
      if (!from && !to) return sessions;
      
      return sessions.filter(s => {
        const sessionDate = new Date(s.date);
        if (from && sessionDate < from) return false;
        if (to && sessionDate > to) return false;
        return true;
      });
    }
    
    function applyPeriodFilter() {
      const periodType = document.getElementById('periodFilter').value;
      const customFrom = document.getElementById('customDateFrom');
      const customTo = document.getElementById('customDateTo');
      
      if (periodType === 'custom') {
        customFrom.style.display = 'flex';
        customTo.style.display = 'flex';
      } else {
        customFrom.style.display = 'none';
        customTo.style.display = 'none';
      }
      
      const dates = getPeriodDates(periodType);
      currentPeriodFilter = {
        type: periodType,
        dateFrom: dates.from,
        dateTo: dates.to
      };
      
      // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –Ω–µ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥
      const compareBtn = document.getElementById('compareBtn');
      compareBtn.style.display = periodType !== 'all' ? 'inline-block' : 'none';
      
      updateDisplay();
    }
    
    function comparePeriods() {
      const periodType = currentPeriodFilter.type;
      if (periodType === 'all' || periodType === 'custom') {
        alert('–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤');
        return;
      }
      
      // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞ —Ç–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥
      const currentDates = getPeriodDates(periodType);
      const currentData = calculatePeriodData(currentDates.from, currentDates.to);
      
      // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–µ—Ä–∏–æ–¥
      let previousPeriodType;
      switch(periodType) {
        case 'current_month':
          previousPeriodType = 'last_month';
          break;
        case 'current_quarter':
          previousPeriodType = 'last_quarter';
          break;
        default:
          alert('–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞');
          return;
      }
      
      const previousDates = getPeriodDates(previousPeriodType);
      const previousData = calculatePeriodData(previousDates.from, previousDates.to);
      
      showComparison(currentData, previousData, periodType);
    }
    
    function calculatePeriodData(from, to) {
      const filteredTeachers = teachersData.map(teacher => ({
        ...teacher,
        sessions: filterSessionsByPeriod(teacher.sessions, from, to)
      })).map(calculateTeacherStats);
      
      const totalPeople = filteredTeachers.reduce((sum, t) => sum + t.totalPeople, 0);
      const totalIncome = filteredTeachers.reduce((sum, t) => sum + t.totalIncome, 0);
      const totalSalary = filteredTeachers.reduce((sum, t) => sum + t.salary, 0);
      const totalHallCost = filteredTeachers.reduce((sum, t) => sum + t.hallCost, 0);
      const totalSessions = filteredTeachers.reduce((sum, t) => sum + t.sessionsCount, 0);
      
      return {
        people: totalPeople,
        income: totalIncome,
        salary: totalSalary,
        hallCost: totalHallCost,
        profit: totalIncome - totalSalary - totalHallCost,
        sessions: totalSessions
      };
    }
    
    function showComparison(current, previous, periodType) {
      const container = document.getElementById('periodComparison');
      
      const periodNames = {
        'current_month': ['–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü', '–ü—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü'],
        'current_quarter': ['–¢–µ–∫—É—â–∏–π –∫–≤–∞—Ä—Ç–∞–ª', '–ü—Ä–æ—à–ª—ã–π –∫–≤–∞—Ä—Ç–∞–ª']
      };
      
      const names = periodNames[periodType] || ['–¢–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥', '–ü—Ä–µ–¥—ã–¥—É—â–∏–π –ø–µ—Ä–∏–æ–¥'];
      
      function getChange(curr, prev) {
        if (prev === 0) return curr > 0 ? '+100%' : '0%';
        const change = ((curr - prev) / prev * 100).toFixed(1);
        return change > 0 ? `+${change}%` : `${change}%`;
      }
      
      function getChangeClass(curr, prev) {
        return curr >= prev ? 'green' : 'red';
      }
      
      container.innerHTML = `
        <div class="info-box" style="border-left-color: #8b5cf6;">
          <div class="info-title">üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤</div>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
            <div style="background: #334155; padding: 15px; border-radius: 8px;">
              <div style="color: #94a3b8; font-size: 12px; margin-bottom: 5px;">–ó–∞–Ω—è—Ç–∏–π</div>
              <div style="font-size: 24px; font-weight: bold;">${current.sessions}</div>
              <div class="${getChangeClass(current.sessions, previous.sessions)}" style="font-size: 13px; margin-top: 5px;">
                ${getChange(current.sessions, previous.sessions)} vs ${names[1]}
              </div>
            </div>
            <div style="background: #334155; padding: 15px; border-radius: 8px;">
              <div style="color: #94a3b8; font-size: 12px; margin-bottom: 5px;">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
              <div style="font-size: 24px; font-weight: bold;">${current.people}</div>
              <div class="${getChangeClass(current.people, previous.people)}" style="font-size: 13px; margin-top: 5px;">
                ${getChange(current.people, previous.people)} vs ${names[1]}
              </div>
            </div>
            <div style="background: #334155; padding: 15px; border-radius: 8px;">
              <div style="color: #94a3b8; font-size: 12px; margin-bottom: 5px;">–ì—Ä–∞–Ω—Ç</div>
              <div style="font-size: 24px; font-weight: bold;" class="green">${formatNumber(current.income)}‚ÇΩ</div>
              <div class="${getChangeClass(current.income, previous.income)}" style="font-size: 13px; margin-top: 5px;">
                ${getChange(current.income, previous.income)} vs ${names[1]}
              </div>
            </div>
            <div style="background: #334155; padding: 15px; border-radius: 8px;">
              <div style="color: #94a3b8; font-size: 12px; margin-bottom: 5px;">–ü—Ä–∏–±—ã–ª—å</div>
              <div style="font-size: 24px; font-weight: bold;" class="blue">${formatNumber(current.profit)}‚ÇΩ</div>
              <div class="${getChangeClass(current.profit, previous.profit)}" style="font-size: 13px; margin-top: 5px;">
                ${getChange(current.profit, previous.profit)} vs ${names[1]}
              </div>
            </div>
          </div>
        </div>
      `;
      
      container.style.display = 'block';
      container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
    
    function updateDisplay() {
      // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º teachers —Å —É—á–µ—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞
      window.teachers = teachersData.map(teacher => ({
        ...teacher,
        sessions: filterSessionsByPeriod(teacher.sessions, currentPeriodFilter.dateFrom, currentPeriodFilter.dateTo)
      })).map(calculateTeacherStats).filter(t => t.sessionsCount > 0);
      
      renderStats();
      renderCharts();
      renderTable();
      renderPaymentsTable();
      renderTopTeachers();
      renderWeekdayAnalytics();
      renderWeeklyTrend();
      renderForecast();
      applyFilters();
      
      // –°–∫—Ä—ã—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–µ—Ä–∏–æ–¥–∞
      document.getElementById('periodComparison').style.display = 'none';
    }
    
    function resetFilters() {
      document.getElementById('periodFilter').value = 'current_month';
      document.getElementById('locationFilter').value = '';
      document.getElementById('minSessions').value = '';
      document.getElementById('searchInput').value = '';
      applyPeriodFilter();
    }
    
    function calculateTeacherStats(teacher) {
      const totalPeople = teacher.sessions.reduce((sum, s) => sum + s.people, 0);
      const totalIncome = totalPeople * GRANT_PER_PERSON;
      const sessionsCount = teacher.sessions.length;
      const uniqueDates = new Set(teacher.sessions.map(s => s.date)).size;
      
      let salary = 0;
      let hallCost = 0;
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∑–∞—Ä–ø–ª–∞—Ç—É –∏ –∞—Ä–µ–Ω–¥—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–Ω—è—Ç–∏—è
      teacher.sessions.forEach(session => {
        const sessionIncome = session.people * GRANT_PER_PERSON;
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∑–∞–Ω—è—Ç–∏—è –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∏–∑ –ø–µ–¥–∞–≥–æ–≥–∞
        const sessionSalaryType = session.salaryType || teacher.salaryType;
        const sessionSalaryValue = session.salaryValue || teacher.salaryValue;
        const sessionHallCost = session.hallCost !== undefined ? session.hallCost : teacher.hallCostPerSession;
        
        if (sessionSalaryType === "fixed") {
          salary += sessionSalaryValue;
        } else if (sessionSalaryType === "percent") {
          salary += Math.round((sessionIncome * sessionSalaryValue) / 100);
        }
        
        hallCost += sessionHallCost;
      });
      
      const profit = totalIncome - salary - hallCost;
      const profitability = totalIncome > 0 ? Math.round((profit / totalIncome) * 100) : 0;
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—ã–ø–ª–∞—Ç—ã
      const payments = teacher.payments || [];
      const totalPaid = payments.reduce((sum, p) => sum + p.amount, 0);
      const debt = salary - totalPaid;
      const paymentStatus = debt === 0 ? 'paid' : debt === salary ? 'unpaid' : 'partial';
      
      return {
        ...teacher,
        totalPeople,
        totalIncome,
        sessionsCount,
        uniqueDates,
        salary,
        hallCost,
        profit,
        profitability,
        totalPaid,
        debt,
        paymentStatus
      };
    }
    
    const teachers = teachersData.map(calculateTeacherStats);
    window.teachers = teachers;
    
    function formatNumber(num) {
      return num.toLocaleString('ru-RU');
    }
    
    function calculateTotals() {
      return {
        teachers: window.teachers.length,
        workDays: window.teachers.reduce((sum, t) => sum + t.uniqueDates, 0),
        sessions: window.teachers.reduce((sum, t) => sum + t.sessionsCount, 0),
        totalPeople: window.teachers.reduce((sum, t) => sum + t.totalPeople, 0),
        income: window.teachers.reduce((sum, t) => sum + t.totalIncome, 0),
        salary: window.teachers.reduce((sum, t) => sum + t.salary, 0),
        hallCost: window.teachers.reduce((sum, t) => sum + t.hallCost, 0),
        profit: window.teachers.reduce((sum, t) => sum + t.profit, 0)
      };
    }
    
    function renderStats() {
      const totals = calculateTotals();
      const avgProfitability = totals.income > 0 ? Math.round((totals.profit / totals.income) * 100) : 0;
      const container = document.getElementById('statsContainer');
      
      container.innerHTML = `
        <div class="stat-card">
          <div class="stat-label">–ü–µ–¥–∞–≥–æ–≥–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
          <div class="stat-value">${totals.teachers}</div>
          <div class="stat-change">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤</div>
        </div>
        <div class="stat-card purple">
          <div class="stat-label">–í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
          <div class="stat-value">${totals.totalPeople}</div>
          <div class="stat-change">${totals.sessions} –∑–∞–Ω—è—Ç–∏–π –ø—Ä–æ–≤–µ–¥–µ–Ω–æ</div>
        </div>
        <div class="stat-card green">
          <div class="stat-label">–ì—Ä–∞–Ω—Ç –æ—Ç –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞</div>
          <div class="stat-value">${formatNumber(totals.income)}‚ÇΩ</div>
          <div class="stat-change">${formatNumber(totals.totalPeople)} √ó ${GRANT_PER_PERSON}‚ÇΩ</div>
        </div>
        <div class="stat-card yellow">
          <div class="stat-label">–í—ã–ø–ª–∞—á–µ–Ω–æ –∑–∞—Ä–ø–ª–∞—Ç</div>
          <div class="stat-value">${formatNumber(totals.salary)}‚ÇΩ</div>
          <div class="stat-change">–°—Ä–µ–¥–Ω—è—è: ${formatNumber(Math.round(totals.salary / totals.teachers))}‚ÇΩ</div>
        </div>
        <div class="stat-card red">
          <div class="stat-label">–†–∞—Å—Ö–æ–¥—ã –Ω–∞ –∑–∞–ª—ã</div>
          <div class="stat-value">${formatNumber(totals.hallCost)}‚ÇΩ</div>
          <div class="stat-change">${totals.hallCost > 0 ? '–ï—Å—Ç—å –∞—Ä–µ–Ω–¥–∞' : '–ë–µ–∑ –∞—Ä–µ–Ω–¥—ã'}</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #0e7490 0%, #0891b2 100%);">
          <div class="stat-label">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</div>
          <div class="stat-value">${formatNumber(totals.profit)}‚ÇΩ</div>
          <div class="stat-change">–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å: ${avgProfitability}%</div>
        </div>
      `;
    }
    
    function renderCharts() {
      const container = document.getElementById('chartsContainer');
      const maxIncome = Math.max(...window.teachers.map(t => t.totalIncome), 1);
      
      let incomeChart = [...window.teachers]
        .sort((a, b) => b.totalIncome - a.totalIncome)
        .map(t => `
          <div class="chart-bar">
            <div class="chart-label">${t.name.split(' ')[0]}</div>
            <div class="chart-bar-bg">
              <div class="chart-bar-fill" style="width: ${(t.totalIncome / maxIncome * 100)}%"></div>
            </div>
            <div class="chart-value">${formatNumber(t.totalIncome)}‚ÇΩ</div>
          </div>
        `).join('');
      
      let profitChart = [...window.teachers]
        .sort((a, b) => b.profitability - a.profitability)
        .map(t => {
          const color = t.profitability > 50 ? '#22c55e, #4ade80' : t.profitability > 30 ? '#eab308, #fbbf24' : '#ef4444, #f87171';
          const textColor = t.profitability > 50 ? 'green' : t.profitability > 30 ? 'yellow' : 'red';
          return `
            <div class="chart-bar">
              <div class="chart-label">${t.name.split(' ')[0]}</div>
              <div class="chart-bar-bg">
                <div class="chart-bar-fill" style="width: ${Math.max(t.profitability, 0)}%; background: linear-gradient(90deg, ${color})"></div>
              </div>
              <div class="chart-value ${textColor}">${t.profitability}%</div>
            </div>
          `;
        }).join('');
      
      container.innerHTML = `
        <div class="chart-card">
          <div class="chart-title">üìä –ì—Ä–∞–Ω—Ç –ø–æ –ø–µ–¥–∞–≥–æ–≥–∞–º</div>
          ${incomeChart}
        </div>
        <div class="chart-card">
          <div class="chart-title">üéØ –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ –ø–µ–¥–∞–≥–æ–≥–∞–º</div>
          ${profitChart}
        </div>
      `;
    }
    
    function renderTable() {
      const tbody = document.getElementById('tableBody');
      const tfoot = document.getElementById('tableFoot');
      const totals = calculateTotals();
      const avgProfitability = totals.income > 0 ? Math.round((totals.profit / totals.income) * 100) : 0;
      
      tbody.innerHTML = window.teachers.map(t => {
        const profitClass = t.profitability > 50 ? 'high' : t.profitability > 30 ? 'medium' : 'low';
        const salaryInfo = t.salaryType === 'percent' ? `${t.salaryValue}%` : `${formatNumber(t.salaryValue)}‚ÇΩ/–∑–∞–Ω—è—Ç–∏–µ`;
        
        return `
          <tr onclick='showTeacherDetails(${JSON.stringify(t).replace(/'/g, "&#39;")})'>
            <td>
              <div class="teacher-name">${t.name}</div>
              <div class="teacher-location">üìç ${t.location} ‚Ä¢ ${salaryInfo}</div>
            </td>
            <td class="text-center"><span class="badge">${t.uniqueDates}</span></td>
            <td class="text-center">${t.sessionsCount}</td>
            <td class="text-center"><span class="badge" style="background: #7c3aed;">${t.totalPeople}</span></td>
            <td class="text-right"><span class="amount green">${formatNumber(t.totalIncome)}‚ÇΩ</span></td>
            <td class="text-right"><span class="amount yellow">${formatNumber(t.salary)}‚ÇΩ</span></td>
            <td class="text-right"><span class="amount red">${formatNumber(t.hallCost)}‚ÇΩ</span></td>
            <td class="text-right"><span class="amount blue">${formatNumber(t.profit)}‚ÇΩ</span></td>
            <td>
              <div class="progress-bar">
                <div class="progress-fill ${profitClass}" style="width: ${Math.max(t.profitability, 0)}%"></div>
              </div>
              <div class="text-center" style="font-size: 13px; font-weight: bold;">${t.profitability}%</div>
            </td>
          </tr>
        `;
      }).join('');
      
      tfoot.innerHTML = `
        <tr>
          <td>–ò–¢–û–ì–û:</td>
          <td class="text-center blue">${totals.workDays}</td>
          <td class="text-center">${totals.sessions}</td>
          <td class="text-center purple">${totals.totalPeople}</td>
          <td class="text-right green">${formatNumber(totals.income)}‚ÇΩ</td>
          <td class="text-right yellow">${formatNumber(totals.salary)}‚ÇΩ</td>
          <td class="text-right red">${formatNumber(totals.hallCost)}‚ÇΩ</td>
          <td class="text-right blue">${formatNumber(totals.profit)}‚ÇΩ</td>
          <td class="text-center">${avgProfitability}%</td>
        </tr>
      `;
      
      const locations = [...new Set(window.teachers.map(t => t.location))];
      const filter = document.getElementById('locationFilter');
      filter.innerHTML = '<option value="">–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏</option>' + 
        locations.map(loc => `<option value="${loc}">${loc}</option>`).join('');
    }
    
    function showTeacherDetails(teacher) {
      const avgPerSession = teacher.sessionsCount > 0 ? Math.round(teacher.totalIncome / teacher.sessionsCount) : 0;
      const avgPeoplePerSession = teacher.sessionsCount > 0 ? Math.round(teacher.totalPeople / teacher.sessionsCount) : 0;
      
      // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–µ–¥–∞–≥–æ–≥–∞
      const fullTeacher = teachersData.find(t => t.id === teacher.id);
      const profile = fullTeacher?.profile || {};
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞–∂
      const startDate = profile.startDate ? new Date(profile.startDate) : new Date();
      const now = new Date();
      const monthsWorked = Math.floor((now - startDate) / (1000 * 60 * 60 * 24 * 30));
      const yearsWorked = Math.floor(monthsWorked / 12);
      const remainingMonths = monthsWorked % 12;
      
      let experienceText = '';
      if (yearsWorked > 0) experienceText += `${yearsWorked} ${yearsWorked === 1 ? '–≥–æ–¥' : yearsWorked < 5 ? '–≥–æ–¥–∞' : '–ª–µ—Ç'}`;
      if (remainingMonths > 0) experienceText += ` ${remainingMonths} –º–µ—Å.`;
      if (!experienceText) experienceText = '–ù–æ–≤–∏—á–æ–∫';
      
      // –ò–Ω–∏—Ü–∏–∞–ª—ã –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞
      const initials = teacher.name.split(' ').map(n => n[0]).join('').toUpperCase();
      
      // –ó–≤—ë–∑–¥—ã —Ä–µ–π—Ç–∏–Ω–≥–∞
      const rating = profile.rating || 0;
      const stars = Array.from({length: 5}, (_, i) => 
        i < Math.floor(rating) ? '‚≠ê' : '‚òÜ'
      ).join('');
      
      document.getElementById('modalTitle').textContent = `–ü—Ä–æ—Ñ–∏–ª—å: ${teacher.name}`;
      
      const sessionsHTML = teacher.sessions.map(s => {
        const grant = s.people * GRANT_PER_PERSON;
        return `
          <div class="session-item">
            <div class="session-date">${s.date}</div>
            <div class="session-people">üë• ${s.people} —á–µ–ª.</div>
            <div></div>
            <div class="session-grant">${formatNumber(grant)}‚ÇΩ</div>
          </div>
        `;
      }).join('');
      
      document.getElementById('modalBody').innerHTML = `
        <!-- –ü—Ä–æ—Ñ–∏–ª—å –ø–µ–¥–∞–≥–æ–≥–∞ -->
        <div class="profile-header">
          <div class="profile-photo">
            ${profile.photo ? `<img src="${profile.photo}" alt="${teacher.name}">` : initials}
            <div class="profile-photo-upload" onclick="uploadTeacherPhoto(${teacher.id})" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ">üì∑</div>
          </div>
          <div class="profile-info">
            <div class="profile-name">${teacher.name}</div>
            <div class="profile-meta">
              <div class="profile-meta-item">üìç ${teacher.location}</div>
              <div class="profile-meta-item">üíº ${experienceText}</div>
              <div class="profile-meta-item">üìÖ –° ${new Date(startDate).toLocaleDateString('ru-RU')}</div>
            </div>
            <div class="profile-rating">
              <div class="stars">${stars}</div>
              <div class="rating-value">${rating.toFixed(1)}</div>
              <div style="color: #64748b; font-size: 13px;">‚Ä¢ ${profile.reviews?.length || 0} –æ—Ç–∑—ã–≤–æ–≤</div>
            </div>
            ${profile.notes ? `<div style="color: #94a3b8; font-size: 14px; margin-top: 8px; font-style: italic;">"${profile.notes}"</div>` : ''}
          </div>
        </div>
        
        <!-- –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="contact-info">
          <div style="color: #93c5fd; font-size: 14px; font-weight: bold; margin-bottom: 10px;">üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
          <div class="contact-item">
            üì± <a href="tel:${profile.phone}">${profile.phone || '–ù–µ —É–∫–∞–∑–∞–Ω'}</a>
          </div>
          <div class="contact-item">
            üìß <a href="mailto:${profile.email}">${profile.email || '–ù–µ —É–∫–∞–∑–∞–Ω'}</a>
          </div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="profile-stats">
          <div class="profile-stat-card">
            <div class="profile-stat-value">${teacher.sessionsCount}</div>
            <div class="profile-stat-label">–ó–∞–Ω—è—Ç–∏–π –ø—Ä–æ–≤–µ–¥–µ–Ω–æ</div>
          </div>
          <div class="profile-stat-card">
            <div class="profile-stat-value">${teacher.totalPeople}</div>
            <div class="profile-stat-label">–í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
          </div>
          <div class="profile-stat-card">
            <div class="profile-stat-value">${avgPeoplePerSession}</div>
            <div class="profile-stat-label">–°—Ä–µ–¥–Ω—è—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</div>
          </div>
          <div class="profile-stat-card">
            <div class="profile-stat-value green">${formatNumber(teacher.totalIncome)}‚ÇΩ</div>
            <div class="profile-stat-label">–ì—Ä–∞–Ω—Ç –ø–æ–ª—É—á–µ–Ω–æ</div>
          </div>
          <div class="profile-stat-card">
            <div class="profile-stat-value yellow">${formatNumber(teacher.salary)}‚ÇΩ</div>
            <div class="profile-stat-label">–ó–∞—Ä–ø–ª–∞—Ç–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–æ</div>
          </div>
          <div class="profile-stat-card">
            <div class="profile-stat-value ${teacher.profitability > 50 ? 'green' : 'yellow'}">${teacher.profitability}%</div>
            <div class="profile-stat-label">–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å</div>
          </div>
        </div>
        
        <!-- –û—Ç–∑—ã–≤—ã -->
        <div style="margin-bottom: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="color: #cbd5e1;">‚≠ê –û—Ç–∑—ã–≤—ã</h3>
            <button class="btn" style="padding: 6px 12px; font-size: 13px;" onclick="addReview(${teacher.id})">+ –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
          </div>
          <div id="reviewsList">
            ${profile.reviews && profile.reviews.length > 0 ? 
              profile.reviews.map(r => `
                <div class="review-item">
                  <div class="review-header">
                    <div class="review-rating">${'‚≠ê'.repeat(r.rating)}${'‚òÜ'.repeat(5-r.rating)}</div>
                    <div class="review-date">${new Date(r.date).toLocaleDateString('ru-RU')}</div>
                  </div>
                  <div class="review-text">${r.text}</div>
                </div>
              `).join('') : 
              '<p style="color: #94a3b8; text-align: center; padding: 20px;">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</p>'
            }
          </div>
        </div>
        
        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
          <button class="btn" onclick="showEditTeacherModal(${teacher.id})" style="flex: 1;">
            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
          </button>
          <button class="btn secondary" onclick="editTeacherContacts(${teacher.id})" style="flex: 1;">
            üìù –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã
          </button>
        </div>
        
        <div class="session-list">
          <h3 style="color: #cbd5e1; margin-bottom: 15px;">üìã –ò—Å—Ç–æ—Ä–∏—è –∑–∞–Ω—è—Ç–∏–π</h3>
          ${sessionsHTML}
        </div>
      `;
      document.getElementById('detailModal').classList.add('active');
    }
    
    function uploadTeacherPhoto(teacherId) {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (event) => {
          const teacher = teachersData.find(t => t.id === teacherId);
          if (teacher) {
            if (!teacher.profile) teacher.profile = {};
            teacher.profile.photo = event.target.result;
            saveData();
            showAlert('–§–æ—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!', 'success');
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const updatedTeacher = window.teachers.find(t => t.id === teacherId);
            if (updatedTeacher) showTeacherDetails(updatedTeacher);
          }
        };
        reader.readAsDataURL(file);
      };
      input.click();
    }
    
    function addReview(teacherId) {
      const rating = prompt('–û—Ü–µ–Ω–∫–∞ (1-5):');
      if (!rating || rating < 1 || rating > 5) return;
      
      const text = prompt('–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞:');
      if (!text) return;
      
      const teacher = teachersData.find(t => t.id === teacherId);
      if (teacher) {
        if (!teacher.profile) teacher.profile = {};
        if (!teacher.profile.reviews) teacher.profile.reviews = [];
        
        teacher.profile.reviews.unshift({
          rating: parseInt(rating),
          text: text,
          date: new Date().toISOString()
        });
        
        // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥
        const avgRating = teacher.profile.reviews.reduce((sum, r) => sum + r.rating, 0) / teacher.profile.reviews.length;
        teacher.profile.rating = Math.round(avgRating * 10) / 10;
        
        saveData();
        showAlert('–û—Ç–∑—ã–≤ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
        
        const updatedTeacher = window.teachers.find(t => t.id === teacherId);
        if (updatedTeacher) showTeacherDetails(updatedTeacher);
      }
    }
    
    function editTeacherContacts(teacherId) {
      const teacher = teachersData.find(t => t.id === teacherId);
      if (!teacher) return;
      
      if (!teacher.profile) teacher.profile = {};
      
      const phone = prompt('–¢–µ–ª–µ—Ñ–æ–Ω:', teacher.profile.phone || '');
      if (phone === null) return;
      
      const email = prompt('Email:', teacher.profile.email || '');
      if (email === null) return;
      
      const notes = prompt('–ü—Ä–∏–º–µ—á–∞–Ω–∏—è/–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:', teacher.profile.notes || '');
      if (notes === null) return;
      
      teacher.profile.phone = phone;
      teacher.profile.email = email;
      teacher.profile.notes = notes;
      
      saveData();
      showAlert('–ö–æ–Ω—Ç–∞–∫—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã!', 'success');
      
      const updatedTeacher = window.teachers.find(t => t.id === teacherId);
      if (updatedTeacher) showTeacherDetails(updatedTeacher);
    }
    
    function closeModal() {
      document.getElementById('detailModal').classList.remove('active');
    }
    
    function closeEditModal() {
      document.getElementById('editModal').classList.remove('active');
    }
    
    function closeQuickAddModal() {
      document.getElementById('quickAddModal').classList.remove('active');
    }
    
    function showQuickAddSessionModal() {
      const today = new Date().toISOString().split('T')[0];
      
      const teacherOptions = teachersData
        .sort((a, b) => a.name.localeCompare(b.name))
        .map(t => `<option value="${t.id}">${t.name}</option>`)
        .join('');
      
      document.getElementById('quickAddModalBody').innerHTML = `
        <div style="background: rgba(59, 130, 246, 0.1); border-left: 4px solid #3b82f6; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
          <p style="color: #cbd5e1; font-size: 14px; line-height: 1.6;">
            <strong style="color: #93c5fd;">üí° –ì–∏–±–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ:</strong><br>
            –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–Ω—è—Ç–∏—è! –õ–æ–∫–∞—Ü–∏—è, —Å—Ç–∞–≤–∫–∞ –∏ –∞—Ä–µ–Ω–¥–∞ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Ö –∏–∑–º–µ–Ω–∏—Ç—å.
          </p>
        </div>
        
        <form onsubmit="quickAddSession(event)">
          <div class="form-group">
            <label>–ü–µ–¥–∞–≥–æ–≥ *</label>
            <select id="quickTeacherId" required onchange="fillTeacherDefaults()">
              <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ–¥–∞–≥–æ–≥–∞ --</option>
              ${teacherOptions}
            </select>
          </div>
          
          <div class="form-group">
            <label>–î–∞—Ç–∞ –∑–∞–Ω—è—Ç–∏—è *</label>
            <input type="date" id="quickSessionDate" value="${today}" required onchange="updateQuickPreview()">
          </div>
          
          <div class="form-group">
            <label>–õ–æ–∫–∞—Ü–∏—è (–≥–¥–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –∑–∞–Ω—è—Ç–∏–µ) *</label>
            <input type="text" id="quickLocation" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ë—É–¥–µ–Ω–Ω–æ–≥–æ" required onchange="updateQuickPreview()">
          </div>
          
          <div class="form-group">
            <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ *</label>
            <input type="number" id="quickSessionPeople" min="1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 15" required oninput="updateQuickPreview()">
          </div>
          
          <div style="background: #334155; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
            <div style="color: #93c5fd; font-size: 13px; font-weight: bold; margin-bottom: 12px;">üí∞ –û–ø–ª–∞—Ç–∞ –∑–∞ —ç—Ç–æ –∑–∞–Ω—è—Ç–∏–µ:</div>
            
            <div class="form-group" style="margin-bottom: 12px;">
              <label>–¢–∏–ø –æ–ø–ª–∞—Ç—ã *</label>
              <select id="quickSalaryType" required onchange="updateQuickPreview(); toggleQuickSalaryInput()">
                <option value="percent">–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –¥–æ—Ö–æ–¥–∞</option>
                <option value="fixed">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞</option>
              </select>
            </div>
            
            <div class="form-group" style="margin-bottom: 12px;">
              <label id="quickSalaryLabel">–ü—Ä–æ—Ü–µ–Ω—Ç (%) *</label>
              <input type="number" id="quickSalaryValue" min="0" step="0.01" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 50" required oninput="updateQuickPreview()">
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
              <label>–ê—Ä–µ–Ω–¥–∞ –∑–∞–ª–∞ (‚ÇΩ)</label>
              <input type="number" id="quickHallCost" min="0" value="0" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 500" oninput="updateQuickPreview()">
            </div>
          </div>
          
          <div id="quickSessionPreview" style="background: #1e293b; border: 2px solid #3b82f6; padding: 20px; border-radius: 8px; margin-bottom: 15px; display: none;">
            <div style="color: #93c5fd; font-size: 13px; font-weight: bold; margin-bottom: 12px;">üìä –ò—Ç–æ–≥–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç:</div>
            <div id="previewContent"></div>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn secondary" onclick="closeQuickAddModal()">–û—Ç–º–µ–Ω–∞</button>
            <button type="submit" class="btn">‚ö° –î–æ–±–∞–≤–∏—Ç—å –∑–∞–Ω—è—Ç–∏–µ</button>
          </div>
        </form>
      `;
      
      document.getElementById('quickAddModal').classList.add('active');
    }
    
    function fillTeacherDefaults() {
      const teacherId = parseInt(document.getElementById('quickTeacherId').value);
      if (!teacherId) return;
      
      const teacher = teachersData.find(t => t.id === teacherId);
      if (!teacher) return;
      
      // –ó–∞–ø–æ–ª–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–µ–¥–∞–≥–æ–≥–∞
      document.getElementById('quickLocation').value = teacher.location;
      document.getElementById('quickSalaryType').value = teacher.salaryType;
      document.getElementById('quickSalaryValue').value = teacher.salaryValue;
      document.getElementById('quickHallCost').value = teacher.hallCostPerSession;
      
      toggleQuickSalaryInput();
      updateQuickPreview();
    }
    
    function toggleQuickSalaryInput() {
      const type = document.getElementById('quickSalaryType').value;
      const label = document.getElementById('quickSalaryLabel');
      label.textContent = type === 'percent' ? '–ü—Ä–æ—Ü–µ–Ω—Ç (%) *' : '–°—Ç–∞–≤–∫–∞ –∑–∞ –∑–∞–Ω—è—Ç–∏–µ (‚ÇΩ) *';
    }
    
    function updateQuickPreview() {
      const teacherId = parseInt(document.getElementById('quickTeacherId').value);
      const location = document.getElementById('quickLocation')?.value;
      const date = document.getElementById('quickSessionDate')?.value;
      const people = parseInt(document.getElementById('quickSessionPeople')?.value) || 0;
      const salaryType = document.getElementById('quickSalaryType')?.value;
      const salaryValue = parseFloat(document.getElementById('quickSalaryValue')?.value) || 0;
      const hallCost = parseFloat(document.getElementById('quickHallCost')?.value) || 0;
      
      const preview = document.getElementById('quickSessionPreview');
      
      if (!teacherId || !location || !date || !people || !salaryValue) {
        preview.style.display = 'none';
        return;
      }
      
      const teacher = teachersData.find(t => t.id === teacherId);
      if (!teacher) return;
      
      const grant = people * GRANT_PER_PERSON;
      const formattedDate = new Date(date).toLocaleDateString('ru-RU', { 
        day: 'numeric', 
        month: 'long', 
        year: 'numeric',
        weekday: 'short'
      });
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∑–∞—Ä–ø–ª–∞—Ç—É
      let sessionSalary = 0;
      if (salaryType === 'fixed') {
        sessionSalary = salaryValue;
      } else {
        sessionSalary = Math.round((grant * salaryValue) / 100);
      }
      
      const sessionProfit = grant - sessionSalary - hallCost;
      const sessionProfitability = grant > 0 ? Math.round((sessionProfit / grant) * 100) : 0;
      
      const profitColor = sessionProfitability > 50 ? '#4ade80' : sessionProfitability > 30 ? '#fbbf24' : '#f87171';
      
      document.getElementById('previewContent').innerHTML = `
        <div style="display: grid; gap: 12px;">
          <div style="display: flex; justify-content: space-between; padding: 10px; background: #334155; border-radius: 6px;">
            <div>
              <div style="color: #94a3b8; font-size: 12px;">–ü–µ–¥–∞–≥–æ–≥</div>
              <div style="color: #cbd5e1; font-weight: bold;">${teacher.name}</div>
            </div>
            <div style="text-align: right;">
              <div style="color: #94a3b8; font-size: 12px;">–î–∞—Ç–∞</div>
              <div style="color: #60a5fa; font-weight: bold; font-size: 13px;">${formattedDate}</div>
            </div>
          </div>
          
          <div style="display: flex; justify-content: space-between; padding: 10px; background: #334155; border-radius: 6px;">
            <div>
              <div style="color: #94a3b8; font-size: 12px;">–õ–æ–∫–∞—Ü–∏—è</div>
              <div style="color: #cbd5e1; font-weight: bold;">üìç ${location}</div>
            </div>
            <div style="text-align: right;">
              <div style="color: #94a3b8; font-size: 12px;">–£—á–∞—Å—Ç–Ω–∏–∫–∏</div>
              <div style="color: #c084fc; font-weight: bold; font-size: 18px;">üë• ${people} —á–µ–ª.</div>
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
            <div style="padding: 12px; background: #334155; border-radius: 6px; text-align: center;">
              <div style="color: #94a3b8; font-size: 11px; margin-bottom: 4px;">–ì—Ä–∞–Ω—Ç –æ—Ç –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞</div>
              <div style="color: #4ade80; font-size: 18px; font-weight: bold;">${formatNumber(grant)}‚ÇΩ</div>
              <div style="color: #64748b; font-size: 10px; margin-top: 2px;">${people} √ó 280‚ÇΩ</div>
            </div>
            
            <div style="padding: 12px; background: #334155; border-radius: 6px; text-align: center;">
              <div style="color: #94a3b8; font-size: 11px; margin-bottom: 4px;">–ó–∞—Ä–ø–ª–∞—Ç–∞ –ø–µ–¥–∞–≥–æ–≥–∞</div>
              <div style="color: #fbbf24; font-size: 18px; font-weight: bold;">${formatNumber(sessionSalary)}‚ÇΩ</div>
              <div style="color: #64748b; font-size: 10px; margin-top: 2px;">${salaryType === 'percent' ? salaryValue + '%' : '—Ñ–∏–∫—Å'}</div>
            </div>
            
            <div style="padding: 12px; background: #334155; border-radius: 6px; text-align: center;">
              <div style="color: #94a3b8; font-size: 11px; margin-bottom: 4px;">–ê—Ä–µ–Ω–¥–∞ –∑–∞–ª–∞</div>
              <div style="color: #f87171; font-size: 18px; font-weight: bold;">${formatNumber(hallCost)}‚ÇΩ</div>
              <div style="color: #64748b; font-size: 10px; margin-top: 2px;">${hallCost > 0 ? '–ø–ª–∞—Ç–Ω–∞—è' : '–±–µ—Å–ø–ª–∞—Ç–Ω–æ'}</div>
            </div>
            
            <div style="padding: 12px; background: #334155; border-radius: 6px; text-align: center;">
              <div style="color: #94a3b8; font-size: 11px; margin-bottom: 4px;">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</div>
              <div style="color: ${profitColor}; font-size: 18px; font-weight: bold;">${formatNumber(sessionProfit)}‚ÇΩ</div>
              <div style="color: #64748b; font-size: 10px; margin-top: 2px;">—Ä–µ–Ω—Ç–∞–±. ${sessionProfitability}%</div>
            </div>
          </div>
        </div>
      `;
      
      preview.style.display = 'block';
    }
    
    function quickAddSession(event) {
      event.preventDefault();
      
      const teacherId = parseInt(document.getElementById('quickTeacherId').value);
      const date = document.getElementById('quickSessionDate').value;
      const location = document.getElementById('quickLocation').value.trim();
      const people = parseInt(document.getElementById('quickSessionPeople').value);
      const salaryType = document.getElementById('quickSalaryType').value;
      const salaryValue = parseFloat(document.getElementById('quickSalaryValue').value);
      const hallCost = parseFloat(document.getElementById('quickHallCost').value) || 0;
      
      const teacher = teachersData.find(t => t.id === teacherId);
      if (!teacher) {
        showAlert('–ü–µ–¥–∞–≥–æ–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
        return;
      }
      
      if (!location || !salaryValue) {
        showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
        return;
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç
      const duplicate = teacher.sessions.find(s => s.date === date);
      if (duplicate) {
        if (!confirm(`–£ –ø–µ–¥–∞–≥–æ–≥–∞ ${teacher.name} —É–∂–µ –µ—Å—Ç—å –∑–∞–Ω—è—Ç–∏–µ –Ω–∞ ${new Date(date).toLocaleDateString('ru-RU')}.\n\n–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë –æ–¥–Ω–æ –∑–∞–Ω—è—Ç–∏–µ –Ω–∞ —ç—Ç—É –¥–∞—Ç—É?`)) {
          return;
        }
      }
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–Ω—è—Ç–∏–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
      teacher.sessions.push({ 
        date, 
        people,
        location,
        salaryType,
        salaryValue,
        hallCost
      });
      teacher.sessions.sort((a, b) => new Date(a.date) - new Date(b.date));
      
      saveData();
      closeQuickAddModal();
      updateDisplay();
      
      const grant = people * GRANT_PER_PERSON;
      showAlert(`‚úÖ –ó–∞–Ω—è—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ: ${teacher.name} ‚Ä¢ ${location} ‚Ä¢ ${formatNumber(grant)}‚ÇΩ`, 'success');
      
      // –î–æ–±–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      addNotification(
        'success',
        '‚úÖ –ó–∞–Ω—è—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ',
        `${teacher.name} ‚Ä¢ ${location} ‚Ä¢ ${people} —á–µ–ª. ‚Ä¢ ${formatNumber(grant)}‚ÇΩ`
      );
    }
    
    function showAddTeacherModal() {
      const newId = Math.max(...teachersData.map(t => t.id || 0)) + 1;
      showEditTeacherModal(null, {
        id: newId,
        name: "",
        location: "",
        salaryType: "percent",
        salaryValue: 50,
        hallCostPerSession: 0,
        sessions: []
      });
    }
    
    function showEditTeacherModal(teacherId, defaultData = null) {
      const teacher = defaultData || teachersData.find(t => t.id === teacherId);
      if (!teacher) return;
      
      const isNew = !teacherId;
      
      document.getElementById('editModalTitle').textContent = isNew ? '–î–æ–±–∞–≤–∏—Ç—å –ø–µ–¥–∞–≥–æ–≥–∞' : '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å: ' + teacher.name;
      
      const sessionsHTML = teacher.sessions.map((s, idx) => `
        <div class="session-edit-item" data-session-idx="${idx}">
          <input type="date" value="${s.date}" onchange="updateSessionField(${teacher.id}, ${idx}, 'date', this.value)">
          <input type="number" value="${s.people}" min="1" placeholder="–õ—é–¥–µ–π" onchange="updateSessionField(${teacher.id}, ${idx}, 'people', parseInt(this.value))">
          <span style="color: #fbbf24; font-size: 13px;">${formatNumber(s.people * GRANT_PER_PERSON)}‚ÇΩ</span>
          <button class="delete-btn" onclick="deleteSession(${teacher.id}, ${idx})">üóëÔ∏è</button>
        </div>
      `).join('');
      
      document.getElementById('editModalBody').innerHTML = `
        <form onsubmit="saveTeacher(event, ${teacher.id})">
          <div class="form-group">
            <label>–§–ò–û –ø–µ–¥–∞–≥–æ–≥–∞ *</label>
            <input type="text" id="teacherName" value="${teacher.name}" required>
          </div>
          
          <div class="form-group">
            <label>–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è *</label>
            <input type="text" id="teacherLocation" value="${teacher.location}" required>
          </div>
          
          <div class="form-group">
            <label>–¢–∏–ø –æ–ø–ª–∞—Ç—ã *</label>
            <select id="teacherSalaryType" onchange="toggleSalaryInput()">
              <option value="percent" ${teacher.salaryType === 'percent' ? 'selected' : ''}>–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –¥–æ—Ö–æ–¥–∞</option>
              <option value="fixed" ${teacher.salaryType === 'fixed' ? 'selected' : ''}>–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞</option>
            </select>
          </div>
          
          <div class="form-group">
            <label id="salaryLabel">${teacher.salaryType === 'percent' ? '–ü—Ä–æ—Ü–µ–Ω—Ç (%)' : '–°—Ç–∞–≤–∫–∞ –∑–∞ –∑–∞–Ω—è—Ç–∏–µ (‚ÇΩ)'} *</label>
            <input type="number" id="teacherSalaryValue" value="${teacher.salaryValue}" min="0" required>
          </div>
          
          <div class="form-group">
            <label>–ê—Ä–µ–Ω–¥–∞ –∑–∞–ª–∞ –∑–∞ –∑–∞–Ω—è—Ç–∏–µ (‚ÇΩ)</label>
            <input type="number" id="teacherHallCost" value="${teacher.hallCostPerSession}" min="0">
          </div>
          
          <div class="form-group">
            <label>–ó–∞–Ω—è—Ç–∏—è</label>
            <div id="sessionsList">
              ${sessionsHTML || '<p style="color: #94a3b8; font-size: 14px;">–ù–µ—Ç –∑–∞–Ω—è—Ç–∏–π</p>'}
            </div>
            <button type="button" class="add-session-btn" onclick="addNewSession(${teacher.id})">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–Ω—è—Ç–∏–µ</button>
          </div>
          
          <div class="form-actions">
            ${!isNew ? `<button type="button" class="btn" style="background: #dc2626; margin-right: auto;" onclick="deleteTeacher(${teacher.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø–µ–¥–∞–≥–æ–≥–∞</button>` : ''}
            <button type="button" class="btn secondary" onclick="closeEditModal()">–û—Ç–º–µ–Ω–∞</button>
            <button type="submit" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
        </form>
      `;
      
      document.getElementById('editModal').classList.add('active');
    }
    
    function toggleSalaryInput() {
      const type = document.getElementById('teacherSalaryType').value;
      const label = document.getElementById('salaryLabel');
      label.textContent = type === 'percent' ? '–ü—Ä–æ—Ü–µ–Ω—Ç (%) *' : '–°—Ç–∞–≤–∫–∞ –∑–∞ –∑–∞–Ω—è—Ç–∏–µ (‚ÇΩ) *';
    }
    
    function updateSessionField(teacherId, sessionIdx, field, value) {
      const teacher = teachersData.find(t => t.id === teacherId);
      if (teacher && teacher.sessions[sessionIdx]) {
        teacher.sessions[sessionIdx][field] = value;
      }
    }
    
    function deleteSession(teacherId, sessionIdx) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∑–∞–Ω—è—Ç–∏–µ?')) return;
      
      const teacher = teachersData.find(t => t.id === teacherId);
      if (teacher) {
        teacher.sessions.splice(sessionIdx, 1);
        showEditTeacherModal(teacherId);
      }
    }
    
    function addNewSession(teacherId) {
      const teacher = teachersData.find(t => t.id === teacherId);
      if (teacher) {
        const today = new Date().toISOString().split('T')[0];
        teacher.sessions.push({ date: today, people: 10 });
        showEditTeacherModal(teacherId);
      }
    }
    
    function saveTeacher(event, teacherId) {
      event.preventDefault();
      
      const name = document.getElementById('teacherName').value.trim();
      const location = document.getElementById('teacherLocation').value.trim();
      const salaryType = document.getElementById('teacherSalaryType').value;
      const salaryValue = parseFloat(document.getElementById('teacherSalaryValue').value);
      const hallCostPerSession = parseFloat(document.getElementById('teacherHallCost').value) || 0;
      
      if (!name || !location || !salaryValue) {
        showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
        return;
      }
      
      const teacherIndex = teachersData.findIndex(t => t.id === teacherId);
      const teacherData = {
        id: teacherId,
        name,
        location,
        salaryType,
        salaryValue,
        hallCostPerSession,
        sessions: teacherIndex >= 0 ? teachersData[teacherIndex].sessions : [],
        payments: teacherIndex >= 0 ? teachersData[teacherIndex].payments || [] : [],
        profile: teacherIndex >= 0 ? teachersData[teacherIndex].profile || {} : {
          photo: null,
          phone: '',
          email: '',
          startDate: new Date().toISOString().split('T')[0],
          rating: 0,
          reviews: [],
          notes: ''
        }
      };
      
      if (teacherIndex >= 0) {
        teachersData[teacherIndex] = teacherData;
      } else {
        teachersData.push(teacherData);
      }
      
      saveData();
      closeEditModal();
      updateDisplay();
    }
    
    function deleteTeacher(teacherId) {
      if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ–¥–∞–≥–æ–≥–∞ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')) return;
      
      const index = teachersData.findIndex(t => t.id === teacherId);
      if (index >= 0) {
        teachersData.splice(index, 1);
        saveData();
        closeEditModal();
        closeModal();
        updateDisplay();
      }
    }
    
    function toggleFilters() {
      const bar = document.getElementById('filterBar');
      bar.style.display = bar.style.display === 'none' ? 'flex' : 'none';
    }
    
    function applyFilters() {
      const location = document.getElementById('locationFilter').value;
      const minSessions = parseInt(document.getElementById('minSessions').value) || 0;
      
      const rows = document.querySelectorAll('#tableBody tr');
      rows.forEach(row => {
        const locationText = row.querySelector('.teacher-location').textContent;
        const sessions = parseInt(row.cells[2].textContent);
        
        const locationMatch = !location || locationText.includes(location);
        const sessionsMatch = sessions >= minSessions;
        
        row.style.display = (locationMatch && sessionsMatch) ? '' : 'none';
      });
    }
    
    function searchTable() {
      const input = document.getElementById('searchInput').value.toLowerCase();
      const rows = document.querySelectorAll('#tableBody tr');
      
      rows.forEach(row => {
        const name = row.querySelector('.teacher-name').textContent.toLowerCase();
        row.style.display = name.includes(input) ? '' : 'none';
      });
    }
    
    function sortTable(columnIndex) {
      const tbody = document.getElementById('tableBody');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      const headers = document.querySelectorAll('th');
      
      const currentHeader = headers[columnIndex];
      const isAsc = !currentHeader.classList.contains('sorted-asc');
      
      headers.forEach(h => h.classList.remove('sorted-asc', 'sorted-desc'));
      currentHeader.classList.add(isAsc ? 'sorted-asc' : 'sorted-desc');
      
      rows.sort((a, b) => {
        let aValue = a.cells[columnIndex].textContent.trim();
        let bValue = b.cells[columnIndex].textContent.trim();
        
        aValue = aValue.replace(/[‚ÇΩ,%]/g, '').replace(/\s/g, '');
        bValue = bValue.replace(/[‚ÇΩ,%]/g, '').replace(/\s/g, '');
        
        const aNum = parseFloat(aValue);
        const bNum = parseFloat(bValue);
        
        if (!isNaN(aNum) && !isNaN(bNum)) {
          return isAsc ? aNum - bNum : bNum - aNum;
        }
        return isAsc ? aValue.localeCompare(bValue) : bValue.localeCompare(aValue);
      });
      
      rows.forEach(row => tbody.appendChild(row));
    }
    
    function exportData() {
      const dataStr = JSON.stringify(teachersData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `–ø–µ–¥–∞–≥–æ–≥–∏_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
      showAlert('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
    }
    
    function importData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const imported = JSON.parse(event.target.result);
            if (!Array.isArray(imported)) {
              throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö');
            }
            
            if (confirm('–ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏?')) {
              teachersData = imported;
              saveData();
              updateDisplay();
              showAlert('–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
            }
          } catch (error) {
            showAlert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ' + error.message, 'error');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }
    
    function printReport() {
      window.print();
    }
    
    window.addEventListener('click', function(e) {
      if (e.target.id === 'detailModal') {
        closeModal();
      }
      if (e.target.id === 'editModal') {
        closeEditModal();
      }
      if (e.target.id === 'quickAddModal') {
        closeQuickAddModal();
      }
    });
    
    renderStats();
    renderCharts();
    renderTable();
    
    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    applyPeriodFilter();
  </script>
</body>
</html>
