<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TheGame ‚Äî –£—á—ë—Ç –¥–æ—Ö–æ–¥–æ–≤</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const tg = window.Telegram?.WebApp;

    function App() {
      const [activeTab, setActiveTab] = useState('monthlyReport');
      const [loading, setLoading] = useState(true);

      const [dolgo, setDolgo] = useState([]);
      const [individuals, setIndividuals] = useState([]);
      const [rentals, setRentals] = useState([]);
      const [expenses, setExpenses] = useState([]);
      const [passive, setPassive] = useState([]);
      const [students, setStudents] = useState([]);
      const [monthlyArchive, setMonthlyArchive] = useState([]);

      const [showModal, setShowModal] = useState(false);
      const [modalType, setModalType] = useState(null);
      const [editingIndex, setEditingIndex] = useState(null);
      const [form, setForm] = useState({});

      // –î–û–ë–ê–í–õ–ï–ù–û: –§–∏–ª—å—Ç—Ä—ã
      const [filters, setFilters] = useState({
        dolgo: { search: '', location: '', teacher: '', dateFrom: '', dateTo: '' },
        individuals: { search: '', type: '', teacher: '', dateFrom: '', dateTo: '' },
        students: { search: '', status: '', group: '' }
      });

      const locationDefaults = { "–ë—É–¥–µ–Ω–Ω–æ–≥–æ": 0, "–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è": 0, "–ü–∞—Ä–∫": 0 };

      const loadKey = async (key, fallback) => {
        try {
          if (tg?.CloudStorage) {
            return await new Promise((resolve) => {
              tg.CloudStorage.getItem(key, (err, val) => {
                if (!err && val) {
                  try { resolve(JSON.parse(val)); } catch { resolve(fallback); }
                } else resolve(fallback);
              });
            });
          } else {
            const raw = localStorage.getItem(key);
            return raw ? JSON.parse(raw) : fallback;
          }
        } catch {
          return fallback;
        }
      };

      const saveKey = async (key, data) => {
        try {
          const val = JSON.stringify(data);
          if (tg?.CloudStorage) tg.CloudStorage.setItem(key, val);
          localStorage.setItem(key, val);
        } catch (e) {
          console.error('saveKey error', e);
        }
      };

      useEffect(() => {
        (async () => {
          const [_dolgo, _ind, _rent, _exp, _pass, _stud, _arch] = await Promise.all([
            loadKey('dolgo', []), loadKey('individuals', []), loadKey('rentals', []),
            loadKey('expenses', []), loadKey('passive', []), loadKey('students', []),
            loadKey('monthlyArchive', [])
          ]);
          setDolgo(_dolgo); setIndividuals(_ind); setRentals(_rent);
          setExpenses(_exp); setPassive(_pass); setStudents(_stud);
          setMonthlyArchive(_arch); setLoading(false);
          try { tg?.expand && tg.expand(); } catch {}
        })();
      }, []);

      useEffect(()=> { if(!loading) saveKey('dolgo', dolgo); }, [dolgo]);
      useEffect(()=> { if(!loading) saveKey('individuals', individuals); }, [individuals]);
      useEffect(()=> { if(!loading) saveKey('rentals', rentals); }, [rentals]);
      useEffect(()=> { if(!loading) saveKey('expenses', expenses); }, [expenses]);
      useEffect(()=> { if(!loading) saveKey('passive', passive); }, [passive]);
      useEffect(()=> { if(!loading) saveKey('students', students); }, [students]);
      useEffect(()=> { if(!loading) saveKey('monthlyArchive', monthlyArchive); }, [monthlyArchive]);

      const fmt = (n) => new Intl.NumberFormat('ru-RU').format(Number(n || 0));

      // –î–û–ë–ê–í–õ–ï–ù–û: –§—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
      const applyFilters = (data, filterKey) => {
        const filter = filters[filterKey];
        if (!filter) return data;
        return data.filter(item => {
          if (filter.search) {
            const searchLower = filter.search.toLowerCase();
            const matchesSearch = Object.values(item).some(val => 
              String(val).toLowerCase().includes(searchLower)
            );
            if (!matchesSearch) return false;
          }
          if (filter.location && item.location !== filter.location) return false;
          if (filter.teacher && item.teacher !== filter.teacher) return false;
          if (filter.type && item.type !== filter.type) return false;
          if (filter.status && item.status !== filter.status) return false;
          if (filter.group && !item.group?.toLowerCase().includes(filter.group.toLowerCase())) return false;
          if (filter.dateFrom && item.date && item.date < filter.dateFrom) return false;
          if (filter.dateTo && item.date && item.date > filter.dateTo) return false;
          return true;
        });
      };

      const calcTeacherExpense = (income, rate) => {
        if (!rate) return 0;
        if (rate === '50%') return Math.round(income * 0.5);
        if (rate === '700') return 700;
        if (rate === '1000') return 1000;
        if (rate === '100%') return Math.round(income * 1.0);
        const parsed = parseFloat(rate);
        return Number.isFinite(parsed) ? parsed : 0;
      };

      // –î–û–ë–ê–í–õ–ï–ù–û: –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
      const filteredDolgo = applyFilters(dolgo, 'dolgo');
      const filteredIndividuals = applyFilters(individuals, 'individuals');
      const filteredStudents = applyFilters(students, 'students');

      const totalDolgoIncome = dolgo.reduce((s,r)=> s + (Number(r.income)||0), 0);
      const totalDolgoTeacherExpense = dolgo.reduce((s,r)=> s + calcTeacherExpense(Number(r.income)||0, r.rate), 0);
      const totalDolgoHallExpense = dolgo.reduce((s,r)=> s + (Number(r.hallExpense)||0), 0);
      const totalDolgoProfit = totalDolgoIncome - totalDolgoTeacherExpense - totalDolgoHallExpense;

      const totalIndividualIncome = individuals.reduce((s,r)=> s + (Number(r.amount)||0), 0);
      const totalRentalsIncome = rentals.reduce((s,r)=> s + (Number(r.amount)||0), 0);
      const totalPassiveIncome = passive.reduce((s,r)=> s + (Number(r.monthly)||0), 0);
      const totalExpenses = expenses.reduce((s,r)=> s + (Number(r.amount)||0), 0);

      const monthlyReport = [
        { category: '–ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –¥–æ–ª–≥–æ–ª–µ—Ç–∏–µ', income: totalDolgoIncome, expense: totalDolgoTeacherExpense + totalDolgoHallExpense, profit: totalDolgoProfit },
        { category: '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É—Ä–æ–∫–∏', income: totalIndividualIncome, expense: 0, profit: totalIndividualIncome },
        { category: '–ê—Ä–µ–Ω–¥–∞ –∑–∞–ª–∞', income: totalRentalsIncome, expense: 0, profit: totalRentalsIncome },
        { category: '–ü–∞—Å—Å–∏–≤–Ω—ã–π', income: totalPassiveIncome, expense: 0, profit: totalPassiveIncome },
        { category: '–†–∞—Å—Ö–æ–¥—ã', income: 0, expense: totalExpenses, profit: -totalExpenses },
      ];
      const totalReportIncome = monthlyReport.reduce((s,r)=> s + (r.income||0), 0);
      const totalReportExpense = monthlyReport.reduce((s,r)=> s + (r.expense||0), 0);
      const totalReportProfit = monthlyReport.reduce((s,r)=> s + (r.profit||0), 0);

      const profitMap = {};
      dolgo.forEach(r=>{
        const profit = (Number(r.income)||0) - calcTeacherExpense(Number(r.income)||0, r.rate) - (Number(r.hallExpense)||0);
        const name = r.teacher || r.location || '–ë–µ–∑ –∏–º–µ–Ω–∏';
        profitMap[name] = (profitMap[name]||0) + profit;
      });
      rentals.forEach(r=>{
        const name = r.name || '–ê—Ä–µ–Ω–¥–∞';
        profitMap[name] = (profitMap[name]||0) + (Number(r.amount)||0);
      });
      individuals.forEach(r=>{
        const teacher = r.teacher || '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∫–∏';
        profitMap[teacher] = (profitMap[teacher]||0) + (Number(r.amount)||0);
      });

      const topList = Object.entries(profitMap).map(([key,val])=> ({name:key, profit: Math.round(val)}))
        .sort((a,b)=> b.profit - a.profit).slice(0,10);
      const topTotal = topList.reduce((s,r)=> s + r.profit, 0);
      const topWithShare = topList.map(t=> ({...t, share: topTotal ? Math.round((t.profit / topTotal)*100) : 0}));

      const totalStudents = students.length;
      const activeStudents = students.filter(s=> s.status === '–ê–∫—Ç–∏–≤–Ω—ã–π').length;
      const avgIncomePerStudent = totalStudents ? Math.round((totalReportProfit + totalIndividualIncome + totalPassiveIncome - totalExpenses) / totalStudents) : 0;

      const baseStart = 385000;
      const currentTotal = baseStart + (totalReportProfit);
      const goal = 1000000;
      const progressPercent = Math.round((currentTotal / goal) * 100);
      const openModal = (type, idx = null) => {
        setModalType(type); setEditingIndex(idx);
        let data = {};
        if (idx !== null) {
          if (type === 'dolgo') data = {...dolgo[idx]};
          if (type === 'individual') data = {...individuals[idx]};
          if (type === 'rental') data = {...rentals[idx]};
          if (type === 'expense') data = {...expenses[idx]};
          if (type === 'passive') data = {...passive[idx]};
          if (type === 'student') data = {...students[idx]};
          if (type === 'archive') data = {...monthlyArchive[idx]};
        }
        setForm(data); setShowModal(true);
      };

      const closeModal = () => { setShowModal(false); setForm({}); setEditingIndex(null); setModalType(null); };

      const saveModal = () => {
        if (modalType === 'dolgo') {
          const people = Number(form.people || 0);
          const income = people * 280;
          const row = {
            date: form.date || '', location: form.location || '', teacher: form.teacher || '',
            rate: form.rate || '50%', people, income,
            hallExpense: Number(form.hallExpense || locationDefaults[form.location] || 0),
            comment: form.comment || ''
          };
          if (editingIndex !== null) { const copy = [...dolgo]; copy[editingIndex] = row; setDolgo(copy); }
          else setDolgo([...dolgo, row]);
        }
        if (modalType === 'individual') {
          const row = {
            date: form.date || '', type: form.type || '–û—Å—Ç–∞–ª—å–Ω—ã–µ', client: form.client || '',
            teacher: form.teacher || '', amount: Number(form.amount || 0), comment: form.comment || ''
          };
          if (editingIndex !== null) { const copy = [...individuals]; copy[editingIndex] = row; setIndividuals(copy); }
          else setIndividuals([...individuals, row]);
        }
        if (modalType === 'rental') {
          const row = { date: form.date || '', name: form.name || '', amount: Number(form.amount || 0), comment: form.comment || '' };
          if (editingIndex !== null) { const copy=[...rentals]; copy[editingIndex]=row; setRentals(copy); }
          else setRentals([...rentals, row]);
        }
        if (modalType === 'expense') {
          const row = { date: form.date || '', type: form.type || '', what: form.what || '', amount: Number(form.amount || 0), comment: form.comment || '' };
          if (editingIndex !== null) { const copy=[...expenses]; copy[editingIndex]=row; setExpenses(copy); }
          else setExpenses([...expenses, row]);
        }
        if (modalType === 'passive') {
          const row = { date: form.date || '', source: form.source || '', monthly: Number(form.monthly || 0), comment: form.comment || '' };
          if (editingIndex !== null) { const copy=[...passive]; copy[editingIndex]=row; setPassive(copy); }
          else setPassive([...passive, row]);
        }
        if (modalType === 'student') {
          const row = {
            name: form.name || '', phone: form.phone || '', group: form.group || '',
            subscription: form.subscription || '', expiry: form.expiry || '',
            status: form.status || '–ê–∫—Ç–∏–≤–Ω—ã–π', note: form.note || ''
          };
          if (editingIndex !== null) { const copy=[...students]; copy[editingIndex]=row; setStudents(copy); }
          else setStudents([...students, row]);
        }
        if (modalType === 'archive') {
          const groupIncome = Number(form.groupIncome||0);
          const individualIncome = Number(form.individualIncome||0);
          const passiveIncome = Number(form.passiveIncome||0);
          const expensesVal = Number(form.expenses||0);
          const profit = groupIncome + individualIncome + passiveIncome - expensesVal;
          const row = {
            month: form.month || '', year: form.year || '',
            groupIncome, individualIncome, passiveIncome, expenses: expensesVal, profit, note: form.note || ''
          };
          if (editingIndex !== null) { const copy=[...monthlyArchive]; copy[editingIndex]=row; setMonthlyArchive(copy); }
          else setMonthlyArchive([...monthlyArchive, row]);
        }
        closeModal();
      };

      const deleteItem = (type, idx) => {
        if (!confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) return;
        if (type === 'dolgo') setDolgo(dolgo.filter((_,i)=>i!==idx));
        if (type === 'individual') setIndividuals(individuals.filter((_,i)=>i!==idx));
        if (type === 'rental') setRentals(rentals.filter((_,i)=>i!==idx));
        if (type === 'expense') setExpenses(expenses.filter((_,i)=>i!==idx));
        if (type === 'passive') setPassive(passive.filter((_,i)=>i!==idx));
        if (type === 'student') setStudents(students.filter((_,i)=>i!==idx));
        if (type === 'archive') setMonthlyArchive(monthlyArchive.filter((_,i)=>i!==idx));
      };

      const exportCSV = () => {
        let csv = '–ö–∞—Ç–µ–≥–æ—Ä–∏—è,–î–æ—Ö–æ–¥,–†–∞—Å—Ö–æ–¥,–ü—Ä–∏–±—ã–ª—å\n';
        monthlyReport.forEach(row=>{ csv += `${row.category},${row.income},${row.expense},${row.profit}\n`; });
        csv += `\n–ò–¢–û–ì–û,${totalReportIncome},${totalReportExpense},${totalReportProfit}\n`;
        const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'thegame_monthly_report.csv'; a.click();
        URL.revokeObjectURL(url);
      };

      if (loading) return <div className="min-h-screen flex items-center justify-center"><div>–ó–∞–≥—Ä—É–∑–∫–∞...</div></div>;

      return (
        <div className="min-h-screen p-4">
          <div className="max-w-6xl mx-auto">
            <header className="mb-6">
              <div className="flex items-center justify-between">
                <div>
                  <h1 className="text-2xl font-bold">üí∞ TheGame ‚Äî –£—á—ë—Ç –¥–æ—Ö–æ–¥–æ–≤</h1>
                  <div className="text-sm text-slate-400">–ü—É—Ç—å –∫ 1–ú</div>
                </div>
                <div className="text-right">
                  <div className="text-sm text-slate-400">–ü—Ä–æ–≥—Ä–µ—Å—Å –∫ —Ü–µ–ª–∏</div>
                  <div className="flex items-center gap-3">
                    <div className="w-56 bg-slate-700 h-4 rounded">
                      <div className="h-4 rounded bg-gradient-to-r from-blue-500 to-green-400" style={{width: `${Math.min(progressPercent,100)}%`}}></div>
                    </div>
                    <div className="text-sm font-bold">{progressPercent}%</div>
                  </div>
                  <div className="text-xs text-slate-400">{fmt(currentTotal)}‚ÇΩ ‚Üí {fmt(goal)}‚ÇΩ</div>
                </div>
              </div>

              <nav className="mt-4 flex flex-wrap gap-2">
                {[
                  {id:'monthlyReport', title:'–ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç'}, {id:'dolgo', title:'–ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –¥–æ–ª–≥–æ–ª–µ—Ç–∏–µ'},
                  {id:'individuals', title:'–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É—Ä–æ–∫–∏'}, {id:'rentals', title:'–ê—Ä–µ–Ω–¥–∞ –∑–∞–ª–∞'},
                  {id:'expenses', title:'–†–∞—Å—Ö–æ–¥—ã'}, {id:'passive', title:'–ü–∞—Å—Å–∏–≤–Ω—ã–π'},
                  {id:'students', title:'–ë–∞–∑–∞ —É—á–µ–Ω–∏–∫–æ–≤'}, {id:'analytics', title:'–ê–Ω–∞–ª–∏—Ç–∏–∫–∞'},
                  {id:'archive', title:'–ü–æ –º–µ—Å—è—Ü–∞–º'}, {id:'summary', title:'–°–≤–æ–¥–∫–∞'},
                  {id:'teachersSalary', title:'–ó–∞—Ä–ø–ª–∞—Ç—ã –ø–µ–¥–∞–≥–æ–≥–æ–≤'},
                ].map(t=>(
                  <button key={t.id} onClick={()=>setActiveTab(t.id)}
                    className={`px-3 py-1 rounded ${activeTab===t.id ? 'bg-blue-600' : 'bg-slate-800 text-slate-300 hover:bg-slate-700'}`}
                  >{t.title}</button>
                ))}
              </nav>
            </header>

            <main className="bg-slate-800 rounded p-4 border border-slate-700">
              {activeTab === 'monthlyReport' && (
                <section>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-lg font-bold">üìÖ –ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç</h2>
                    <div className="flex gap-2">
                      <button onClick={()=> setActiveTab('summary')} className="px-3 py-2 bg-slate-700 rounded">–ü–µ—Ä–µ–π—Ç–∏ –≤ —Å–≤–æ–¥–∫—É</button>
                      <button onClick={exportCSV} className="px-3 py-2 bg-green-600 rounded">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
                    </div>
                  </div>
                  <div className="overflow-x-auto">
                    <table className="w-full text-sm">
                      <thead><tr className="text-left text-slate-300 border-b border-slate-700">
                        <th className="py-2 px-2">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th className="py-2 px-2 text-right">–î–æ—Ö–æ–¥</th>
                        <th className="py-2 px-2 text-right">–†–∞—Å—Ö–æ–¥</th>
                        <th className="py-2 px-2 text-right">–ü—Ä–∏–±—ã–ª—å</th>
                      </tr></thead>
                      <tbody>
                        {monthlyReport.map((r,i)=>(
                          <tr key={i} className="border-b border-slate-700/40">
                            <td className="py-2 px-2">{r.category}</td>
                            <td className="py-2 px-2 text-right text-green-400">{fmt(r.income)}‚ÇΩ</td>
                            <td className="py-2 px-2 text-right text-red-400">-{fmt(r.expense)}‚ÇΩ</td>
                            <td className="py-2 px-2 text-right text-blue-400 font-semibold">{fmt(r.profit)}‚ÇΩ</td>
                          </tr>
                        ))}
                      </tbody>
                      <tfoot className="bg-slate-900/50"><tr className="font-bold">
                        <td className="py-2 px-2">–ò–¢–û–ì–û:</td>
                        <td className="py-2 px-2 text-right text-green-400">{fmt(totalReportIncome)}‚ÇΩ</td>
                        <td className="py-2 px-2 text-right text-red-400">-{fmt(totalReportExpense)}‚ÇΩ</td>
                        <td className="py-2 px-2 text-right text-blue-400">{fmt(totalReportProfit)}‚ÇΩ</td>
                      </tr></tfoot>
                    </table>
                  </div>
                </section>
              )}

              {activeTab === 'dolgo' && (
                <section>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-lg font-bold">üèÉ –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –¥–æ–ª–≥–æ–ª–µ—Ç–∏–µ</h2>
                    <button className="px-3 py-2 bg-blue-600 rounded" onClick={()=>openModal('dolgo')}>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                  </div>

                  {/* –î–û–ë–ê–í–õ–ï–ù–û: –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ */}
                  <div className="mb-4 p-3 bg-slate-900 rounded border border-slate-700">
                    <div className="grid grid-cols-1 md:grid-cols-5 gap-2">
                      <input type="text" placeholder="üîç –ü–æ–∏—Å–∫..." className="px-3 py-2 bg-slate-800 rounded text-sm"
                        value={filters.dolgo.search} onChange={(e) => setFilters({...filters, dolgo: {...filters.dolgo, search: e.target.value}})} />
                      <select className="px-3 py-2 bg-slate-800 rounded text-sm" value={filters.dolgo.location}
                        onChange={(e) => setFilters({...filters, dolgo: {...filters.dolgo, location: e.target.value}})}>
                        <option value="">–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏</option>
                        <option value="–ë—É–¥–µ–Ω–Ω–æ–≥–æ">–ë—É–¥–µ–Ω–Ω–æ–≥–æ</option>
                        <option value="–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è">–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è</option>
                        <option value="–ü–∞—Ä–∫">–ü–∞—Ä–∫</option>
                      </select>
                      <input type="text" placeholder="–ü–µ–¥–∞–≥–æ–≥" className="px-3 py-2 bg-slate-800 rounded text-sm"
                        value={filters.dolgo.teacher} onChange={(e) => setFilters({...filters, dolgo: {...filters.dolgo, teacher: e.target.value}})} />
                      <input type="date" className="px-3 py-2 bg-slate-800 rounded text-sm"
                        value={filters.dolgo.dateFrom} onChange={(e) => setFilters({...filters, dolgo: {...filters.dolgo, dateFrom: e.target.value}})} />
                      <input type="date" className="px-3 py-2 bg-slate-800 rounded text-sm"
                        value={filters.dolgo.dateTo} onChange={(e) => setFilters({...filters, dolgo: {...filters.dolgo, dateTo: e.target.value}})} />
                    </div>
                    {(filters.dolgo.search || filters.dolgo.location || filters.dolgo.teacher || filters.dolgo.dateFrom || filters.dolgo.dateTo) && (
                      <button className="mt-2 text-xs text-blue-400 hover:text-blue-300"
                        onClick={() => setFilters({...filters, dolgo: { search: '', location: '', teacher: '', dateFrom: '', dateTo: '' }})}>
                        ‚úñ –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                      </button>
                    )}
                  </div>

                  <div className="overflow-x-auto mb-4">
                    <table className="w-full text-sm">
                      <thead><tr className="border-b border-slate-700 text-slate-300">
                        <th className="py-2 px-2">–î–∞—Ç–∞</th><th className="py-2 px-2">–õ–æ–∫–∞—Ü–∏—è</th>
                        <th className="py-2 px-2">–ü–µ–¥–∞–≥–æ–≥</th><th className="py-2 px-2 text-right">–°—Ç–∞–≤–∫–∞</th>
                        <th className="py-2 px-2 text-right">–õ—é–¥–µ–π</th><th className="py-2 px-2 text-right">–î–æ—Ö–æ–¥</th>
                        <th className="py-2 px-2 text-right">–†–∞—Å—Ö–æ–¥ –ø–µ–¥.</th><th className="py-2 px-2 text-right">–†–∞—Å—Ö–æ–¥ –∑–∞ –∑–∞–ª</th>
                        <th className="py-2 px-2 text-right">–ü—Ä–∏–±—ã–ª—å</th><th className="py-2 px-2 text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
                      </tr></thead>
                      <tbody>
                        {filteredDolgo.length === 0 ? (
                          <tr><td colSpan="10" className="py-4 text-center text-slate-400">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>
                        ) : (
                          filteredDolgo.map((r,idx)=>{
                            const originalIdx = dolgo.indexOf(r);
                            const teacherExpense = calcTeacherExpense(Number(r.income||0), r.rate);
                            const profit = Number(r.income||0) - teacherExpense - Number(r.hallExpense||0);
                            return (
                            <tr key={originalIdx} className="border-b border-slate-700/40">
                              <td className="py-2 px-2">{r.date}</td>
                              <td className="py-2 px-2">{r.location}</td>
                              <td className="py-2 px-2">{r.teacher}</td>
                              <td className="py-2 px-2 text-right">{r.rate}</td>
                              <td className="py-2 px-2 text-right">{r.people}</td>
                              <td className="py-2 px-2 text-right text-green-400">{fmt(r.income)}‚ÇΩ</td>
                              <td className="py-2 px-2 text-right text-red-400">{fmt(teacherExpense)}‚ÇΩ</td>
                              <td className="py-2 px-2 text-right">{fmt(r.hallExpense)}‚ÇΩ</td>
                              <td className="py-2 px-2 text-right text-blue-400 font-bold">{fmt(profit)}‚ÇΩ</td>
                              <td className="py-2 px-2 text-center">
                                <button onClick={()=>openModal('dolgo', originalIdx)} className="text-blue-400 mr-2">‚úé</button>
                                <button onClick={()=>deleteItem('dolgo', originalIdx)} className="text-red-400">üóë</button>
                              </td>
                            </tr>
                            );
                          })
                        )}
                      </tbody>
                      <tfoot className="bg-slate-900/50 font-bold"><tr>
                        <td colSpan="5" className="py-2 px-2">–ò–¢–û–ì–û ({filteredDolgo.length}):</td>
                        <td className="py-2 px-2 text-right text-green-400">{fmt(filteredDolgo.reduce((s,r)=>s+(Number(r.income)||0),0))}‚ÇΩ</td>
                        <td className="py-2 px-2 text-right text-red-400">{fmt(filteredDolgo.reduce((s,r)=>s+calcTeacherExpense(Number(r.income)||0,r.rate),0))}‚ÇΩ</td>
                        <td className="py-2 px-2 text-right">{fmt(filteredDolgo.reduce((s,r)=>s+(Number(r.hallExpense)||0),0))}‚ÇΩ</td>
                        <td className="py-2 px-2 text-right text-blue-400">{fmt(filteredDolgo.reduce((s,r)=>{
                          const te = calcTeacherExpense(Number(r.income)||0,r.rate);
                          return s + (Number(r.income)||0) - te - (Number(r.hallExpense)||0);
                        },0))}‚ÇΩ</td>
                        <td></td>
                      </tr></tfoot>
                    </table>
                  </div>
                  <div className="text-sm text-slate-400">
                    <div>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –î–æ—Ö–æ–¥ = –õ—é–¥–µ–π √ó 280‚ÇΩ. –°—Ç–∞–≤–∫–∏ –ø–µ–¥–∞–≥–æ–≥–∞: 50% / 700 / 1000 / 100%.</div>
                  </div>
                </section>
              )}
              {activeTab === 'individuals' && (
                <section>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-lg font-bold">üë§ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É—Ä–æ–∫–∏</h2>
                    <button className="px-3 py-2 bg-blue-600 rounded" onClick={()=>openModal('individual')}>–î–æ–±–∞–≤–∏—Ç—å</button>
                  </div>

                  {/* –î–û–ë–ê–í–õ–ï–ù–û: –§–∏–ª—å—Ç—Ä—ã */}
                  <div className="mb-4 p-3 bg-slate-900 rounded border border-slate-700">
                    <div className="grid grid-cols-1 md:grid-cols-5 gap-2">
                      <input type="text" placeholder="üîç –ü–æ–∏—Å–∫..." className="px-3 py-2 bg-slate-800 rounded text-sm"
                        value={filters.individuals.search} onChange={(e) => setFilters({...filters, individuals: {...filters.individuals, search: e.target.value}})} />
                      <select className="px-3 py-2 bg-slate-800 rounded text-sm" value={filters.individuals.type}
                        onChange={(e) => setFilters({...filters, individuals: {...filters.individuals, type: e.target.value}})}>
                        <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                        <option value="–ê–∑–±—É–∫–∞ —Ç–∞–Ω—Ü–∞">–ê–∑–±—É–∫–∞ —Ç–∞–Ω—Ü–∞</option>
                        <option value="–õ–∞—Ç–∏–Ω—Å–∫–∏–π –∫–≤–∞—Ä—Ç–µ—Ç">–õ–∞—Ç–∏–Ω—Å–∫–∏–π –∫–≤–∞—Ä—Ç–µ—Ç</option>
                        <option value="–ü—Ä–æ–∞–º">–ü—Ä–æ–∞–º</option>
                        <option value="–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞">–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞</option>
                        <option value="–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</option>
                        <option value="–û—Å—Ç–∞–ª—å–Ω—ã–µ">–û—Å—Ç–∞–ª—å–Ω—ã–µ</option>
                      </select>
                      <input type="text" placeholder="–ü–µ–¥–∞–≥–æ–≥" className="px-3 py-2 bg-slate-800 rounded text-sm"
                        value={filters.individuals.teacher} onChange={(e) => setFilters({...filters, individuals: {...filters.individuals, teacher: e.target.value}})} />
                      <input type="date" className="px-3 py-2 bg-slate-800 rounded text-sm"
                        value={filters.individuals.dateFrom} onChange={(e) => setFilters({...filters, individuals: {...filters.individuals, dateFrom: e.target.value}})} />
                      <input type="date" className="px-3 py-2 bg-slate-800 rounded text-sm"
                        value={filters.individuals.dateTo} onChange={(e) => setFilters({...filters, individuals: {...filters.individuals, dateTo: e.target.value}})} />
                    </div>
                    {(filters.individuals.search || filters.individuals.type || filters.individuals.teacher || filters.individuals.dateFrom || filters.individuals.dateTo) && (
                      <button className="mt-2 text-xs text-blue-400 hover:text-blue-300"
                        onClick={() => setFilters({...filters, individuals: { search: '', type: '', teacher: '', dateFrom: '', dateTo: '' }})}>
                        ‚úñ –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                      </button>
                    )}
                  </div>

                  <div className="overflow-x-auto">
                    <table className="w-full text-sm">
                      <thead className="text-slate-300">
                        <tr className="border-b border-slate-700">
                          <th className="py-2 px-2">–î–∞—Ç–∞</th>
                          <th className="py-2 px-2">–¢–∏–ø</th>
                          <th className="py-2 px-2">–ö–ª–∏–µ–Ω—Ç</th>
                          <th className="py-2 px-2">–ü–µ–¥–∞–≥–æ–≥</th>
                          <th className="py-2 px-2 text-right">–°—É–º–º–∞</th>
                          <th className="py-2 px-2 text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                      </thead>
                      <tbody>
                        {filteredIndividuals.length === 0 ? (
                          <tr><td colSpan="6" className="py-4 text-center text-slate-400">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>
                        ) : (
                          filteredIndividuals.map((r,idx)=>{
                            const originalIdx = individuals.indexOf(r);
                            return (
                            <tr key={originalIdx} className="border-b border-slate-700/40">
                              <td className="py-2 px-2">{r.date}</td>
                              <td className="py-2 px-2">{r.type}</td>
                              <td className="py-2 px-2">{r.client}</td>
                              <td className="py-2 px-2">{r.teacher || '‚Äî'}</td>
                              <td className="py-2 px-2 text-right text-green-400">{fmt(r.amount)}‚ÇΩ</td>
                              <td className="py-2 px-2 text-center">
                                <button onClick={()=>openModal('individual', originalIdx)} className="text-blue-400 mr-2">‚úé</button>
                                <button onClick={()=>deleteItem('individual', originalIdx)} className="text-red-400">üóë</button>
                              </td>
                            </tr>
                            );
                          })
                        )}
                      </tbody>
                      <tfoot className="bg-slate-900/50 font-bold">
                        <tr>
                          <td colSpan="4" className="py-2 px-2">–ò–¢–û–ì–û ({filteredIndividuals.length}):</td>
                          <td className="py-2 px-2 text-right text-green-400">{fmt(filteredIndividuals.reduce((s,r)=>s+(Number(r.amount)||0),0))}‚ÇΩ</td>
                          <td></td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </section>
              )}

              {activeTab === 'rentals' && (
                <section>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-lg font-bold">üè† –ê—Ä–µ–Ω–¥–∞ –∑–∞–ª–∞</h2>
                    <button className="px-3 py-2 bg-blue-600 rounded" onClick={()=>openModal('rental')}>–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–µ–Ω–¥—É</button>
                  </div>
                  <div className="overflow-x-auto">
                    <table className="w-full text-sm">
                      <thead className="text-slate-300">
                        <tr className="border-b border-slate-700">
                          <th className="py-2 px-2">–î–∞—Ç–∞</th>
                          <th className="py-2 px-2">–ò–º—è</th>
                          <th className="py-2 px-2 text-right">–°—É–º–º–∞</th>
                          <th className="py-2 px-2">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                          <th className="py-2 px-2 text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                      </thead>
                      <tbody>
                        {rentals.map((r,idx)=>(
                          <tr key={idx} className="border-b border-slate-700/40">
                            <td className="py-2 px-2">{r.date}</td>
                            <td className="py-2 px-2">{r.name}</td>
                            <td className="py-2 px-2 text-right text-green-400">{fmt(r.amount)}‚ÇΩ</td>
                            <td className="py-2 px-2 text-slate-400">{r.comment}</td>
                            <td className="py-2 px-2 text-center">
                              <button onClick={()=>openModal('rental', idx)} className="text-blue-400 mr-2">‚úé</button>
                              <button onClick={()=>deleteItem('rental', idx)} className="text-red-400">üóë</button>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                      <tfoot className="bg-slate-900/50 font-bold">
                        <tr>
                          <td colSpan="2" className="py-2 px-2">–ò–¢–û–ì–û:</td>
                          <td className="py-2 px-2 text-right text-green-400">{fmt(totalRentalsIncome)}‚ÇΩ</td>
                          <td colSpan="2"></td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </section>
              )}

              {activeTab === 'expenses' && (
                <section>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-lg font-bold">üí∏ –†–∞—Å—Ö–æ–¥—ã</h2>
                    <button className="px-3 py-2 bg-blue-600 rounded" onClick={()=>openModal('expense')}>–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</button>
                  </div>
                  <div className="overflow-x-auto">
                    <table className="w-full text-sm">
                      <thead className="text-slate-300">
                        <tr className="border-b border-slate-700">
                          <th className="py-2 px-2">–î–∞—Ç–∞</th>
                          <th className="py-2 px-2">–¢–∏–ø</th>
                          <th className="py-2 px-2">–ß—Ç–æ</th>
                          <th className="py-2 px-2 text-right">–°—É–º–º–∞</th>
                          <th className="py-2 px-2">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                          <th className="py-2 px-2 text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                      </thead>
                      <tbody>
                        {expenses.map((r,idx)=>(
                          <tr key={idx} className="border-b border-slate-700/40">
                            <td className="py-2 px-2">{r.date}</td>
                            <td className="py-2 px-2">{r.type}</td>
                            <td className="py-2 px-2">{r.what}</td>
                            <td className="py-2 px-2 text-right text-red-400">-{fmt(r.amount)}‚ÇΩ</td>
                            <td className="py-2 px-2 text-slate-400">{r.comment}</td>
                            <td className="py-2 px-2 text-center">
                              <button onClick={()=>openModal('expense', idx)} className="text-blue-400 mr-2">‚úé</button>
                              <button onClick={()=>deleteItem('expense', idx)} className="text-red-400">üóë</button>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                      <tfoot className="bg-slate-900/50 font-bold">
                        <tr>
                          <td colSpan="3" className="py-2 px-2">–ò–¢–û–ì–û:</td>
                          <td className="py-2 px-2 text-right text-red-400">-{fmt(totalExpenses)}‚ÇΩ</td>
                          <td colSpan="2"></td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </section>
              )}

              {activeTab === 'passive' && (
                <section>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-lg font-bold">üí∞ –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥</h2>
                    <button className="px-3 py-2 bg-blue-600 rounded" onClick={()=>openModal('passive')}>–î–æ–±–∞–≤–∏—Ç—å</button>
                  </div>
                  <div className="overflow-x-auto">
                    <table className="w-full text-sm">
                      <thead className="text-slate-300">
                        <tr className="border-b border-slate-700">
                          <th className="py-2 px-2">–î–∞—Ç–∞</th>
                          <th className="py-2 px-2">–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                          <th className="py-2 px-2 text-right">–°—É–º–º–∞/–º–µ—Å</th>
                          <th className="py-2 px-2">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                          <th className="py-2 px-2 text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                      </thead>
                      <tbody>
                        {passive.map((r,idx)=>(
                          <tr key={idx} className="border-b border-slate-700/40">
                            <td className="py-2 px-2">{r.date}</td>
                            <td className="py-2 px-2">{r.source}</td>
                            <td className="py-2 px-2 text-right text-green-400">{fmt(r.monthly)}‚ÇΩ</td>
                            <td className="py-2 px-2 text-slate-400">{r.comment}</td>
                            <td className="py-2 px-2 text-center">
                              <button onClick={()=>openModal('passive', idx)} className="text-blue-400 mr-2">‚úé</button>
                              <button onClick={()=>deleteItem('passive', idx)} className="text-red-400">üóë</button>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                      <tfoot className="bg-slate-900/50 font-bold">
                        <tr>
                          <td colSpan="2" className="py-2 px-2">–ò–¢–û–ì–û:</td>
                          <td className="py-2 px-2 text-right text-green-400">{fmt(totalPassiveIncome)}‚ÇΩ</td>
                          <td colSpan="2"></td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </section>
              )}

              {activeTab === 'students' && (
                <section>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-lg font-bold">üë• –ë–∞–∑–∞ —É—á–µ–Ω–∏–∫–æ–≤</h2>
                    <button className="px-3 py-2 bg-blue-600 rounded" onClick={()=>openModal('student')}>–î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</button>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div className="bg-slate-900 p-3 rounded">
                      <div className="text-slate-400 text-sm">–í—Å–µ–≥–æ —É—á–µ–Ω–∏–∫–æ–≤</div>
                      <div className="text-2xl font-bold text-blue-400">{totalStudents}</div>
                    </div>
                    <div className="bg-slate-900 p-3 rounded">
                      <div className="text-slate-400 text-sm">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                      <div className="text-2xl font-bold text-green-400">{activeStudents}</div>
                    </div>
                    <div className="bg-slate-900 p-3 rounded">
                      <div className="text-slate-400 text-sm">–°—Ä–µ–¥–Ω–∏–π –¥–æ—Ö–æ–¥</div>
                      <div className="text-2xl font-bold text-yellow-400">{fmt(avgIncomePerStudent)}‚ÇΩ</div>
                    </div>
                  </div>

                  {/* –î–û–ë–ê–í–õ–ï–ù–û: –§–∏–ª—å—Ç—Ä—ã */}
                  <div className="mb-4 p-3 bg-slate-900 rounded border border-slate-700">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-2">
                      <input type="text" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É..." className="px-3 py-2 bg-slate-800 rounded text-sm"
                        value={filters.students.search} onChange={(e) => setFilters({...filters, students: {...filters.students, search: e.target.value}})} />
                      <select className="px-3 py-2 bg-slate-800 rounded text-sm" value={filters.students.status}
                        onChange={(e) => setFilters({...filters, students: {...filters.students, status: e.target.value}})}>
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="–ê–∫—Ç–∏–≤–Ω—ã–π">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                        <option value="–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π</option>
                        <option value="–ü—Ä–æ–±–Ω—ã–π">–ü—Ä–æ–±–Ω—ã–π</option>
                      </select>
                      <input type="text" placeholder="–ì—Ä—É–ø–ø–∞" className="px-3 py-2 bg-slate-800 rounded text-sm"
                        value={filters.students.group} onChange={(e) => setFilters({...filters, students: {...filters.students, group: e.target.value}})} />
                    </div>
                    {(filters.students.search || filters.students.status || filters.students.group) && (
                      <button className="mt-2 text-xs text-blue-400 hover:text-blue-300"
                        onClick={() => setFilters({...filters, students: { search: '', status: '', group: '' }})}>
                        ‚úñ –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                      </button>
                    )}
                  </div>

                  <div className="overflow-x-auto">
                    <table className="w-full text-sm">
                      <thead className="text-slate-300">
                        <tr className="border-b border-slate-700">
                          <th className="py-2 px-2">–ò–º—è</th>
                          <th className="py-2 px-2">–¢–µ–ª–µ—Ñ–æ–Ω</th>
                          <th className="py-2 px-2">–ì—Ä—É–ø–ø–∞</th>
                          <th className="py-2 px-2">–ê–±–æ–Ω–µ–º–µ–Ω—Ç</th>
                          <th className="py-2 px-2">–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ</th>
                          <th className="py-2 px-2">–°—Ç–∞—Ç—É—Å</th>
                          <th className="py-2 px-2 text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                      </thead>
                      <tbody>
                        {filteredStudents.length === 0 ? (
                          <tr><td colSpan="7" className="py-4 text-center text-slate-400">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>
                        ) : (
                          filteredStudents.map((s,idx)=>{
                            const originalIdx = students.indexOf(s);
                            return (
                            <tr key={originalIdx} className="border-b border-slate-700/40">
                              <td className="py-2 px-2">{s.name}</td>
                              <td className="py-2 px-2">{s.phone}</td>
                              <td className="py-2 px-2">{s.group}</td>
                              <td className="py-2 px-2">{s.subscription}</td>
                              <td className="py-2 px-2">{s.expiry}</td>
                              <td className="py-2 px-2">{s.status}</td>
                              <td className="py-2 px-2 text-center">
                                <button onClick={()=>openModal('student', originalIdx)} className="text-blue-400 mr-2">‚úé</button>
                                <button onClick={()=>deleteItem('student', originalIdx)} className="text-red-400">üóë</button>
                              </td>
                            </tr>
                            );
                          })
                        )}
                      </tbody>
                    </table>
                  </div>
                  <div className="mt-2 text-sm text-slate-400">–ù–∞–π–¥–µ–Ω–æ —É—á–µ–Ω–∏–∫–æ–≤: {filteredStudents.length}</div>
                </section>
              )}

              {activeTab === 'analytics' && (
                <section>
                  <h2 className="text-lg font-bold mb-4">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="bg-slate-900 p-4 rounded">
                      <h3 className="text-sm text-green-400 font-bold mb-2">–§–∏–Ω–∞–Ω—Å—ã</h3>
                      <div className="space-y-2">
                        <div className="flex justify-between"><span>–¢–µ–∫—É—â–∏–π –¥–æ—Ö–æ–¥ (–º–µ—Å—è—Ü):</span><b>{fmt(totalReportIncome)}‚ÇΩ</b></div>
                        <div className="flex justify-between"><span>–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å:</span><b className="text-blue-400">{fmt(totalReportProfit)}‚ÇΩ</b></div>
                        <div className="flex justify-between"><span>–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å:</span><b>{ totalReportIncome ? Math.round((totalReportProfit/totalReportIncome)*100) : 0 }%</b></div>
                      </div>
                    </div>
                    <div className="bg-slate-900 p-4 rounded">
                      <h3 className="text-sm text-blue-400 font-bold mb-2">–£—á–µ–Ω–∏–∫–∏</h3>
                      <div className="space-y-2">
                        <div className="flex justify-between"><span>–í—Å–µ–≥–æ —É—á–µ–Ω–∏–∫–æ–≤:</span><b>{totalStudents}</b></div>
                        <div className="flex justify-between"><span>–ê–∫—Ç–∏–≤–Ω—ã—Ö:</span><b className="text-green-400">{activeStudents}</b></div>
                        <div className="flex justify-between"><span>–°—Ä–µ–¥–Ω–∏–π –¥–æ—Ö–æ–¥ —Å —É—á–µ–Ω–∏–∫–∞:</span><b className="text-yellow-400">{fmt(avgIncomePerStudent)}‚ÇΩ</b></div>
                      </div>
                    </div>
                    <div className="bg-slate-900 p-4 rounded">
                      <h3 className="text-sm text-purple-400 font-bold mb-2">–¶–µ–ª–∏</h3>
                      <div className="space-y-2">
                        <div className="flex justify-between"><span>–¢–µ–∫—É—â–∏–π:</span><b>{fmt(currentTotal)}‚ÇΩ</b></div>
                        <div className="flex justify-between"><span>–¶–µ–ª—å:</span><b>{fmt(goal)}‚ÇΩ</b></div>
                        <div className="flex justify-between"><span>–û—Å—Ç–∞–ª–æ—Å—å:</span><b className="text-red-400">{fmt(Math.max(goal - currentTotal,0))}‚ÇΩ</b></div>
                        <div className="flex justify-between"><span>–ü—Ä–æ–≥—Ä–µ—Å—Å:</span><b className="text-blue-400">{progressPercent}%</b></div>
                      </div>
                    </div>
                    <div className="bg-slate-900 p-4 rounded">
                      <h3 className="text-sm text-orange-400 font-bold mb-2">–†–æ—Å—Ç</h3>
                      <div className="text-xs text-slate-400">
                        ‚Ä¢ –ù—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ—Ö–æ–¥ –Ω–∞ ~{fmt(Math.round((goal - currentTotal)/12))}‚ÇΩ/–º–µ—Å<br/>
                        ‚Ä¢ –ò–ª–∏ –ø—Ä–∏–≤–ª–µ—á—å ~{Math.round((goal - currentTotal) / (avgIncomePerStudent || 3000))} —É—á–µ–Ω–∏–∫–æ–≤ (–ø—Ä–∏–º–µ—Ä–Ω–æ)
                      </div>
                    </div>
                  </div>
                  <div className="mt-6">
                    <h3 className="text-md font-bold mb-2">üÜï –¢–û–ü –ø–µ–¥–∞–≥–æ–≥–æ–≤/–∫–ª—É–±–æ–≤ (–ø–æ –ø—Ä–∏–±—ã–ª–∏)</h3>
                    {topWithShare.length === 0 ? <div className="text-slate-400">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div> : (
                      <div className="bg-slate-900 p-3 rounded">
                        {topWithShare.map((t, i)=>(
                          <div key={i} className="flex items-center gap-3 mb-2">
                            <div className="w-8 text-slate-300">{i+1}.</div>
                            <div className="flex-1">
                              <div className="font-semibold">{t.name}</div>
                              <div className="text-xs text-slate-400">{fmt(t.profit)}‚ÇΩ ‚Äî {t.share}%</div>
                              <div className="w-full bg-slate-700 h-2 rounded mt-1">
                                <div style={{width:`${t.share}%`}} className="h-2 bg-gradient-to-r from-blue-500 to-green-400 rounded"></div>
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                    <div className="mt-4 text-sm text-slate-400">–í—ã–≤–æ–¥: —Ñ–æ–∫—É—Å –Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö —Å –Ω–∞–∏–±–æ–ª—å—à–µ–π –¥–æ–ª–µ–π –ø—Ä–∏–±—ã–ª–∏.</div>
                  </div>
                </section>
              )}

              {activeTab === 'archive' && (
                <section>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-lg font-bold">üìÜ –ü–æ –º–µ—Å—è—Ü–∞–º (–∞—Ä—Ö–∏–≤)</h2>
                    <button className="px-3 py-2 bg-blue-600 rounded" onClick={()=>openModal('archive')}>–î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—è—Ü</button>
                  </div>
                  <div className="overflow-x-auto">
                    <table className="w-full text-sm">
                      <thead className="text-slate-300">
                        <tr className="border-b border-slate-700">
                          <th className="py-2 px-2">–ú–µ—Å—è—Ü</th>
                          <th className="py-2 px-2 text-right">–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ</th>
                          <th className="py-2 px-2 text-right">–ò–Ω–¥–∏–≤–∏–¥.</th>
                          <th className="py-2 px-2 text-right">–ü–∞—Å—Å–∏–≤–Ω—ã–π</th>
                          <th className="py-2 px-2 text-right">–†–∞—Å—Ö–æ–¥—ã</th>
                          <th className="py-2 px-2 text-right">–ü—Ä–∏–±—ã–ª—å</th>
                          <th className="py-2 px-2 text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                      </thead>
                      <tbody>
                        {monthlyArchive.map((r,idx)=>(
                          <tr key={idx} className="border-b border-slate-700/40">
                            <td className="py-2 px-2">{r.month} {r.year}</td>
                            <td className="py-2 px-2 text-right">{fmt(r.groupIncome)}‚ÇΩ</td>
                            <td className="py-2 px-2 text-right">{fmt(r.individualIncome)}‚ÇΩ</td>
                            <td className="py-2 px-2 text-right">{fmt(r.passiveIncome)}‚ÇΩ</td>
                            <td className="py-2 px-2 text-right">-{fmt(r.expenses)}‚ÇΩ</td>
                            <td className="py-2 px-2 text-right text-blue-400 font-bold">{fmt(r.profit)}‚ÇΩ</td>
                            <td className="py-2 px-2 text-center">
                              <button onClick={()=>openModal('archive', idx)} className="text-blue-400 mr-2">‚úé</button>
                              <button onClick={()=>deleteItem('archive', idx)} className="text-red-400">üóë</button>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                      <tfoot className="bg-slate-900/50 font-bold">
                        <tr>
                          <td className="py-2 px-2">–ò–¢–û–ì–û:</td>
                          <td className="py-2 px-2 text-right">{fmt(monthlyArchive.reduce((s,r)=>s+(r.groupIncome||0),0))}‚ÇΩ</td>
                          <td className="py-2 px-2 text-right">{fmt(monthlyArchive.reduce((s,r)=>s+(r.individualIncome||0),0))}‚ÇΩ</td>
                          <td className="py-2 px-2 text-right">{fmt(monthlyArchive.reduce((s,r)=>s+(r.passiveIncome||0),0))}‚ÇΩ</td>
                          <td className="py-2 px-2 text-right">-{fmt(monthlyArchive.reduce((s,r)=>s+(r.expenses||0),0))}‚ÇΩ</td>
                          <td className="py-2 px-2 text-right">{fmt(monthlyArchive.reduce((s,r)=>s+(r.profit||0),0))}‚ÇΩ</td>
                          <td></td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </section>
              )}

              {activeTab === 'summary' && (
                <section>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-lg font-bold">üìà –°–≤–æ–¥–∫–∞ (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)</h2>
                    <button onClick={exportCSV} className="px-3 py-2 bg-green-600 rounded">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="bg-slate-900 p-4 rounded">
                      <div className="flex justify-between"><span>–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ (–ø—Ä–∏–±—ã–ª—å):</span><b>{fmt(totalDolgoProfit)}‚ÇΩ</b></div>
                      <div className="flex justify-between"><span>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∫–∏:</span><b>{fmt(totalIndividualIncome)}‚ÇΩ</b></div>
                      <div className="flex justify-between"><span>–ê—Ä–µ–Ω–¥–∞ –∑–∞–ª–∞:</span><b>{fmt(totalRentalsIncome)}‚ÇΩ</b></div>
                      <div className="flex justify-between"><span>–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥:</span><b>{fmt(totalPassiveIncome)}‚ÇΩ</b></div>
                      <div className="flex justify-between mt-2"><span>–†–∞—Å—Ö–æ–¥—ã:</span><b className="text-red-400">-{fmt(totalExpenses)}‚ÇΩ</b></div>
                      <div className="flex justify-between mt-4 text-xl font-bold"><span>–ß–ò–°–¢–ê–Ø –ü–†–ò–ë–´–õ–¨:</span><b className="text-blue-400">{fmt(totalReportProfit)}‚ÇΩ</b></div>
                    </div>
                    <div className="bg-slate-900 p-4 rounded">
                      <div className="text-slate-400 text-sm mb-2">–ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞</div>
                      <div className="text-sm">–í—Å–µ–≥–æ –¥–æ—Ö–æ–¥–æ–≤: {fmt(totalReportIncome)}‚ÇΩ</div>
                      <div className="text-sm">–í—Å–µ–≥–æ —Ä–∞—Å—Ö–æ–¥–æ–≤: {fmt(totalReportExpense)}‚ÇΩ</div>
<div className="text-sm">–ü—Ä–∏–±—ã–ª—å: {fmt(totalReportProfit)}‚ÇΩ</div>
</div>
</div>
</section>
)}
{activeTab === 'teachersSalary' && (
            <section>
              <h2 className="text-lg font-bold mb-2">üíº –ó–∞—Ä–ø–ª–∞—Ç—ã –ø–µ–¥–∞–≥–æ–≥–æ–≤</h2>
              <div className="text-slate-400 mb-4">
                –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á—ë—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ ¬´–ú–æ—Å–∫–æ–≤—Å–∫–æ–≥–æ –¥–æ–ª–≥–æ–ª–µ—Ç–∏—è¬ª
              </div>

              {(() => {
                const teacherStats = {};
                dolgo.forEach(record => {
                  const teacher = record.teacher || '–ë–µ–∑ –∏–º–µ–Ω–∏';
                  const location = record.location || '';
                  const income = Number(record.income || 0);
                  const salary = calcTeacherExpense(income, record.rate);
                  const hallExpense = Number(record.hallExpense || 0);
                  const profit = income - salary - hallExpense;
                  
                  if (!teacherStats[teacher]) {
                    teacherStats[teacher] = {
                      teacher, locations: new Set(), sessions: 0, dates: new Set(),
                      totalIncome: 0, totalSalary: 0, totalHall: 0, totalProfit: 0
                    };
                  }
                  
                  teacherStats[teacher].locations.add(location);
                  teacherStats[teacher].sessions += 1;
                  teacherStats[teacher].dates.add(record.date);
                  teacherStats[teacher].totalIncome += income;
                  teacherStats[teacher].totalSalary += salary;
                  teacherStats[teacher].totalHall += hallExpense;
                  teacherStats[teacher].totalProfit += profit;
                });
                
                const teacherList = Object.values(teacherStats).map(t => ({
                  ...t, days: t.dates.size, locations: Array.from(t.locations).join(', '),
                  profitPercent: t.totalIncome ? Math.round((t.totalProfit / t.totalIncome) * 100) : 0
                }));
                
                const totalTeachers = teacherList.length;
                const totalSessions = teacherList.reduce((s, t) => s + t.sessions, 0);
                const totalSalaries = teacherList.reduce((s, t) => s + t.totalSalary, 0);
                const totalHalls = teacherList.reduce((s, t) => s + t.totalHall, 0);
                
                return (
                  <>
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                      <div className="bg-blue-900 p-4 rounded">
                        <div className="text-xs uppercase opacity-80">–ü–µ–¥–∞–≥–æ–≥–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
                        <div className="text-2xl font-bold">{totalTeachers}</div>
                      </div>
                      <div className="bg-green-800 p-4 rounded">
                        <div className="text-xs uppercase opacity-80">–í—Å–µ–≥–æ –∑–∞–Ω—è—Ç–∏–π</div>
                        <div className="text-2xl font-bold">{totalSessions}</div>
                      </div>
                      <div className="bg-yellow-800 p-4 rounded">
                        <div className="text-xs uppercase opacity-80">–í—ã–ø–ª–∞—á–µ–Ω–æ –∑–∞—Ä–ø–ª–∞—Ç</div>
                        <div className="text-2xl font-bold">{fmt(totalSalaries)}‚ÇΩ</div>
                      </div>
                      <div className="bg-red-800 p-4 rounded">
                        <div className="text-xs uppercase opacity-80">–†–∞—Å—Ö–æ–¥—ã –Ω–∞ –∑–∞–ª—ã</div>
                        <div className="text-2xl font-bold">{fmt(totalHalls)}‚ÇΩ</div>
                      </div>
                    </div>

                    {teacherList.length === 0 ? (
                      <div className="bg-slate-900 p-8 rounded text-center text-slate-400">
                        –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –î–æ–±–∞–≤—å—Ç–µ –∑–∞–ø–∏—Å–∏ –≤ ¬´–ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –¥–æ–ª–≥–æ–ª–µ—Ç–∏–µ¬ª
                      </div>
                    ) : (
                      <div className="overflow-x-auto bg-slate-900 p-4 rounded">
                        <table className="w-full text-sm">
                          <thead className="text-slate-300 border-b border-slate-700">
                            <tr>
                              <th className="py-2 px-2 text-left">–ü–µ–¥–∞–≥–æ–≥</th>
                              <th className="py-2 px-2 text-center">–î–Ω–µ–π</th>
                              <th className="py-2 px-2 text-center">–ó–∞–Ω—è—Ç–∏–π</th>
                              <th className="py-2 px-2 text-right">–î–æ—Ö–æ–¥</th>
                              <th className="py-2 px-2 text-right">–ó–∞—Ä–ø–ª–∞—Ç–∞</th>
                              <th className="py-2 px-2 text-right">–ó–∞–ª</th>
                              <th className="py-2 px-2 text-right">–ü—Ä–∏–±—ã–ª—å</th>
                              <th className="py-2 px-2 text-center">%</th>
                            </tr>
                          </thead>
                          <tbody>
                            {teacherList.map((t, idx) => (
                              <tr key={idx} className="border-b border-slate-700/40">
                                <td className="py-2 px-2">
                                  <b>{t.teacher}</b>
                                  <div className="text-xs text-slate-400">üìç {t.locations || '‚Äî'}</div>
                                </td>
                                <td className="py-2 px-2 text-center">{t.days}</td>
                                <td className="py-2 px-2 text-center">{t.sessions}</td>
                                <td className="py-2 px-2 text-right text-green-400">{fmt(t.totalIncome)}‚ÇΩ</td>
                                <td className="py-2 px-2 text-right text-yellow-400">{fmt(t.totalSalary)}‚ÇΩ</td>
                                <td className="py-2 px-2 text-right text-red-400">{fmt(t.totalHall)}‚ÇΩ</td>
                                <td className="py-2 px-2 text-right text-blue-400 font-bold">{fmt(t.totalProfit)}‚ÇΩ</td>
                                <td className="py-2 px-2 text-center">{t.profitPercent}%</td>
                              </tr>
                            ))}
                          </tbody>
                          <tfoot className="bg-slate-900/50 font-bold">
                            <tr>
                              <td className="py-2 px-2" colSpan="3">–ò–¢–û–ì–û:</td>
                              <td className="py-2 px-2 text-right text-green-400">{fmt(teacherList.reduce((s,t) => s + t.totalIncome, 0))}‚ÇΩ</td>
                              <td className="py-2 px-2 text-right text-yellow-400">{fmt(totalSalaries)}‚ÇΩ</td>
                              <td className="py-2 px-2 text-right text-red-400">{fmt(totalHalls)}‚ÇΩ</td>
                              <td className="py-2 px-2 text-right text-blue-400">{fmt(teacherList.reduce((s,t) => s + t.totalProfit, 0))}‚ÇΩ</td>
                              <td></td>
                            </tr>
                          </tfoot>
                        </table>
                      </div>
                    )}

                    <div className="mt-4 text-sm text-slate-400">
                      ‚ÑπÔ∏è –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–µ–π –≤ ¬´–ú–æ—Å–∫–æ–≤—Å–∫–æ–º –¥–æ–ª–≥–æ–ª–µ—Ç–∏–∏¬ª.
                    </div>
                  </>
                );
              })()}
            </section>
          )}
        </main>

        {/* Modal */}
        {showModal && (
          <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50" onClick={closeModal}>
            <div className="bg-slate-800 rounded p-4 w-full max-w-2xl max-h-[90vh] overflow-y-auto" onClick={(e)=>e.stopPropagation()}>
              <div className="flex justify-between items-center mb-3">
                <h3 className="text-lg font-bold">{editingIndex!==null ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '–î–æ–±–∞–≤–∏—Ç—å'} ‚Äî {modalType}</h3>
                <button onClick={closeModal} className="text-slate-400">‚úñ</button>
              </div>

              <div className="space-y-2">
                {modalType === 'dolgo' && (
                  <>
                    <div><label className="text-sm">–î–∞—Ç–∞</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.date||''} onChange={(e)=>setForm({...form, date:e.target.value})} placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 06.12" /></div>
                    <div>
                      <label className="text-sm">–õ–æ–∫–∞—Ü–∏—è</label>
                      <select className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.location||''} onChange={(e)=>{
                        const loc = e.target.value;
                        const defaultHall = locationDefaults[loc] ?? 0;
                        setForm({...form, location: loc, hallExpense: defaultHall});
                      }}>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é</option>
                        <option value="–ë—É–¥–µ–Ω–Ω–æ–≥–æ">–ë—É–¥–µ–Ω–Ω–æ–≥–æ</option>
                        <option value="–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è">–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è</option>
                        <option value="–ü–∞—Ä–∫">–ü–∞—Ä–∫</option>
                      </select>
                    </div>
                    <div><label className="text-sm">–ü–µ–¥–∞–≥–æ–≥</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.teacher||''} onChange={(e)=>setForm({...form, teacher:e.target.value})} /></div>
                    <div className="grid grid-cols-2 gap-2">
                      <div>
                        <label className="text-sm">–°—Ç–∞–≤–∫–∞ –ø–µ–¥–∞–≥–æ–≥–∞</label>
                        <select className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.rate||'50%'} onChange={(e)=>setForm({...form, rate:e.target.value})}>
                          <option value="50%">50%</option>
                          <option value="700">700‚ÇΩ</option>
                          <option value="1000">1000‚ÇΩ</option>
                          <option value="100%">100%</option>
                        </select>
                      </div>
                      <div>
                        <label className="text-sm">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π</label>
                        <input type="number" className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.people||''} onChange={(e)=> {
                          const people = e.target.value;
                          const income = Number(people || 0) * 280;
                          setForm({...form, people, income});
                        }} />
                      </div>
                    </div>
                    <div>
                      <label className="text-sm">–†–∞—Å—Ö–æ–¥ –∑–∞ –∑–∞–ª (‚ÇΩ)</label>
                      <input type="number" className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.hallExpense||0} onChange={(e)=>setForm({...form, hallExpense: Number(e.target.value)})} />
                    </div>
                    <div>
                      <label className="text-sm">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                      <input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.comment||''} onChange={(e)=>setForm({...form, comment:e.target.value})} />
                    </div>
                  </>
                )}

                {modalType === 'individual' && (
                  <>
                    <div><label className="text-sm">–î–∞—Ç–∞</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.date||''} onChange={(e)=>setForm({...form,date:e.target.value})} /></div>
                    <div><label className="text-sm">–¢–∏–ø —É—Å–ª—É–≥–∏</label>
                      <select className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.type||'–û—Å—Ç–∞–ª—å–Ω—ã–µ'} onChange={(e)=>setForm({...form,type:e.target.value})}>
                        <option>–ê–∑–±—É–∫–∞ —Ç–∞–Ω—Ü–∞</option>
                        <option>–õ–∞—Ç–∏–Ω—Å–∫–∏–π –∫–≤–∞—Ä—Ç–µ—Ç</option>
                        <option>–ü—Ä–æ–∞–º</option>
                        <option>–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞</option>
                        <option>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</option>
                        <option>–û—Å—Ç–∞–ª—å–Ω—ã–µ</option>
                      </select>
                    </div>
                    <div><label className="text-sm">–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.client||''} onChange={(e)=>setForm({...form,client:e.target.value})} /></div>
                    <div className="grid grid-cols-2 gap-2">
                      <div><label className="text-sm">–°—É–º–º–∞ (‚ÇΩ)</label><input type="number" className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.amount||''} onChange={(e)=>setForm({...form,amount: Number(e.target.value)})} /></div>
                      <div><label className="text-sm">–ü–µ–¥–∞–≥–æ–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.teacher||''} onChange={(e)=>setForm({...form,teacher:e.target.value})} /></div>
                    </div>
                    <div><label className="text-sm">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.comment||''} onChange={(e)=>setForm({...form,comment:e.target.value})} /></div>
                  </>
                )}

                {modalType === 'rental' && (
                  <>
                    <div><label className="text-sm">–î–∞—Ç–∞</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.date||''} onChange={(e)=>setForm({...form,date:e.target.value})} /></div>
                    <div><label className="text-sm">–ò–º—è (–∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä)</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.name||''} onChange={(e)=>setForm({...form,name:e.target.value})} /></div>
                    <div><label className="text-sm">–°—É–º–º–∞ (‚ÇΩ)</label><input type="number" className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.amount||''} onChange={(e)=>setForm({...form,amount: Number(e.target.value)})} /></div>
                    <div><label className="text-sm">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.comment||''} onChange={(e)=>setForm({...form,comment:e.target.value})} /></div>
                  </>
                )}

                {modalType === 'expense' && (
                  <>
                    <div><label className="text-sm">–î–∞—Ç–∞</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.date||''} onChange={(e)=>setForm({...form,date:e.target.value})} /></div>
                    <div><label className="text-sm">–¢–∏–ø —Ä–∞—Å—Ö–æ–¥–∞</label>
                      <select className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.type||''} onChange={(e)=>setForm({...form,type:e.target.value})}>
                        <option>–ê—Ä–µ–Ω–¥–∞ –∑–∞–ª–∞</option>
                        <option>–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã</option>
                        <option>–£–≤–ª–µ—á–µ–Ω–∏—è</option>
                        <option>–ü—Ä–æ—á–µ–µ</option>
                      </select>
                    </div>
                    <div><label className="text-sm">–ß—Ç–æ</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.what||''} onChange={(e)=>setForm({...form,what:e.target.value})} /></div>
                    <div><label className="text-sm">–°—É–º–º–∞ (‚ÇΩ)</label><input type="number" className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.amount||''} onChange={(e)=>setForm({...form,amount: Number(e.target.value)})} /></div>
                    <div><label className="text-sm">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.comment||''} onChange={(e)=>setForm({...form,comment:e.target.value})} /></div>
                  </>
                )}

                {modalType === 'passive' && (
                  <>
                    <div><label className="text-sm">–î–∞—Ç–∞</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.date||''} onChange={(e)=>setForm({...form,date:e.target.value})} /></div>
                    <div><label className="text-sm">–ò—Å—Ç–æ—á–Ω–∏–∫</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.source||''} onChange={(e)=>setForm({...form,source:e.target.value})} /></div>
                    <div><label className="text-sm">–°—É–º–º–∞ –≤ –º–µ—Å—è—Ü (‚ÇΩ)</label><input type="number" className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.monthly||''} onChange={(e)=>setForm({...form,monthly: Number(e.target.value)})} /></div>
                    <div><label className="text-sm">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.comment||''} onChange={(e)=>setForm({...form,comment:e.target.value})} /></div>
                  </>
                )}

                {modalType === 'student' && (
                  <>
                    <div><label className="text-sm">–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.name||''} onChange={(e)=>setForm({...form,name:e.target.value})} /></div>
                    <div><label className="text-sm">–¢–µ–ª–µ—Ñ–æ–Ω</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.phone||''} onChange={(e)=>setForm({...form,phone:e.target.value})} /></div>
                    <div><label className="text-sm">–ì—Ä—É–ø–ø–∞</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.group||''} onChange={(e)=>setForm({...form,group:e.target.value})} placeholder="–ü—Ä–∏–º–µ—Ä: –î–æ–ª–≥–æ–ª–µ—Ç–∏–µ –ë—É–¥–µ–Ω–Ω–æ–≥–æ" /></div>
                    <div className="grid grid-cols-2 gap-2">
                      <div><label className="text-sm">–ê–±–æ–Ω–µ–º–µ–Ω—Ç</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.subscription||''} onChange={(e)=>setForm({...form,subscription:e.target.value})} /></div>
                      <div><label className="text-sm">–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ</label><input type="date" className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.expiry||''} onChange={(e)=>setForm({...form,expiry:e.target.value})} /></div>
                    </div>
                    <div><label className="text-sm">–°—Ç–∞—Ç—É—Å</label>
                      <select className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.status||'–ê–∫—Ç–∏–≤–Ω—ã–π'} onChange={(e)=>setForm({...form,status:e.target.value})}>
                        <option>–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                        <option>–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π</option>
                        <option>–ü—Ä–æ–±–Ω—ã–π</option>
                      </select>
                    </div>
                    <div><label className="text-sm">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.note||''} onChange={(e)=>setForm({...form,note:e.target.value})} /></div>
                  </>
                )}

                {modalType === 'archive' && (
                  <>
                    <div><label className="text-sm">–ú–µ—Å—è—Ü</label>
                      <select className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.month||''} onChange={(e)=>setForm({...form,month:e.target.value})}>
                        <option>–Ø–Ω–≤–∞—Ä—å</option><option>–§–µ–≤—Ä–∞–ª—å</option><option>–ú–∞—Ä—Ç</option><option>–ê–ø—Ä–µ–ª—å</option>
                        <option>–ú–∞–π</option><option>–ò—é–Ω—å</option><option>–ò—é–ª—å</option><option>–ê–≤–≥—É—Å—Ç</option>
                        <option>–°–µ–Ω—Ç—è–±—Ä—å</option><option>–û–∫—Ç—è–±—Ä—å</option><option>–ù–æ—è–±—Ä—å</option><option>–î–µ–∫–∞–±—Ä—å</option>
                      </select>
                    </div>
                    <div><label className="text-sm">–ì–æ–¥</label><input type="number" className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.year||''} onChange={(e)=>setForm({...form,year:e.target.value})} /></div>
                    <div className="grid grid-cols-2 gap-2">
                      <div><label className="text-sm">–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ (‚ÇΩ)</label><input type="number" className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.groupIncome||''} onChange={(e)=>setForm({...form,groupIncome: Number(e.target.value)})} /></div>
                      <div><label className="text-sm">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ (‚ÇΩ)</label><input type="number" className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.individualIncome||''} onChange={(e)=>setForm({...form,individualIncome: Number(e.target.value)})} /></div>
                      <div><label className="text-sm">–ü–∞—Å—Å–∏–≤–Ω—ã–π (‚ÇΩ)</label><input type="number" className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.passiveIncome||''} onChange={(e)=>setForm({...form,passiveIncome: Number(e.target.value)})} /></div>
                      <div><label className="text-sm">–†–∞—Å—Ö–æ–¥—ã (‚ÇΩ)</label><input type="number" className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.expenses||''} onChange={(e)=>setForm({...form,expenses: Number(e.target.value)})} /></div>
                    </div>
                    <div><label className="text-sm">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label><input className="w-full mt-1 p-2 bg-slate-700 rounded" value={form.note||''} onChange={(e)=>setForm({...form,note:e.target.value})} /></div>
                  </>
                )}
              </div>

              <div className="flex gap-2 mt-3">
                <button onClick={saveModal} className="px-4 py-2 bg-blue-600 rounded">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button onClick={closeModal} className="px-4 py-2 bg-slate-700 rounded">–û—Ç–º–µ–Ω–∞</button>
              </div>
            </div>
          </div>
        )}

      </div>
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));              
