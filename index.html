<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Финансовый бот — Месячный отчёт и аналитика</title>
<style>
:root{--brand:#2563eb;--muted:#6b7280}
*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#f3f4f6;color:#111}
header{background:var(--brand);color:#fff;padding:14px 16px;display:flex;gap:12px;align-items:center}
header h1{font-size:16px;margin:0;flex:1}
main{max-width:1100px;margin:12px auto;padding:12px;background:#fff;border-radius:10px}
nav.tabs{display:flex;gap:8px;margin-bottom:10px;overflow:auto;padding-bottom:6px}
.tab{padding:8px 12px;border-radius:8px;background:#eef2ff;color:var(--brand);font-weight:600;cursor:pointer;white-space:nowrap}
.tab.active{background:var(--brand);color:#fff}
.toolbar{display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap}
.btn{background:var(--brand);color:#fff;border:none;padding:8px 10px;border-radius:8px;cursor:pointer}
.btn.ghost{background:#fff;color:var(--brand);border:1px solid var(--brand)}
.muted{color:var(--muted);font-size:13px}
table{width:100%;border-collapse:collapse;margin-top:8px;font-size:14px}
th,td{padding:8px;border:1px solid #e6edf3;text-align:left}
th{background:#f8fafc}
.card-row{display:flex;gap:8px;margin:8px 0;flex-wrap:wrap}
.card{background:#f8fafc;padding:10px;border-radius:8px;min-width:140px;border:1px solid #eef2ff}
.modal{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.35);display:flex;align-items:center;justify-content:center;z-index:999}
.modal .box{background:#fff;padding:14px;border-radius:8px;width:720px;max-width:95%;max-height:86%;overflow:auto}
label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
input,select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6eef9;margin-bottom:8px}
.small{font-size:13px;padding:6px 8px}
footer{font-size:13px;color:var(--muted);margin-top:10px}
</style>
</head>
<body>
<header>
<h1>Финансовый бот — Месячный отчёт</h1>
</header>

<main id="app">
<nav class="tabs" id="tabs"></nav>
<div class="toolbar" id="toolbar"></div>
<div id="content"></div>
<footer>Данные сохраняются в браузере (localStorage).</footer>
</main>

<div id="modal-root"></div>
<script>

let state = JSON.parse(localStorage.getItem("finData")||'{"monthlyData":[]}');

function save(){localStorage.setItem("finData",JSON.stringify(state))}

const tabs=["Месячный отчёт"];
let activeTab=tabs[0];

function renderTabs(){
const t=document.getElementById("tabs");
t.innerHTML=tabs.map(x=>`<div class="tab ${x==activeTab?"active":""}">${x}</div>`).join("");
t.querySelectorAll(".tab").forEach(el=>{
el.onclick=()=>{activeTab=el.textContent;renderContent();}
})
}

function renderToolbar(){
document.getElementById("toolbar").innerHTML=`
<button class="btn" id="add">Добавить</button>
`;
document.getElementById("add").onclick=()=>openModal(form());
}

function renderContent(){
if(activeTab==="Месячный отчёт") renderMonthly();
}

function renderMonthly(){
const c=document.getElementById("content");
const rows=state.monthlyData;
let html=`<h3>Записи</h3>
<table>
<tr><th>Дата</th><th>Категория</th><th>Локация</th><th>Доход</th><th>Педагог</th><th>Аренда</th><th>Прибыль</th></tr>
${rows.map(r=>`
<tr>
<td>${r.date}</td>
<td>${r.category}</td>
<td>${r.location||""}</td>
<td>${r.income}</td>
<td>${r.teacherPay}</td>
<td>${r.hallExpense}</td>
<td>${r.profit}</td>
</tr>`).join("")}
</table>
`;
c.innerHTML=html;
}

function form(){
const box=document.createElement("div");
box.innerHTML=`
<h3>Новая запись</h3>

<label>Дата</label>
<input id="f_date" type="date" value="${new Date().toISOString().slice(0,10)}">

<label>Категория</label>
<select id="f_cat">
<option>Московское долголетие</option>
<option>Индивидуальные уроки</option>
<option>Аренда зала</option>
<option>Пассивный</option>
<option>Прочее</option>
</select>

<div id="block_md" style="display:none">

<label>Локация</label>
<select id="f_loc">
<option>Буденного</option>
<option>Черкизовская</option>
<option>Парк</option>
</select>

<label>Кол-во человек</label>
<input id="f_people" type="number" value="0">

<label>Ставка педагога</label>
<input id="f_rate" type="number" value="0">

<label>Тип ставки</label>
<select id="f_rate_type">
<option>%</option>
<option>фикс</option>
</select>

<label>Аренда зала</label>
<input id="f_hall" type="number" value="0">
</div>

<button class="btn" id="save">Сохранить</button>
<button class="btn ghost" onclick="closeModal()">Отмена</button>
`;

setTimeout(()=>{
let cat=document.getElementById("f_cat");
cat.onchange=()=>toggle(cat.value);
toggle(cat.value);
},50);

function toggle(v){
document.getElementById("block_md").style.display=(v==="Московское долголетие")?"block":"none";
}

box.querySelector("#save").onclick=()=>{
const cat=document.getElementById("f_cat").value;
let rec={date:document.getElementById("f_date").value,category:cat};

if(cat==="Московское долголетие"){
let people=+document.getElementById("f_people").value;
let rate=+document.getElementById("f_rate").value;
let type=document.getElementById("f_rate_type").value;
let hall=+document.getElementById("f_hall").value;
let income=people*280;
let teacher=(type=="%"? income*(rate/100):rate);
let profit=income-hall-teacher;

rec.location=document.getElementById("f_loc").value;
rec.people=people;
rec.income=income;
rec.teacherPay=teacher;
rec.hallExpense=hall;
rec.profit=profit;
}else{
rec.income=0;rec.teacherPay=0;rec.hallExpense=0;rec.profit=0;
}

state.monthlyData.push(rec);
save();
closeModal();
renderContent();
}

return box;
}

function openModal(el){
modal_root.innerHTML="";
const m=document.createElement("div");
m.className="modal";
const b=document.createElement("div");
b.className="box";
b.appendChild(el);
m.appendChild(b);
m.onclick=e=>{if(e.target===m)closeModal();}
modal_root.appendChild(m);
}
function closeModal(){modal_root.innerHTML="";}

renderTabs();
renderToolbar();
renderContent();

</script>
</body>
</html>
