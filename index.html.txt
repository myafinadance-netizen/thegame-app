<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TheGame - –£—á—ë—Ç –¥–æ—Ö–æ–¥–æ–≤</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #fff;
            min-height: 100vh;
            padding: 16px;
            padding-bottom: 80px;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .header p {
            color: #94a3b8;
            font-size: 14px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 16px;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
        }

        .stat-value.green { color: #22c55e; }
        .stat-value.blue { color: #3b82f6; }
        .stat-value.yellow { color: #eab308; }
        .stat-value.red { color: #ef4444; }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tab {
            flex-shrink: 0;
            padding: 10px 16px;
            background: #1e293b;
            border: none;
            border-radius: 8px;
            color: #94a3b8;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab.active {
            background: #3b82f6;
            color: white;
        }

        .content {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
        }

        .form {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .form input, .form select {
            width: 100%;
            padding: 12px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }

        .form input::placeholder {
            color: #64748b;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: #3b82f6;
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn:active {
            background: #2563eb;
        }

        .btn-danger {
            background: #ef4444;
            padding: 8px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        .entry {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .entry-date {
            font-weight: 600;
            font-size: 14px;
        }

        .entry-info {
            font-size: 13px;
            color: #94a3b8;
            margin-bottom: 4px;
        }

        .entry-money {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #334155;
        }

        .money-item {
            font-size: 13px;
        }

        .money-label {
            color: #94a3b8;
        }

        .money-value {
            font-weight: 600;
            margin-left: 4px;
        }

        .money-value.income { color: #22c55e; }
        .money-value.expense { color: #ef4444; }
        .money-value.profit { color: #3b82f6; }

        .summary-section {
            margin-bottom: 20px;
        }

        .summary-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #22c55e;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #334155;
        }

        .summary-label {
            color: #94a3b8;
        }

        .summary-value {
            font-weight: 600;
        }

        .summary-total {
            margin-top: 12px;
            padding: 16px;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            border-radius: 8px;
            text-align: center;
        }

        .summary-total-label {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .summary-total-value {
            font-size: 28px;
            font-weight: bold;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üí∞ TheGame</h1>
        <p>–ü—É—Ç—å –æ—Ç 385–ö –∫ 1–ú</p>
    </div>

    <div class="stats">
        <div class="stat-card">
            <div class="stat-label">–¢–µ–∫—É—â–∏–π –¥–æ—Ö–æ–¥</div>
            <div class="stat-value green" id="currentIncome">0‚ÇΩ</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">–¶–µ–ª—å (–¢–æ—á–∫–∞ –ë)</div>
            <div class="stat-value blue">1,000,000‚ÇΩ</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
            <div class="stat-value yellow" id="progress">0%</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">–î–æ —Ü–µ–ª–∏</div>
            <div class="stat-value red" id="toGoal">1,000,000‚ÇΩ</div>
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="switchTab('add')">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
        <button class="tab" onclick="switchTab('list')">üìã –ó–∞–ø–∏—Å–∏</button>
        <button class="tab" onclick="switchTab('summary')">üìä –°–≤–æ–¥–∫–∞</button>
    </div>

    <div class="content">
        <div id="tabAdd">
            <form class="form" onsubmit="addEntry(event)">
                <input type="date" id="date" required>
                <select id="location" required>
                    <option value="–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è">–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è</option>
                    <option value="–ë—É–¥–µ–Ω–Ω–æ–≥–æ">–ë—É–¥–µ–Ω–Ω–æ–≥–æ</option>
                    <option value="–í—ã–µ–∑–¥">–í—ã–µ–∑–¥</option>
                </select>
                <select id="type" required>
                    <option value="–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ">–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ</option>
                    <option value="–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∫–∞">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∫–∞</option>
                    <option value="–ê—Ä–µ–Ω–¥–∞">–ê—Ä–µ–Ω–¥–∞</option>
                </select>
                <input type="text" id="direction" placeholder="–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ">
                <input type="text" id="teacher" placeholder="–ü–µ–¥–∞–≥–æ–≥" value="–Ø">
                <input type="number" id="people" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π">
                <input type="number" id="income" placeholder="–î–æ—Ö–æ–¥" required>
                <input type="number" id="expense" placeholder="–†–∞—Å—Ö–æ–¥" value="0">
                <input type="text" id="note" placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ">
                <button type="submit" class="btn">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
            </form>
        </div>

        <div id="tabList" class="hidden">
            <div id="entriesList"></div>
        </div>

        <div id="tabSummary" class="hidden">
            <div class="summary-section">
                <div class="summary-title" style="color: #22c55e;">–î–û–•–û–î–´</div>
                <div class="summary-item">
                    <span class="summary-label">–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ –ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è:</span>
                    <span class="summary-value" id="sumCherkiz">0‚ÇΩ</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ –ë—É–¥–µ–Ω–Ω–æ–≥–æ:</span>
                    <span class="summary-value" id="sumBudenogo">0‚ÇΩ</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ:</span>
                    <span class="summary-value" id="sumIndividual">0‚ÇΩ</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥:</span>
                    <span class="summary-value">85,000‚ÇΩ</span>
                </div>
                <div class="summary-item" style="border: none; margin-top: 12px;">
                    <span class="summary-label" style="font-weight: 600;">–ò–¢–û–ì–û –î–û–•–û–î:</span>
                    <span class="summary-value" style="color: #22c55e; font-size: 18px;" id="totalIncome">0‚ÇΩ</span>
                </div>
            </div>

            <div class="summary-section" style="margin-top: 24px;">
                <div class="summary-title" style="color: #ef4444;">–†–ê–°–•–û–î–´</div>
                <div class="summary-item">
                    <span class="summary-label">–ó–∞—Ä–ø–ª–∞—Ç—ã –ø–µ–¥–∞–≥–æ–≥–æ–≤:</span>
                    <span class="summary-value" id="totalExpenses">0‚ÇΩ</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">–ö–æ–º–º—É–Ω–∞–ª–∫–∞:</span>
                    <span class="summary-value">20,000‚ÇΩ</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:</span>
                    <span class="summary-value">10,000‚ÇΩ</span>
                </div>
                <div class="summary-item" style="border: none; margin-top: 12px;">
                    <span class="summary-label" style="font-weight: 600;">–ò–¢–û–ì–û –†–ê–°–•–û–î:</span>
                    <span class="summary-value" style="color: #ef4444; font-size: 18px;">30,000‚ÇΩ</span>
                </div>
            </div>

            <div class="summary-total">
                <div class="summary-total-label">–ß–ò–°–¢–ê–Ø –ü–†–ò–ë–´–õ–¨</div>
                <div class="summary-total-value" id="netProfit">0‚ÇΩ</div>
            </div>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.hide();

        document.getElementById('date').valueAsDate = new Date();

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('[id^="tab"]').forEach(t => t.classList.add('hidden'));
            
            event.target.classList.add('active');
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.remove('hidden');
            
            if (tab === 'list') loadEntries();
            if (tab === 'summary') updateSummary();
        }

        function getData() {
            const data = localStorage.getItem('thegame_data');
            return data ? JSON.parse(data) : [];
        }

        function saveData(data) {
            localStorage.setItem('thegame_data', JSON.stringify(data));
            updateStats();
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('ru-RU').format(Math.round(num)) + '‚ÇΩ';
        }

        function formatDate(dateStr) {
            const [year, month, day] = dateStr.split('-');
            return `${day}.${month}.${year}`;
        }

        function addEntry(e) {
            e.preventDefault();
            
            const entry = {
                id: Date.now(),
                date: document.getElementById('date').value,
                location: document.getElementById('location').value,
                type: document.getElementById('type').value,
                direction: document.getElementById('direction').value,
                teacher: document.getElementById('teacher').value,
                people: parseInt(document.getElementById('people').value) || 0,
                income: parseInt(document.getElementById('income').value),
                expense: parseInt(document.getElementById('expense').value) || 0,
                note: document.getElementById('note').value
            };

            const data = getData();
            data.push(entry);
            saveData(data);

            e.target.reset();
            document.getElementById('date').valueAsDate = new Date();
            document.getElementById('teacher').value = '–Ø';

            tg.showAlert('‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
        }

        function deleteEntry(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) {
                const data = getData().filter(entry => entry.id !== id);
                saveData(data);
                loadEntries();
                tg.showAlert('üóë –ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞');
            }
        }

        function loadEntries() {
            const data = getData();
            const list = document.getElementById('entriesList');
            
            if (data.length === 0) {
                list.innerHTML = '<div class="empty-state">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π<br>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å!</div>';
                return;
            }

            list.innerHTML = data.slice().reverse().map(entry => `
                <div class="entry">
                    <div class="entry-header">
                        <span class="entry-date">${formatDate(entry.date)}</span>
                        <button class="btn btn-danger" onclick="deleteEntry(${entry.id})">üóë</button>
                    </div>
                    <div class="entry-info">${entry.location} ¬∑ ${entry.type}</div>
                    <div class="entry-info">${entry.direction} ¬∑ ${entry.teacher} ¬∑ ${entry.people} —á–µ–ª</div>
                    ${entry.note ? `<div class="entry-info" style="color: #64748b;">${entry.note}</div>` : ''}
                    <div class="entry-money">
                        <div class="money-item">
                            <span class="money-label">–î–æ—Ö–æ–¥:</span>
                            <span class="money-value income">${formatNumber(entry.income)}</span>
                        </div>
                        <div class="money-item">
                            <span class="money-label">–†–∞—Å—Ö–æ–¥:</span>
                            <span class="money-value expense">${formatNumber(entry.expense)}</span>
                        </div>
                        <div class="money-item">
                            <span class="money-label">–ü—Ä–∏–±—ã–ª—å:</span>
                            <span class="money-value profit">${formatNumber(entry.income - entry.expense)}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateStats() {
            const data = getData();
            const totalIncome = data.reduce((sum, entry) => sum + entry.income - entry.expense, 0) + 85000;
            const progress = ((totalIncome / 1000000) * 100).toFixed(1);
            
            document.getElementById('currentIncome').textContent = formatNumber(totalIncome);
            document.getElementById('progress').textContent = progress + '%';
            document.getElementById('toGoal').textContent = formatNumber(1000000 - totalIncome);
        }

        function updateSummary() {
            const data = getData();
            
            const cherkiz = data
                .filter(e => e.location === '–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è' && e.type === '–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ')
                .reduce((sum, e) => sum + e.income - e.expense, 0);
            
            const budenogo = data
                .filter(e => e.location === '–ë—É–¥–µ–Ω–Ω–æ–≥–æ' && e.type === '–î–æ–ª–≥–æ–ª–µ—Ç–∏–µ')
                .reduce((sum, e) => sum + e.income - e.expense, 0);
            
            const individual = data
                .filter(e => e.type === '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–∫–∞')
                .reduce((sum, e) => sum + e.income - e.expense, 0);
            
            const expenses = data.reduce((sum, e) => sum + e.expense, 0);
            
            const totalIncome = cherkiz + budenogo + individual + 85000;
            const netProfit = totalIncome - 30000;
            
            document.getElementById('sumCherkiz').textContent = formatNumber(cherkiz);
            document.getElementById('sumBudenogo').textContent = formatNumber(budenogo);
            document.getElementById('sumIndividual').textContent = formatNumber(individual);
            document.getElementById('totalIncome').textContent = formatNumber(totalIncome);
            document.getElementById('totalExpenses').textContent = formatNumber(expenses);
            document.getElementById('netProfit').textContent = formatNumber(netProfit);
        }

        updateStats();
    </script>
</body>
</html>